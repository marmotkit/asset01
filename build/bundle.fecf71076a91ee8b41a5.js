(()=>{var e,t,n,a={27978:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=n(583380),o=a(n(964110)),c=a(n(46056)),d=a(n(983885)),m=a(n(37362)),u=a(n(69441)),h=a(n(533736)),x=n(859325);function p(e){const{children:t,value:n,index:a,...l}=e;return(0,r.jsx)("div",{role:"tabpanel",hidden:n!==a,id:`investment-tabpanel-${a}`,"aria-labelledby":`investment-tab-${a}`,...l,children:n===a&&(0,r.jsx)(i.Box,{sx:{p:3},children:t})})}t.default=()=>{const[e,t]=(0,l.useState)(0),[n,a]=(0,l.useState)([]),[g,y]=(0,l.useState)(!0),[j,b]=(0,l.useState)(null),[v,f]=(0,l.useState)(!1),[T,S]=(0,l.useState)(void 0);(0,l.useEffect)((()=>{C()}),[]);const C=async()=>{try{y(!0);const e=await s.ApiService.getInvestments();a(e)}catch(e){b("載入投資資料失敗")}finally{y(!1)}};return g?(0,r.jsx)(i.Box,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,r.jsx)(i.CircularProgress,{})}):j?(0,r.jsx)(i.Box,{m:2,children:(0,r.jsx)(i.Alert,{severity:"error",children:j})}):(0,r.jsxs)(i.Box,{sx:{width:"100%"},children:[(0,r.jsxs)(i.Box,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(i.Typography,{variant:"h6",children:"投資管理"}),(0,r.jsx)(i.Button,{variant:"contained",startIcon:(0,r.jsx)(x.Add,{}),onClick:()=>{S(void 0),f(!0)},children:"新增投資"})]}),(0,r.jsxs)(i.Paper,{sx:{width:"100%",mb:2},children:[(0,r.jsx)(i.Box,{sx:{borderBottom:1,borderColor:"divider"},children:(0,r.jsxs)(i.Tabs,{value:e,onChange:(e,n)=>{t(n)},"aria-label":"投資管理標籤",children:[(0,r.jsx)(i.Tab,{label:"投資項目"}),(0,r.jsx)(i.Tab,{label:"租賃/分潤"}),(0,r.jsx)(i.Tab,{label:"歷史記錄"}),(0,r.jsx)(i.Tab,{label:"發票管理"}),(0,r.jsx)(i.Tab,{label:"投資報表"})]})}),(0,r.jsx)(p,{value:e,index:0,children:(0,r.jsx)(o.default,{investments:n,onEdit:e=>{S(e),f(!0)},onRefresh:C})}),(0,r.jsx)(p,{value:e,index:1,children:(0,r.jsx)(c.default,{})}),(0,r.jsx)(p,{value:e,index:2,children:(0,r.jsx)(d.default,{investments:n})}),(0,r.jsx)(p,{value:e,index:3,children:(0,r.jsx)(m.default,{investments:n})}),(0,r.jsx)(p,{value:e,index:4,children:(0,r.jsx)(u.default,{investments:n})})]}),(0,r.jsx)(h.default,{open:v,investment:T,onClose:()=>f(!1),onSave:async e=>{try{T?(e.type,await s.ApiService.updateInvestment({...T,...e})):await s.ApiService.createInvestment(e),await C(),f(!1)}catch(e){console.error("儲存投資項目失敗:",e),b("儲存投資項目失敗")}}})]})}},36049:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvoiceCopy=t.InvoiceType=void 0;const a=n(474848),r=n(264456),l=n(500523);var i,s;!function(e){e.INVOICE2="invoice2",e.INVOICE3="invoice3",e.RECEIPT="receipt"}(i||(t.InvoiceType=i={})),function(e){e.STUB="stub",e.RECEIPT="receipt",e.ACCOUNTING="accounting"}(s||(t.InvoiceCopy=s={}));const o=(0,r.styled)(r.Paper)((({theme:e})=>({width:"210mm",minHeight:"148mm",padding:e.spacing(4),margin:"0 auto",backgroundColor:"#fff",boxShadow:"none",position:"relative",overflow:"hidden","@media print":{boxShadow:"none",margin:0,padding:e.spacing(2),breakInside:"avoid",pageBreakInside:"avoid"}}))),c=(0,r.styled)(r.Box)((({theme:e})=>({marginBottom:e.spacing(3)}))),d=(0,r.styled)(r.Typography)((({theme:e})=>({fontWeight:"bold",marginBottom:e.spacing(1)}))),m=(0,r.styled)(r.Box)((({theme:e})=>({border:"1px solid #000",marginTop:e.spacing(2),marginBottom:e.spacing(2)}))),u=(0,r.styled)(r.Grid)((({theme:e})=>({borderBottom:"1px solid #000","&:last-child":{borderBottom:"none"}}))),h=(0,r.styled)(r.Grid)((({theme:e})=>({padding:e.spacing(1),borderRight:"1px solid #000","&:last-child":{borderRight:"none"}}))),x=(0,r.styled)(r.Box)((({theme:e})=>({marginTop:e.spacing(3)}))),p=(0,r.styled)(r.Box)((({theme:e})=>({position:"absolute",top:"0",left:"0",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:"none",zIndex:0}))),g=(0,r.styled)(r.Typography)((({theme:e})=>({fontSize:"6rem",fontWeight:"bold",color:"rgba(0, 0, 0, 0.08)",transform:"rotate(-45deg)",whiteSpace:"nowrap",userSelect:"none"})));t.default=({data:e,copy:t})=>{const{type:n,number:y,date:j,buyerName:b,buyerTaxId:v,amount:f,itemName:T,note:S,investmentName:C,year:I,month:w}=e,D=new Date(j).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}),P=((e,t)=>{if(e===i.RECEIPT)return"收據";switch(t){case s.STUB:return"存根聯";case s.RECEIPT:return"收執聯";case s.ACCOUNTING:return"報帳聯";default:return""}})(n,t),N=(e=>{switch(e){case i.INVOICE2:return"二聯式統一發票";case i.INVOICE3:return"三聯式統一發票";case i.RECEIPT:return"收據";default:return"發票"}})(n);return(0,a.jsxs)(o,{children:[(0,a.jsx)(p,{children:(0,a.jsx)(g,{children:P})}),(0,a.jsxs)(r.Box,{sx:{position:"relative",zIndex:1},children:[(0,a.jsx)(c,{children:(0,a.jsxs)(r.Grid,{container:!0,justifyContent:"space-between",alignItems:"center",children:[(0,a.jsxs)(r.Grid,{item:!0,children:[(0,a.jsx)(d,{variant:"h4",children:N}),(0,a.jsx)(r.Typography,{variant:"subtitle1",children:P})]}),(0,a.jsxs)(r.Grid,{item:!0,children:[(0,a.jsxs)(r.Typography,{variant:"body1",children:["發票號碼：",y||"自動產生"]}),(0,a.jsxs)(r.Typography,{variant:"body1",children:["日期：",D]})]})]})}),(0,a.jsx)(r.Divider,{}),(0,a.jsx)(r.Box,{mt:2,mb:2,children:(0,a.jsxs)(r.Grid,{container:!0,spacing:2,children:[(0,a.jsx)(r.Grid,{item:!0,xs:12,children:(0,a.jsxs)(r.Typography,{variant:"body1",children:[(0,a.jsx)("strong",{children:"買受人："})," ",b]})}),n!==i.RECEIPT&&v&&(0,a.jsx)(r.Grid,{item:!0,xs:12,children:(0,a.jsxs)(r.Typography,{variant:"body1",children:[(0,a.jsx)("strong",{children:"統一編號："})," ",v]})}),(0,a.jsx)(r.Grid,{item:!0,xs:12,children:(0,a.jsxs)(r.Typography,{variant:"body1",children:[(0,a.jsx)("strong",{children:"投資項目："})," ",C]})}),(0,a.jsx)(r.Grid,{item:!0,xs:12,children:(0,a.jsxs)(r.Typography,{variant:"body1",children:[(0,a.jsx)("strong",{children:"租期："})," ",I,"年",w,"月"]})})]})}),(0,a.jsxs)(m,{children:[(0,a.jsxs)(u,{container:!0,children:[(0,a.jsx)(h,{item:!0,xs:1,children:(0,a.jsx)(r.Typography,{variant:"body2",align:"center",children:"項次"})}),(0,a.jsx)(h,{item:!0,xs:7,children:(0,a.jsx)(r.Typography,{variant:"body2",align:"center",children:"品名"})}),(0,a.jsx)(h,{item:!0,xs:2,children:(0,a.jsx)(r.Typography,{variant:"body2",align:"center",children:"數量"})}),(0,a.jsx)(h,{item:!0,xs:2,children:(0,a.jsx)(r.Typography,{variant:"body2",align:"center",children:"金額"})})]}),(0,a.jsxs)(u,{container:!0,children:[(0,a.jsx)(h,{item:!0,xs:1,children:(0,a.jsx)(r.Typography,{variant:"body2",align:"center",children:"1"})}),(0,a.jsx)(h,{item:!0,xs:7,children:(0,a.jsx)(r.Typography,{variant:"body2",children:T})}),(0,a.jsx)(h,{item:!0,xs:2,children:(0,a.jsx)(r.Typography,{variant:"body2",align:"center",children:"1"})}),(0,a.jsx)(h,{item:!0,xs:2,children:(0,a.jsx)(r.Typography,{variant:"body2",align:"right",children:(0,l.formatCurrency)(f)})})]}),(0,a.jsxs)(u,{container:!0,children:[(0,a.jsx)(h,{item:!0,xs:10,style:{textAlign:"right"},children:(0,a.jsx)(r.Typography,{variant:"body2",children:(0,a.jsx)("strong",{children:"總計："})})}),(0,a.jsx)(h,{item:!0,xs:2,children:(0,a.jsx)(r.Typography,{variant:"body2",align:"right",children:(0,a.jsx)("strong",{children:(0,l.formatCurrency)(f)})})})]})]}),S&&(0,a.jsx)(r.Box,{mt:2,children:(0,a.jsxs)(r.Typography,{variant:"body2",children:[(0,a.jsx)("strong",{children:"備註："})," ",S]})}),(0,a.jsx)(x,{children:(0,a.jsxs)(r.Grid,{container:!0,spacing:4,children:[(0,a.jsxs)(r.Grid,{item:!0,xs:4,children:[(0,a.jsx)(r.Typography,{variant:"body2",align:"center",children:(0,a.jsx)("strong",{children:"開立人"})}),(0,a.jsx)(r.Box,{mt:4,textAlign:"center",children:(0,a.jsx)(r.Divider,{})})]}),n!==i.RECEIPT&&(0,a.jsxs)(r.Grid,{item:!0,xs:4,children:[(0,a.jsx)(r.Typography,{variant:"body2",align:"center",children:(0,a.jsx)("strong",{children:"會計"})}),(0,a.jsx)(r.Box,{mt:4,textAlign:"center",children:(0,a.jsx)(r.Divider,{})})]}),(0,a.jsxs)(r.Grid,{item:!0,xs:n!==i.RECEIPT?4:8,children:[(0,a.jsx)(r.Typography,{variant:"body2",align:"center",children:(0,a.jsx)("strong",{children:"收受人"})}),(0,a.jsx)(r.Box,{mt:4,textAlign:"center",children:(0,a.jsx)(r.Divider,{})})]})]})})]})]})}},37362:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=n(859325),o=n(409938),c=n(64545),d=n(500523),m=n(407514),u=a(n(825734)),h=a(n(455549)),x=n(484976);var p;!function(e){e.INVOICE2="invoice2",e.INVOICE3="invoice3",e.RECEIPT="receipt"}(p||(p={}));t.default=({investments:e})=>{const[t,n]=(0,l.useState)((new Date).getFullYear()),[a,g]=(0,l.useState)([]),[y,j]=(0,l.useState)(!0),[b,v]=(0,l.useState)(null),[f,T]=(0,l.useState)(!1),[S,C]=(0,l.useState)(!1),[I,w]=(0,l.useState)(null),[D,P]=(0,l.useState)({type:p.RECEIPT,paymentId:"",buyerName:"",buyerTaxId:"",amount:0,itemName:"租金收入",date:(new Date).toISOString().split("T")[0],copies:1,note:"",investmentId:""}),{enqueueSnackbar:N}=(0,m.useSnackbar)(),A=(0,x.useNavigate)();(0,l.useEffect)((()=>{R()}),[t]);const R=async()=>{j(!0);try{const e=(await c.ApiService.getRentalPayments(void 0,t)).filter((e=>e.status===o.PaymentStatus.PAID)),n=await c.ApiService.getInvoices(),a=e.map((e=>{const t=n.filter((t=>t.paymentId===e.id));return{...e,invoices:t}}));g(a)}catch(e){v("載入資料失敗")}finally{j(!1)}},E=async e=>{if(I){C(!1);try{const t=await c.ApiService.getRentalStandards(I.investmentId),n=new Date(I.year,I.month-1,1),a=t.find((e=>{const t=new Date(e.startDate),a=e.endDate?new Date(e.endDate):new Date("9999-12-31");return t<=n&&n<=a}));let r={renterName:"",renterTaxId:""};if(a)r.renterName=a.renterName||"",r.renterTaxId=a.renterTaxId||"";else if(t.length>0){const e=t.sort(((e,t)=>new Date(t.startDate).getTime()-new Date(e.startDate).getTime()))[0];r.renterName=e.renterName||"",r.renterTaxId=e.renterTaxId||""}P({type:e,paymentId:I.id,buyerName:I.renterName||r.renterName,buyerTaxId:I.renterTaxId||r.renterTaxId,amount:I.amount,itemName:"租金收入",date:(new Date).toISOString().split("T")[0],copies:1,note:`${I.year}年${I.month}月租金`,investmentId:I.investmentId}),T(!0)}catch(t){console.error("載入租賃標準資訊失敗:",t),P({type:e,paymentId:I.id,buyerName:I.renterName||"",buyerTaxId:I.renterTaxId||"",amount:I.amount,itemName:"租金收入",date:(new Date).toISOString().split("T")[0],copies:1,note:`${I.year}年${I.month}月租金`,investmentId:I.investmentId}),T(!0)}}},k=()=>{T(!1),w(null)},M=e=>t=>{P({...D,[e]:t.target.value})},B=e=>t=>{P({...D,[e]:Number(t.target.value)})},O=t=>{const n=e.find((e=>e.id===t));return n?n.name:"未知項目"};return y?(0,r.jsx)(u.default,{}):b?(0,r.jsx)(h.default,{message:b}):(0,r.jsxs)(i.Box,{children:[(0,r.jsxs)(i.Box,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(i.Typography,{variant:"h6",children:"發票管理"}),(0,r.jsxs)(i.FormControl,{sx:{minWidth:120},children:[(0,r.jsx)(i.InputLabel,{id:"year-select-label",children:"年度"}),(0,r.jsx)(i.Select,{labelId:"year-select-label",id:"year-select",value:t,label:"年度",onChange:e=>n(Number(e.target.value)),children:Array.from({length:5},((e,t)=>(new Date).getFullYear()-2+t)).map((e=>(0,r.jsx)(i.MenuItem,{value:e,children:e},e)))})]})]}),(0,r.jsx)(i.TableContainer,{component:i.Paper,children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHead,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"投資項目"}),(0,r.jsx)(i.TableCell,{children:"年月"}),(0,r.jsx)(i.TableCell,{children:"金額"}),(0,r.jsx)(i.TableCell,{children:"發票狀態"}),(0,r.jsx)(i.TableCell,{children:"已開立類型"}),(0,r.jsx)(i.TableCell,{children:"操作"})]})}),(0,r.jsx)(i.TableBody,{children:0===a.length?(0,r.jsx)(i.TableRow,{children:(0,r.jsx)(i.TableCell,{colSpan:6,align:"center",children:"無資料"})}):a.map((e=>{const t=e.hasInvoice,n=e.invoices?e.invoices.map((e=>e.type)):[],a=!n.includes(p.INVOICE2),l=!n.includes(p.INVOICE3),o=!n.includes(p.RECEIPT);return(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:O(e.investmentId)}),(0,r.jsx)(i.TableCell,{children:`${e.year}年${e.month}月`}),(0,r.jsx)(i.TableCell,{children:(0,d.formatCurrency)(e.amount)}),(0,r.jsx)(i.TableCell,{children:t?"已開立":"未開立"}),(0,r.jsx)(i.TableCell,{children:n.length>0?(0,r.jsx)(i.Box,{children:n.map((e=>(0,r.jsx)(i.Chip,{label:e===p.INVOICE2?"二聯式發票":e===p.INVOICE3?"三聯式發票":"收據",size:"small",sx:{mr:.5,mb:.5}},e)))}):"無"}),(0,r.jsx)(i.TableCell,{children:(0,r.jsxs)(i.Box,{sx:{display:"flex",gap:1},children:[(a||l||o)&&(0,r.jsx)(i.Button,{variant:"outlined",size:"small",onClick:()=>(async e=>{w(e),C(!0)})(e),children:"開立發票/收據"}),e.invoices&&e.invoices.map((e=>(0,r.jsxs)(i.Box,{sx:{display:"flex",gap:.5},children:[(0,r.jsx)(i.Tooltip,{title:"列印"+(e.type===p.RECEIPT?"收據":"發票"),children:(0,r.jsx)(i.IconButton,{size:"small",onClick:()=>(async(e,t)=>{try{A(`/investment/invoice/print/${t}`)}catch(e){N("列印失敗",{variant:"error"})}})(0,e.id,e.type),children:(0,r.jsx)(s.Print,{fontSize:"small"})})}),(0,r.jsx)(i.Tooltip,{title:"刪除"+(e.type===p.RECEIPT?"收據":"發票"),children:(0,r.jsx)(i.IconButton,{size:"small",color:"error",onClick:()=>(async e=>{try{window.confirm("確定要刪除此發票/收據嗎？")&&(await c.ApiService.deleteInvoice(e),N("刪除成功",{variant:"success"}),R())}catch(e){N("刪除失敗",{variant:"error"})}})(e.id),children:(0,r.jsx)(s.Delete,{fontSize:"small"})})})]},e.id)))]})})]},e.id)}))})]})}),(0,r.jsxs)(i.Dialog,{open:f,onClose:k,maxWidth:"sm",fullWidth:!0,children:[(0,r.jsxs)(i.DialogTitle,{children:["開立",D.type===p.RECEIPT?"收據":"發票"]}),(0,r.jsx)(i.DialogContent,{children:(0,r.jsxs)(i.Grid,{container:!0,spacing:2,sx:{mt:1},children:[(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsxs)(i.FormControl,{fullWidth:!0,required:!0,children:[(0,r.jsx)(i.InputLabel,{id:"invoice-type-label",children:"類型"}),(0,r.jsxs)(i.Select,{labelId:"invoice-type-label",id:"invoice-type",name:"type",value:D.type,label:"類型",onChange:(_="type",e=>{P({...D,[_]:e.target.value})}),children:[(0,r.jsx)(i.MenuItem,{value:p.INVOICE2,children:"二聯式發票"}),(0,r.jsx)(i.MenuItem,{value:p.INVOICE3,children:"三聯式發票"}),(0,r.jsx)(i.MenuItem,{value:p.RECEIPT,children:"收據"})]})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"buyer-name",name:"buyerName",label:"買受人名稱",value:D.buyerName,onChange:M("buyerName"),required:!0})}),D.type!==p.RECEIPT&&(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"buyer-tax-id",name:"buyerTaxId",label:"統一編號",value:D.buyerTaxId,onChange:M("buyerTaxId"),required:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"item-name",name:"itemName",label:"品名",value:D.itemName,onChange:M("itemName"),required:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"amount",name:"amount",label:"金額",type:"number",value:D.amount,onChange:B("amount"),required:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"date",name:"date",label:"日期",type:"date",value:D.date,onChange:M("date"),InputLabelProps:{shrink:!0},required:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"copies",name:"copies",label:"份數",type:"number",value:D.copies,onChange:B("copies"),required:!0,inputProps:{min:1}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"note",name:"note",label:"備註",multiline:!0,rows:3,value:D.note,onChange:M("note")})})]})}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:k,children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{try{if(!I)return;if(!D.buyerName)return void N("請輸入買受人名稱",{variant:"error"});if(D.type!==p.RECEIPT&&!D.buyerTaxId)return void N("請輸入統一編號",{variant:"error"});await c.ApiService.createInvoice({type:D.type,paymentId:D.paymentId,buyerName:D.buyerName,buyerTaxId:D.buyerTaxId,amount:D.amount,itemName:D.itemName,date:D.date,note:D.note,investmentId:D.investmentId}),N("發票建立成功",{variant:"success"}),k(),R()}catch(e){N("發票建立失敗",{variant:"error"})}},variant:"contained",children:"確認"})]})]}),(0,r.jsxs)(i.Dialog,{open:S,onClose:()=>C(!1),maxWidth:"xs",fullWidth:!0,children:[(0,r.jsx)(i.DialogTitle,{children:"選擇開立類型"}),(0,r.jsx)(i.DialogContent,{children:(0,r.jsxs)(i.Grid,{container:!0,spacing:2,sx:{mt:1},children:[I&&I.invoices&&(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsxs)(i.Typography,{variant:"body2",color:"text.secondary",children:["已開立類型：",I.invoices.map((e=>(0,r.jsx)(i.Chip,{label:e.type===p.INVOICE2?"二聯式發票":e.type===p.INVOICE3?"三聯式發票":"收據",size:"small",sx:{ml:1}},e.type)))]})}),I&&(0,r.jsxs)(r.Fragment,{children:[I.invoices&&I.invoices.some((e=>e.type===p.INVOICE2))?null:(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.Button,{fullWidth:!0,variant:"outlined",onClick:()=>E(p.INVOICE2),children:"二聯式發票"})}),I.invoices&&I.invoices.some((e=>e.type===p.INVOICE3))?null:(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.Button,{fullWidth:!0,variant:"outlined",onClick:()=>E(p.INVOICE3),children:"三聯式發票"})}),I.invoices&&I.invoices.some((e=>e.type===p.RECEIPT))?null:(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.Button,{fullWidth:!0,variant:"outlined",onClick:()=>E(p.RECEIPT),children:"收據"})})]})]})}),(0,r.jsx)(i.DialogActions,{children:(0,r.jsx)(i.Button,{onClick:()=>C(!1),children:"取消"})})]})]});var _}},46056:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=a(n(549140)),o=a(n(381894)),c=a(n(502505)),d=a(n(749443)),m=a(n(69441)),u=n(64545);function h(e){const{children:t,value:n,index:a,...l}=e;return(0,r.jsx)("div",{role:"tabpanel",hidden:n!==a,id:`rental-tabpanel-${a}`,"aria-labelledby":`rental-tab-${a}`,...l,children:n===a&&(0,r.jsx)(i.Box,{sx:{p:3},children:t})})}t.default=({initialTab:e=0})=>{const[t,n]=(0,l.useState)(e),[a,x]=(0,l.useState)([]);(0,l.useEffect)((()=>{p()}),[]),(0,l.useEffect)((()=>{void 0!==e&&n(e)}),[e]);const p=async()=>{try{const e=await u.ApiService.getInvestments();x(e)}catch(e){console.error("載入投資項目失敗:",e)}};return(0,r.jsx)(i.Box,{sx:{width:"100%"},children:(0,r.jsxs)(i.Paper,{sx:{width:"100%",mb:2},children:[(0,r.jsx)(i.Box,{sx:{borderBottom:1,borderColor:"divider"},children:(0,r.jsxs)(i.Tabs,{value:t,onChange:(e,t)=>{n(t)},"aria-label":"租賃與分潤管理標籤",children:[(0,r.jsx)(i.Tab,{label:"租賃標準設定"}),(0,r.jsx)(i.Tab,{label:"分潤標準設定"}),(0,r.jsx)(i.Tab,{label:"租金收款管理"}),(0,r.jsx)(i.Tab,{label:"會員分潤管理"}),(0,r.jsx)(i.Tab,{label:"統計報表"})]})}),(0,r.jsx)(h,{value:t,index:0,children:(0,r.jsx)(s.default,{investments:a})}),(0,r.jsx)(h,{value:t,index:1,children:(0,r.jsx)(o.default,{investments:a})}),(0,r.jsx)(h,{value:t,index:2,children:(0,r.jsx)(c.default,{investments:a})}),(0,r.jsx)(h,{value:t,index:3,children:(0,r.jsx)(d.default,{investments:a})}),(0,r.jsx)(h,{value:t,index:4,children:(0,r.jsx)(m.default,{investments:a})})]})})}},64545:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ApiServiceInstance=t.ApiService=t.AuthService=void 0;var a=n(428526);Object.defineProperty(t,"AuthService",{enumerable:!0,get:function(){return a.AuthService}});var r=n(583380);Object.defineProperty(t,"ApiService",{enumerable:!0,get:function(){return r.ApiService}}),Object.defineProperty(t,"ApiServiceInstance",{enumerable:!0,get:function(){return r.ApiServiceInstance}})},65980:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateMemberNo=t.USER_ROLE_PREFIX=void 0,t.USER_ROLE_PREFIX={normal:"C",business:"B",lifetime:"L",admin:"A"};t.generateMemberNo=async(e,n)=>`${t.USER_ROLE_PREFIX[e]}${String(n+1).padStart(3,"0")}`},69441:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=n(409938),o=n(64545),c=n(500523),d=a(n(825734)),m=a(n(455549));t.default=({investments:e})=>{const[t,n]=(0,l.useState)([]),[a,u]=(0,l.useState)([]),[h,x]=(0,l.useState)(!0),[p,g]=(0,l.useState)(null),[y,j]=(0,l.useState)((new Date).getFullYear());(0,l.useEffect)((()=>{b()}),[y]);const b=async()=>{x(!0);try{const[e,t,a]=await Promise.all([o.ApiService.getInvestments(),o.ApiService.getRentalPayments(void 0,y),o.ApiService.getMemberProfits(void 0,void 0,y)]);n(t),u(a)}catch(e){g("載入資料失敗")}finally{x(!1)}};if(h)return(0,r.jsx)(d.default,{});if(p)return(0,r.jsx)(m.default,{message:p});const v={totalRental:t.reduce(((e,t)=>t.year===y?e+t.amount:e),0),collectedRental:t.filter((e=>e.status===s.PaymentStatus.PAID&&e.year===y)).reduce(((e,t)=>e+t.amount),0),pendingRental:t.filter((e=>e.status===s.PaymentStatus.PENDING&&e.year===y)).reduce(((e,t)=>e+t.amount),0),overdueRental:t.filter((e=>e.status===s.PaymentStatus.OVERDUE&&e.year===y)).reduce(((e,t)=>e+t.amount),0)},f={totalProfit:a.reduce(((e,t)=>t.year===y?e+t.amount:e),0),paidProfit:a.filter((e=>e.status===s.PaymentStatus.PAID&&e.year===y)).reduce(((e,t)=>e+t.amount),0),pendingProfit:a.filter((e=>e.status===s.PaymentStatus.PENDING&&e.year===y)).reduce(((e,t)=>e+t.amount),0),overdueProfit:a.filter((e=>e.status===s.PaymentStatus.OVERDUE&&e.year===y)).reduce(((e,t)=>e+t.amount),0)},T=e.map((e=>{const n=t.filter((t=>t.investmentId===e.id&&t.year===y)),r=a.filter((t=>t.investmentId===e.id&&t.year===y)),l=n.reduce(((e,t)=>e+t.amount),0),i=n.filter((e=>e.status===s.PaymentStatus.PAID)).reduce(((e,t)=>e+t.amount),0),o=r.reduce(((e,t)=>e+t.amount),0),c=r.filter((e=>e.status===s.PaymentStatus.PAID)).reduce(((e,t)=>e+t.amount),0);return{investment:e,totalRental:l,collectedRental:i,totalProfit:o,paidProfit:c,netIncome:i-c}}));return(0,r.jsxs)(i.Box,{children:[(0,r.jsxs)(i.Box,{sx:{mb:2,display:"flex",alignItems:"center"},children:[(0,r.jsx)(i.Typography,{variant:"h6",sx:{flexGrow:1},children:"統計報表"}),(0,r.jsxs)(i.FormControl,{sx:{minWidth:100},children:[(0,r.jsx)(i.InputLabel,{children:"年度"}),(0,r.jsx)(i.Select,{value:y.toString(),label:"年度",onChange:e=>j(Number(e.target.value)),children:Array.from({length:5},((e,t)=>(new Date).getFullYear()-2+t)).map((e=>(0,r.jsx)(i.MenuItem,{value:e,children:e},e)))})]})]}),(0,r.jsxs)(i.Grid,{container:!0,spacing:2,children:[(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsxs)(i.Paper,{sx:{p:2},children:[(0,r.jsx)(i.Typography,{variant:"h6",gutterBottom:!0,children:"租金收款統計"}),(0,r.jsx)(i.Table,{size:"small",children:(0,r.jsxs)(i.TableBody,{children:[(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"總租金"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(v.totalRental)})]}),(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"已收款"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(v.collectedRental)})]}),(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"待收款"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(v.pendingRental)})]}),(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"逾期未收"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(v.overdueRental)})]})]})})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsxs)(i.Paper,{sx:{p:2},children:[(0,r.jsx)(i.Typography,{variant:"h6",gutterBottom:!0,children:"會員分潤統計"}),(0,r.jsx)(i.Table,{size:"small",children:(0,r.jsxs)(i.TableBody,{children:[(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"總分潤"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(f.totalProfit)})]}),(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"已發放"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(f.paidProfit)})]}),(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"待發放"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(f.pendingProfit)})]}),(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"逾期未發"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(f.overdueProfit)})]})]})})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.Paper,{sx:{mt:2},children:(0,r.jsx)(i.TableContainer,{children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHead,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"投資項目"}),(0,r.jsx)(i.TableCell,{align:"right",children:"總租金"}),(0,r.jsx)(i.TableCell,{align:"right",children:"已收租金"}),(0,r.jsx)(i.TableCell,{align:"right",children:"總分潤"}),(0,r.jsx)(i.TableCell,{align:"right",children:"已發放分潤"}),(0,r.jsx)(i.TableCell,{align:"right",children:"淨收入"})]})}),(0,r.jsxs)(i.TableBody,{children:[T.map((e=>(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:e.investment.name}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(e.totalRental)}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(e.collectedRental)}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(e.totalProfit)}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(e.paidProfit)}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(e.netIncome)})]},e.investment.id))),(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{sx:{fontWeight:"bold"},children:"總計"}),(0,r.jsx)(i.TableCell,{align:"right",sx:{fontWeight:"bold"},children:(0,c.formatCurrency)(T.reduce(((e,t)=>e+t.totalRental),0))}),(0,r.jsx)(i.TableCell,{align:"right",sx:{fontWeight:"bold"},children:(0,c.formatCurrency)(T.reduce(((e,t)=>e+t.collectedRental),0))}),(0,r.jsx)(i.TableCell,{align:"right",sx:{fontWeight:"bold"},children:(0,c.formatCurrency)(T.reduce(((e,t)=>e+t.totalProfit),0))}),(0,r.jsx)(i.TableCell,{align:"right",sx:{fontWeight:"bold"},children:(0,c.formatCurrency)(T.reduce(((e,t)=>e+t.paidProfit),0))}),(0,r.jsx)(i.TableCell,{align:"right",sx:{fontWeight:"bold"},children:(0,c.formatCurrency)(T.reduce(((e,t)=>e+t.netIncome),0))})]})]})]})})})})]})]})}},78577:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(484976),s=n(264456),o=n(445759),c=n(137181),d=a(n(567942)),m=n(332584),u=a(n(236465)),h=n(209965),x=a(n(807273)),p=n(407514);t.default=()=>((0,l.useEffect)((()=>{h.storageService.initialize()}),[]),(0,r.jsx)(i.HashRouter,{children:(0,r.jsxs)(s.ThemeProvider,{theme:u.default,children:[(0,r.jsx)(s.CssBaseline,{}),(0,r.jsx)(m.AuthProvider,{children:(0,r.jsx)(o.LocalizationProvider,{dateAdapter:c.AdapterDateFns,adapterLocale:d.default,children:(0,r.jsx)(p.SnackbarProvider,{maxSnack:3,children:(0,r.jsx)(x.default,{})})})})]})}))},94644:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.memberService=void 0;t.memberService=new class{constructor(){this.members=[]}async getMembers(){return this.members}async getMemberById(e){return(await this.getMembers()).find((t=>t.id===e))}}},99748:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(264456),i=n(332584),s=a(n(517192)),o=a(n(750701)),c=a(n(800232));t.default=({children:e})=>{const{isAuthenticated:t}=(0,i.useAuth)();return t?(0,r.jsxs)(l.Box,{sx:{display:"flex",minHeight:"100vh"},children:[(0,r.jsx)(o.default,{}),(0,r.jsx)(s.default,{}),(0,r.jsx)(l.Box,{component:"main",sx:{flexGrow:1,p:3,marginLeft:"240px",marginTop:"64px",backgroundColor:"#f5f5f5",minHeight:"calc(100vh - 64px)",overflow:"auto",position:"relative"},children:e})]}):(0,r.jsx)(c.default,{})}},135630:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentIssue=void 0;const a=n(474848),r=n(296540),l=n(264456),i=n(491178),s=n(859325),o=n(189915);n(221701);t.DocumentIssue=({memberId:e,memberName:t,paymentId:n,amount:c,onSuccess:d})=>{const[m,u]=(0,r.useState)(!1),[h,x]=(0,r.useState)("二聯式"),[p,g]=(0,r.useState)([{description:"會員年費",quantity:1,unitPrice:c,amount:c}]),[y,j]=(0,r.useState)({name:"",taxId:""}),[b,v]=(0,r.useState)(new Date),[f,T]=(0,r.useState)({open:!1,message:"",severity:"success"}),S=o.invoiceService.getCompanyInfo(),C=()=>u(!1),I=(e,t,n)=>{const a=[...p];if("quantity"===t||"unitPrice"===t){const r="quantity"===t?Number(n):p[e].quantity,l="unitPrice"===t?Number(n):p[e].unitPrice;a[e]={...a[e],[t]:Number(n),amount:r*l}}else a[e]={...a[e],[t]:n};g(a)},w=()=>p.reduce(((e,t)=>e+t.amount),0),D=()=>Math.round(.05*w());return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Button,{variant:"contained",color:"primary",onClick:()=>u(!0),children:"開立發票/收據"}),(0,a.jsxs)(l.Dialog,{open:m,onClose:C,maxWidth:"md",fullWidth:!0,keepMounted:!1,disablePortal:!0,children:[(0,a.jsx)(l.DialogTitle,{children:"開立發票/收據"}),(0,a.jsx)(l.DialogContent,{children:(0,a.jsx)(l.Box,{sx:{mt:2},children:(0,a.jsxs)(l.Grid,{container:!0,spacing:2,children:[(0,a.jsx)(l.Grid,{item:!0,xs:12,md:6,children:(0,a.jsxs)(l.FormControl,{fullWidth:!0,children:[(0,a.jsx)(l.InputLabel,{children:"類型"}),(0,a.jsxs)(l.Select,{value:h,label:"類型",onChange:e=>x(e.target.value),children:[(0,a.jsx)(l.MenuItem,{value:"二聯式",children:"二聯式發票（存根聯、收執聯）"}),(0,a.jsx)(l.MenuItem,{value:"三聯式",children:"三聯式發票（存根聯、報帳聯、扣抵聯）"}),(0,a.jsx)(l.MenuItem,{value:"收據",children:"收據"})]})]})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,md:6,children:(0,a.jsx)(i.DatePicker,{label:"開立日期",value:b,onChange:e=>v(e),format:"yyyy/MM/dd",slotProps:{textField:{fullWidth:!0}}})}),"收據"!==h&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsx)(l.Typography,{variant:"h6",children:"賣方資訊"})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,md:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"公司名稱",value:S.name})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,md:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"統一編號",value:S.taxId})})]}),"三聯式"===h&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsx)(l.Typography,{variant:"h6",children:"買方資訊"})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,md:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"公司名稱",value:y.name,onChange:e=>j({...y,name:e.target.value})})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,md:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"統一編號",value:y.taxId,onChange:e=>j({...y,taxId:e.target.value})})})]}),(0,a.jsxs)(l.Grid,{item:!0,xs:12,children:[(0,a.jsxs)(l.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,a.jsx)(l.Typography,{variant:"h6",children:"商品明細"}),"收據"!==h&&(0,a.jsx)(l.Button,{startIcon:(0,a.jsx)(s.Add,{}),onClick:()=>{g([...p,{description:"",quantity:1,unitPrice:0,amount:0}])},children:"新增項目"})]}),(0,a.jsx)(l.TableContainer,{component:l.Paper,children:(0,a.jsxs)(l.Table,{children:[(0,a.jsx)(l.TableHead,{children:(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:"品名"}),(0,a.jsx)(l.TableCell,{align:"right",children:"數量"}),(0,a.jsx)(l.TableCell,{align:"right",children:"單價"}),(0,a.jsx)(l.TableCell,{align:"right",children:"金額"}),"收據"!==h&&(0,a.jsx)(l.TableCell,{align:"right",children:"操作"})]})}),(0,a.jsx)(l.TableBody,{children:p.map(((e,t)=>(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:(0,a.jsx)(l.TextField,{fullWidth:!0,value:e.description,onChange:e=>I(t,"description",e.target.value)})}),(0,a.jsx)(l.TableCell,{align:"right",children:(0,a.jsx)(l.TextField,{type:"number",value:e.quantity,onChange:e=>I(t,"quantity",e.target.value),disabled:"收據"===h,sx:{width:100}})}),(0,a.jsx)(l.TableCell,{align:"right",children:(0,a.jsx)(l.TextField,{type:"number",value:e.unitPrice,onChange:e=>I(t,"unitPrice",e.target.value),disabled:"收據"===h,sx:{width:100}})}),(0,a.jsx)(l.TableCell,{align:"right",children:e.amount.toLocaleString()}),"收據"!==h&&(0,a.jsx)(l.TableCell,{align:"right",children:(0,a.jsx)(l.IconButton,{onClick:()=>(e=>{g(p.filter(((t,n)=>n!==e)))})(t),disabled:1===p.length,children:(0,a.jsx)(s.Delete,{})})})]},t)))})]})})]}),(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsxs)(l.Box,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:[(0,a.jsxs)(l.Typography,{variant:"h6",sx:{mr:2},children:["總計：",w().toLocaleString()]}),"收據"!==h&&(0,a.jsxs)(l.Typography,{variant:"h6",sx:{mr:2},children:["營業稅：",D().toLocaleString()]}),(0,a.jsxs)(l.Typography,{variant:"h6",children:["總金額：",(w()+("收據"!==h?D():0)).toLocaleString()]})]})})]})})}),(0,a.jsxs)(l.DialogActions,{children:[(0,a.jsx)(l.Button,{onClick:C,children:"取消"}),(0,a.jsx)(l.Button,{onClick:async()=>{if(b)try{const a=b.toISOString().split("T")[0];"收據"===h?await o.invoiceService.createReceipt({type:"收據",memberId:e,memberName:t,paymentId:n,payerName:t,description:p[0].description,amount:w(),date:a,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}):await o.invoiceService.createInvoice({type:h,memberId:e,memberName:t,paymentId:n,sellerName:S.name,sellerTaxId:S.taxId,buyerName:"三聯式"===h?y.name:void 0,buyerTaxId:"三聯式"===h?y.taxId:void 0,items:p,amount:w(),taxAmount:D(),date:a,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}),T({open:!0,message:"開立成功",severity:"success"}),d(),C()}catch(e){console.error("開立失敗:",e),T({open:!0,message:"開立失敗",severity:"error"})}else T({open:!0,message:"請選擇開立日期",severity:"error"})},variant:"contained",color:"primary",children:"確認開立"})]})]}),(0,a.jsx)(l.Snackbar,{open:f.open,autoHideDuration:6e3,onClose:()=>T({...f,open:!1}),children:(0,a.jsx)(l.Alert,{onClose:()=>T({...f,open:!1}),severity:f.severity,sx:{width:"100%"},children:f.message})})]})}},189915:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.invoiceService=void 0;const a=n(209965);t.invoiceService=new class{constructor(){this.lastInvoiceNumber={二聯式:0,三聯式:0};const e=localStorage.getItem("lastInvoiceNumbers");e&&(this.lastInvoiceNumber=JSON.parse(e))}generateInvoiceNumber(e){return this.lastInvoiceNumber[e]+=1,localStorage.setItem("lastInvoiceNumbers",JSON.stringify(this.lastInvoiceNumber)),`AB-${this.lastInvoiceNumber[e].toString().padStart(8,"0")}`}generateReceiptNumber(){return`R-${Date.now()}`}async createInvoice(e){const t=this.generateInvoiceNumber(e.type),n={...e,id:`invoice-${Date.now()}`,invoiceNumber:t};return await this.saveDocument(n),n}async createReceipt(e){const t=this.generateReceiptNumber(),n={...e,id:`receipt-${Date.now()}`,receiptNumber:t};return await this.saveDocument(n),n}async saveDocument(e){const t=await this.getDocuments({});t.push(e),await a.storageService.updateData("documents",t)}async getDocuments(e){const t=await a.storageService.getData("documents")||[];return e.memberId?t.filter((t=>t.memberId===e.memberId)):t}getCompanyInfo(){return{name:"測試公司",taxId:"12345678"}}async deleteDocument(e){const t=(await this.getDocuments({})).filter((t=>t.id!==e));await a.storageService.updateData("documents",t)}}},209965:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.storageService=void 0;const n={documents:[],feeHistory:[],feeSettings:[],paymentStatuses:[]},a="asset_management_data";t.storageService=new class{constructor(){this.storage=n}async getData(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return console.error("讀取資料失敗:",e),null}}async updateData(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){throw console.error("更新資料失敗:",e),e}}async clearData(e){try{localStorage.removeItem(e)}catch(e){throw console.error("清除資料失敗:",e),e}}async initialize(){try{localStorage.getItem(a)||localStorage.setItem(a,JSON.stringify(n))}catch(e){throw console.error("初始化儲存空間失敗:",e),e}}},t.storageService.initialize().catch((e=>{console.error("初始化儲存空間失敗:",e)}))},221400:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=n(859325),o=n(583380),c=a(n(733274));t.default=()=>{const[e,t]=(0,l.useState)([]),[n,a]=(0,l.useState)(null),[d,m]=(0,l.useState)(!1),[u,h]=(0,l.useState)(!1),[x,p]=(0,l.useState)(null),[g,y]=(0,l.useState)(""),[j,b]=(0,l.useState)("all"),[v,f]=(0,l.useState)("all"),[T,S]=(0,l.useState)([]),C=async()=>{try{h(!0),p(null);const e=await o.ApiService.getUsers();t(e||[])}catch(e){p("載入會員資料失敗"),console.error("載入會員資料失敗:",e)}finally{h(!1)}};(0,l.useEffect)((()=>{C(),(async()=>{try{const e=await o.ApiService.getCompanies();S(e)}catch(e){console.error("載入公司資料失敗:",e)}})()}),[]);const I=e=>{switch(e){case"admin":return"管理員";case"normal":return"一般會員";case"business":return"商務會員";case"lifetime":return"永久會員";default:return e}},w=e=>{switch(e){case"admin":return"success";case"business":case"normal":case"lifetime":return"info";default:return"default"}},D=e=>{switch(e){case"active":return"啟用";case"inactive":return"停用";case"suspended":return"暫停";default:return e}},P=e=>{if(!e)return"-";const t=T.find((t=>t.id===e));return t?t.name:"-"},N=e.filter((e=>{const t=e.username.toLowerCase().includes(g.toLowerCase())||e.name.toLowerCase().includes(g.toLowerCase())||e.email.toLowerCase().includes(g.toLowerCase()),n="all"===j||e.role===j,a="all"===v||e.status===v;return t&&n&&a}));return u&&0===e.length?(0,r.jsx)(i.Box,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,r.jsx)(i.CircularProgress,{})}):(0,r.jsxs)(i.Box,{children:[(0,r.jsxs)(i.Box,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,r.jsx)(i.Typography,{variant:"h5",children:"會員管理"}),(0,r.jsx)(i.Button,{variant:"contained",startIcon:(0,r.jsx)(s.Add,{}),onClick:()=>{a(null),m(!0)},children:"新增會員"})]}),x&&(0,r.jsx)(i.Alert,{severity:"error",sx:{mb:3},children:x}),(0,r.jsx)(i.TableContainer,{component:i.Paper,children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHead,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"會員編號"}),(0,r.jsx)(i.TableCell,{children:"姓名"}),(0,r.jsx)(i.TableCell,{children:"電子郵件"}),(0,r.jsx)(i.TableCell,{children:"角色"}),(0,r.jsx)(i.TableCell,{children:"所屬公司"}),(0,r.jsx)(i.TableCell,{children:"狀態"}),(0,r.jsx)(i.TableCell,{children:"操作"})]})}),(0,r.jsxs)(i.TableBody,{children:[N.map((e=>(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:e.memberNo}),(0,r.jsx)(i.TableCell,{children:e.name}),(0,r.jsx)(i.TableCell,{children:e.email}),(0,r.jsx)(i.TableCell,{children:(0,r.jsx)(i.Chip,{label:I(e.role),color:w(e.role),size:"small"})}),(0,r.jsx)(i.TableCell,{children:P(e.companyId)}),(0,r.jsx)(i.TableCell,{children:(0,r.jsx)(i.Chip,{label:D(e.status),color:"active"===e.status?"success":"error",size:"small"})}),(0,r.jsx)(i.TableCell,{children:(0,r.jsx)(i.Tooltip,{title:"編輯",children:(0,r.jsx)(i.IconButton,{size:"small",onClick:()=>(e=>{a(e),m(!0)})(e),children:(0,r.jsx)(s.Edit,{})})})})]},e.id))),0===N.length&&(0,r.jsx)(i.TableRow,{children:(0,r.jsx)(i.TableCell,{colSpan:6,align:"center",children:"尚無會員資料"})})]})]})}),(0,r.jsx)(c.default,{open:d,onClose:()=>{m(!1),a(null)},onSave:async e=>{try{let t;h(!0),p(null),console.log("Saving user:",e),e.id?(t=await o.ApiService.updateUser(e),console.log("Updated user result:",t)):(t=await o.ApiService.createUser(e),console.log("Created user result:",t)),await C(),m(!1),a(null)}catch(e){console.error("保存會員資料失敗:",e),p(e instanceof Error?e.message:"保存會員資料失敗")}finally{h(!1)}},user:n})]})}},221701:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.documentService=t.DocumentService=void 0;const a=n(163462),r=n(4213),l=n(785739),i=n(801460),s=n(163462);class o{constructor(){this.lastInvoiceNumber={二聯式:0,三聯式:0}}async generateInvoiceNumber(e){const t=localStorage.getItem(`lastInvoiceNumber_${e}`);let n=t?parseInt(t):0;return n+=1,localStorage.setItem(`lastInvoiceNumber_${e}`,n.toString()),`AB-${n.toString().padStart(8,"0")}`}createInvoicePage(e,t){return new a.Document({sections:[{properties:{},children:[new a.Paragraph({children:[new a.TextRun({text:`${e.type}發票 - ${t}`,bold:!0,size:24})],alignment:"center"}),new a.Paragraph({children:[new a.TextRun({text:`發票號碼：${e.invoiceNumber}`,size:20})]}),new a.Paragraph({children:[new a.TextRun({text:`開立日期：${e.date}`,size:20})]}),new a.Table({rows:[new a.TableRow({children:[new a.TableCell({children:[new a.Paragraph({text:"品名"})],width:{size:40,type:"pct"}}),new a.TableCell({children:[new a.Paragraph({text:"數量"})],width:{size:20,type:"pct"}}),new a.TableCell({children:[new a.Paragraph({text:"單價"})],width:{size:20,type:"pct"}}),new a.TableCell({children:[new a.Paragraph({text:"金額"})],width:{size:20,type:"pct"}})]}),...e.items.map((e=>new a.TableRow({children:[new a.TableCell({children:[new a.Paragraph({text:e.description})]}),new a.TableCell({children:[new a.Paragraph({text:e.quantity.toString()})]}),new a.TableCell({children:[new a.Paragraph({text:e.unitPrice.toLocaleString()})]}),new a.TableCell({children:[new a.Paragraph({text:e.amount.toLocaleString()})]})]})))]}),new a.Paragraph({children:[new a.TextRun({text:`總計：${e.amount.toLocaleString()}`,bold:!0,size:20})],alignment:"right"})]}]})}async generateInvoiceDoc(e){return new a.Document({sections:[{properties:{},children:[new a.Paragraph({alignment:a.AlignmentType.CENTER,children:[new a.TextRun({text:`${e.type}發票`,size:32,bold:!0})]}),new a.Paragraph({alignment:a.AlignmentType.RIGHT,children:[new a.TextRun({text:`開立日期：${(0,l.formatDate)(e.date)}`,size:24})]}),new a.Paragraph({children:[new a.TextRun({text:`發票號碼：${e.invoiceNumber}`,size:24})]}),new a.Table({width:{size:100,type:a.WidthType.PERCENTAGE},borders:{top:{style:a.BorderStyle.SINGLE,size:1},bottom:{style:a.BorderStyle.SINGLE,size:1},left:{style:a.BorderStyle.SINGLE,size:1},right:{style:a.BorderStyle.SINGLE,size:1},insideHorizontal:{style:a.BorderStyle.SINGLE,size:1},insideVertical:{style:a.BorderStyle.SINGLE,size:1}},rows:[new a.TableRow({children:[new a.TableCell({width:{size:20,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph("賣方資訊")]}),new a.TableCell({width:{size:80,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph(`名稱：${e.sellerName}`),new a.Paragraph(`統一編號：${e.sellerTaxId}`)]})]}),..."三聯式"===e.type?[new a.TableRow({children:[new a.TableCell({width:{size:20,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph("買方資訊")]}),new a.TableCell({width:{size:80,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph(`名稱：${e.buyerName}`),new a.Paragraph(`統一編號：${e.buyerTaxId}`)]})]})]:[]]}),new a.Paragraph({spacing:{before:(0,a.convertInchesToTwip)(.5)}}),new a.Table({width:{size:100,type:a.WidthType.PERCENTAGE},borders:{top:{style:a.BorderStyle.SINGLE,size:1},bottom:{style:a.BorderStyle.SINGLE,size:1},left:{style:a.BorderStyle.SINGLE,size:1},right:{style:a.BorderStyle.SINGLE,size:1},insideHorizontal:{style:a.BorderStyle.SINGLE,size:1},insideVertical:{style:a.BorderStyle.SINGLE,size:1}},rows:[new a.TableRow({children:[new a.TableCell({width:{size:40,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph({text:"品名",alignment:a.AlignmentType.CENTER})]}),new a.TableCell({width:{size:15,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph({text:"數量",alignment:a.AlignmentType.CENTER})]}),new a.TableCell({width:{size:20,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph({text:"單價",alignment:a.AlignmentType.CENTER})]}),new a.TableCell({width:{size:25,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph({text:"金額",alignment:a.AlignmentType.CENTER})]})]}),...e.items.map((e=>new a.TableRow({children:[new a.TableCell({children:[new a.Paragraph(e.description)]}),new a.TableCell({children:[new a.Paragraph({text:e.quantity.toString(),alignment:a.AlignmentType.RIGHT})]}),new a.TableCell({children:[new a.Paragraph({text:(0,i.formatCurrency)(e.unitPrice),alignment:a.AlignmentType.RIGHT})]}),new a.TableCell({children:[new a.Paragraph({text:(0,i.formatCurrency)(e.amount),alignment:a.AlignmentType.RIGHT})]})]})))]}),new a.Paragraph({alignment:a.AlignmentType.RIGHT,spacing:{before:(0,a.convertInchesToTwip)(.5)},children:[new a.TextRun({text:`小計：${(0,i.formatCurrency)(e.amount)}`,size:24})]}),new a.Paragraph({alignment:a.AlignmentType.RIGHT,children:[new a.TextRun({text:`營業稅：${(0,i.formatCurrency)(e.taxAmount)}`,size:24})]}),new a.Paragraph({alignment:a.AlignmentType.RIGHT,children:[new a.TextRun({text:`總計：${(0,i.formatCurrency)(e.amount+e.taxAmount)}`,size:24,bold:!0})]})]}]})}async generateReceiptDoc(e){return new a.Document({sections:[{properties:{},children:[new a.Paragraph({alignment:a.AlignmentType.CENTER,children:[new a.TextRun({text:"收據",size:32,bold:!0})]}),new a.Paragraph({alignment:a.AlignmentType.RIGHT,children:[new a.TextRun({text:`開立日期：${(0,l.formatDate)(e.date)}`,size:24})]}),new a.Paragraph({children:[new a.TextRun({text:`收據號碼：${e.receiptNumber}`,size:24})]}),new a.Paragraph({spacing:{before:(0,a.convertInchesToTwip)(.5)},children:[new a.TextRun({text:`茲收到 ${e.payerName} 繳納`,size:24})]}),new a.Paragraph({spacing:{before:(0,a.convertInchesToTwip)(.5)},children:[new a.TextRun({text:`${e.description}`,size:24,bold:!0})]}),new a.Paragraph({spacing:{before:(0,a.convertInchesToTwip)(.5)},children:[new a.TextRun({text:`新台幣 ${(0,i.formatCurrency)(e.amount)} 元整`,size:24,bold:!0})]}),new a.Paragraph({spacing:{before:(0,a.convertInchesToTwip)(2)},alignment:a.AlignmentType.RIGHT,children:[new a.TextRun({text:"收款人：",size:24})]})]}]})}async generateDocument(e){let t;return t="invoiceNumber"in e?await this.generateInvoiceDoc(e):await this.generateReceiptDoc(e),await s.Packer.toBlob(t)}async printDocument(e){try{if("收據"===e.type){const t=await this.generateReceiptDoc(e),n=await s.Packer.toBlob(t);(0,r.saveAs)(n,`收據_${e.receiptNumber}.docx`)}else{const t=e,n=("二聯式"===t.type?["存根聯","收執聯"]:["存根聯","報帳聯","扣抵聯"]).map((e=>({properties:{},children:[new a.Paragraph({pageBreakBefore:!0,alignment:a.AlignmentType.CENTER,children:[new a.TextRun({text:`${t.type}發票 - ${e}`,size:32,bold:!0})]}),new a.Paragraph({alignment:a.AlignmentType.RIGHT,children:[new a.TextRun({text:`開立日期：${(0,l.formatDate)(t.date)}`,size:24})]}),new a.Paragraph({children:[new a.TextRun({text:`發票號碼：${t.invoiceNumber}`,size:24})]}),new a.Table({width:{size:100,type:a.WidthType.PERCENTAGE},borders:{top:{style:a.BorderStyle.SINGLE,size:1},bottom:{style:a.BorderStyle.SINGLE,size:1},left:{style:a.BorderStyle.SINGLE,size:1},right:{style:a.BorderStyle.SINGLE,size:1},insideHorizontal:{style:a.BorderStyle.SINGLE,size:1},insideVertical:{style:a.BorderStyle.SINGLE,size:1}},rows:[new a.TableRow({children:[new a.TableCell({width:{size:20,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph("賣方資訊")]}),new a.TableCell({width:{size:80,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph(`名稱：${t.sellerName}`),new a.Paragraph(`統一編號：${t.sellerTaxId}`)]})]}),..."三聯式"===t.type?[new a.TableRow({children:[new a.TableCell({width:{size:20,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph("買方資訊")]}),new a.TableCell({width:{size:80,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph(`名稱：${t.buyerName}`),new a.Paragraph(`統一編號：${t.buyerTaxId}`)]})]})]:[]]}),new a.Paragraph({spacing:{before:(0,a.convertInchesToTwip)(.5)}}),new a.Table({width:{size:100,type:a.WidthType.PERCENTAGE},borders:{top:{style:a.BorderStyle.SINGLE,size:1},bottom:{style:a.BorderStyle.SINGLE,size:1},left:{style:a.BorderStyle.SINGLE,size:1},right:{style:a.BorderStyle.SINGLE,size:1},insideHorizontal:{style:a.BorderStyle.SINGLE,size:1},insideVertical:{style:a.BorderStyle.SINGLE,size:1}},rows:[new a.TableRow({children:[new a.TableCell({width:{size:40,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph({text:"品名",alignment:a.AlignmentType.CENTER})]}),new a.TableCell({width:{size:15,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph({text:"數量",alignment:a.AlignmentType.CENTER})]}),new a.TableCell({width:{size:20,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph({text:"單價",alignment:a.AlignmentType.CENTER})]}),new a.TableCell({width:{size:25,type:a.WidthType.PERCENTAGE},children:[new a.Paragraph({text:"金額",alignment:a.AlignmentType.CENTER})]})]}),...t.items.map((e=>new a.TableRow({children:[new a.TableCell({children:[new a.Paragraph(e.description)]}),new a.TableCell({children:[new a.Paragraph({text:e.quantity.toString(),alignment:a.AlignmentType.RIGHT})]}),new a.TableCell({children:[new a.Paragraph({text:(0,i.formatCurrency)(e.unitPrice),alignment:a.AlignmentType.RIGHT})]}),new a.TableCell({children:[new a.Paragraph({text:(0,i.formatCurrency)(e.amount),alignment:a.AlignmentType.RIGHT})]})]})))]}),new a.Paragraph({alignment:a.AlignmentType.RIGHT,spacing:{before:(0,a.convertInchesToTwip)(.5)},children:[new a.TextRun({text:`小計：${(0,i.formatCurrency)(t.amount)}`,size:24})]}),new a.Paragraph({alignment:a.AlignmentType.RIGHT,children:[new a.TextRun({text:`營業稅：${(0,i.formatCurrency)(t.taxAmount)}`,size:24})]}),new a.Paragraph({alignment:a.AlignmentType.RIGHT,children:[new a.TextRun({text:`總計：${(0,i.formatCurrency)(t.amount+t.taxAmount)}`,size:24,bold:!0})]})]}))),o=new a.Document({sections:n}),c=await s.Packer.toBlob(o);(0,r.saveAs)(c,`發票_${t.invoiceNumber}.docx`)}}catch(e){throw console.error("列印文件失敗:",e),e}}}t.DocumentService=o,t.documentService=new o},229704:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(474848),r=n(296540),l=n(264456),i=n(583380),s=["technology","finance","manufacturing","service","retail","other"];t.default=({open:e,onClose:t,companyData:n,onSave:o})=>{var c,d,m;const[u,h]=(0,r.useState)({companyNo:"",taxId:"",name:"",nameEn:"",industry:"other",address:"",contact:{name:"",phone:"",email:""},fax:"",note:""}),[x,p]=(0,r.useState)({});(0,r.useEffect)((()=>{e&&(async()=>{if(n)h(n);else try{const e=await i.ApiService.getNewCompanyNo();h({companyNo:e,taxId:"",name:"",nameEn:"",industry:"other",address:"",contact:{name:"",phone:"",email:""},fax:"",note:""})}catch(e){console.error("生成公司編號失敗:",e)}p({})})()}),[n,e]);const g=(e,t)=>{if(e.startsWith("contact.")){const n=e.split(".")[1];h((e=>({...e,contact:{...e.contact,[n]:t}})))}else h((n=>({...n,[e]:t})))};return(0,a.jsxs)(l.Dialog,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[(0,a.jsx)(l.DialogTitle,{children:(0,a.jsx)(l.Typography,{children:n?"編輯公司資料":"新增公司"})}),(0,a.jsx)(l.DialogContent,{children:(0,a.jsxs)(l.Grid,{container:!0,spacing:2,sx:{mt:1},children:[(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"公司編號",value:u.companyNo||"",InputProps:{readOnly:!0},helperText:"系統自動產生"})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"統一編號",value:u.taxId||"",onChange:e=>g("taxId",e.target.value),error:!!x.taxId,helperText:x.taxId,required:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"公司名稱",value:u.name||"",onChange:e=>g("name",e.target.value),error:!!x.name,helperText:x.name,required:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"英文簡稱",value:u.nameEn||"",onChange:e=>g("nameEn",e.target.value)})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"公司地址",value:u.address||"",onChange:e=>g("address",e.target.value),error:!!x.address,helperText:x.address,required:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,select:!0,label:"產業類別",value:u.industry||"",onChange:e=>g("industry",e.target.value),children:s.map((e=>(0,a.jsx)(l.MenuItem,{value:e,children:e},e)))})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"公司傳真",value:u.fax||"",onChange:e=>g("fax",e.target.value)})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"聯絡人",value:(null===(c=u.contact)||void 0===c?void 0:c.name)||"",onChange:e=>g("contact.name",e.target.value),error:!!x["contact.name"],helperText:x["contact.name"],required:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"聯絡電話",value:(null===(d=u.contact)||void 0===d?void 0:d.phone)||"",onChange:e=>g("contact.phone",e.target.value),error:!!x["contact.phone"],helperText:x["contact.phone"],required:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"電子郵件",value:(null===(m=u.contact)||void 0===m?void 0:m.email)||"",onChange:e=>g("contact.email",e.target.value),error:!!x["contact.email"],helperText:x["contact.email"],required:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"備註",value:u.note||"",onChange:e=>g("note",e.target.value),multiline:!0,rows:3})})]})}),(0,a.jsxs)(l.DialogActions,{children:[(0,a.jsx)(l.Button,{onClick:t,children:"取消"}),(0,a.jsx)(l.Button,{onClick:async()=>{if((()=>{var e,t,n,a;const r={};return u.name||(r.name="公司名稱為必填"),(null===(e=u.contact)||void 0===e?void 0:e.name)||(r["contact.name"]="聯絡人為必填"),(null===(t=u.contact)||void 0===t?void 0:t.phone)||(r["contact.phone"]="聯絡電話為必填"),(null===(n=u.contact)||void 0===n?void 0:n.email)||(r["contact.email"]="電子郵件為必填"),u.address||(r.address="公司地址為必填"),u.taxId||(r.taxId="統一編號為必填"),(null===(a=u.contact)||void 0===a?void 0:a.email)&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u.contact.email)&&(r["contact.email"]="電子郵件格式不正確"),u.taxId&&!/^\d{8}$/.test(u.taxId)&&(r.taxId="統一編號必須為8位數字"),p(r),0===Object.keys(r).length})())try{await o(u),t()}catch(e){}},variant:"contained",children:"儲存"})]})]})}},236465:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=(0,n(150885).createTheme)({palette:{primary:{main:"#1976d2"},secondary:{main:"#dc004e"}},typography:{fontFamily:["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif"].join(",")},components:{MuiFormControl:{styleOverrides:{root:{"& .MuiInputLabel-root":{backgroundColor:"#fff",px:1}}}}}});t.default=a},238824:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeeHistory=void 0;const a=n(474848),r=n(296540),l=n(264456),i=n(491178),s=n(859325),o=n(785739),c=n(801460),d=n(470750),m=e=>{const t={待收款:{label:"待收款",color:"warning"},已收款:{label:"已收款",color:"success"},逾期:{label:"逾期",color:"error"},終止:{label:"終止",color:"default"}}[e]||{label:e,color:"default"};return(0,a.jsx)(l.Chip,{label:t.label,color:t.color,size:"small"})},u=[{value:"",label:"全部"},{value:"待收款",label:"待收款"},{value:"已收款",label:"已收款"},{value:"逾期",label:"逾期"},{value:"終止",label:"終止"}];t.FeeHistory=()=>{const[e,t]=(0,r.useState)([]),[n,h]=(0,r.useState)({memberId:"",userId:"",status:"",startDate:"",endDate:""}),[x,p]=(0,r.useState)({startDate:null,endDate:null}),[g,y]=(0,r.useState)(!0),[j,b]=(0,r.useState)(null),[v,f]=(0,r.useState)(null),[T,S]=(0,r.useState)({open:!1,message:"",severity:"success"});(0,r.useEffect)((()=>{(async()=>{y(!0);try{const e={...n,startDate:x.startDate?x.startDate.toISOString().split("T")[0]:void 0,endDate:x.endDate?x.endDate.toISOString().split("T")[0]:void 0},a=await d.feeHistoryService.getHistories(e);t(a)}catch(e){console.error("載入會費歷史記錄失敗:",e),t([])}finally{y(!1)}})()}),[n,x]);const C=e=>t=>{p((n=>({...n,[e]:t})))},I=(e,t)=>{j&&b((n=>({...n,[e]:t})))};return g?(0,a.jsx)(l.Box,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,a.jsx)(l.CircularProgress,{})}):(0,a.jsxs)(l.Box,{children:[(0,a.jsx)(l.Typography,{variant:"h6",sx:{mb:3},children:"會費歷史記錄"}),(0,a.jsx)(l.Paper,{sx:{p:2,mb:3},children:(0,a.jsxs)(l.Grid,{container:!0,spacing:2,alignItems:"center",children:[(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:3,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"會員編號/姓名",name:"userId",value:n.userId,onChange:e=>{const{name:t,value:n}=e.target;h((e=>({...e,[t]:n})))},size:"small"})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:3,children:(0,a.jsxs)(l.FormControl,{fullWidth:!0,children:[(0,a.jsx)(l.InputLabel,{children:"收款狀態"}),(0,a.jsx)(l.Select,{name:"status",value:n.status||"",onChange:e=>{const t=e.target.value;h((e=>({...e,status:""===t?void 0:t})))},label:"收款狀態",size:"small",children:u.map((e=>(0,a.jsx)(l.MenuItem,{value:e.value,children:e.label},e.value)))})]})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:2,children:(0,a.jsx)(i.DatePicker,{label:"起始日期",value:x.startDate,onChange:C("startDate"),slotProps:{textField:{fullWidth:!0,size:"small"}}})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:2,children:(0,a.jsx)(i.DatePicker,{label:"結束日期",value:x.endDate,onChange:C("endDate"),slotProps:{textField:{fullWidth:!0,size:"small"}}})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:2,children:(0,a.jsx)(l.Button,{fullWidth:!0,variant:"contained",startIcon:(0,a.jsx)(s.Download,{}),onClick:async()=>{try{const e=await d.feeHistoryService.exportToExcel(n),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`會費歷史記錄_${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(t),document.body.removeChild(a)}catch(e){console.error("匯出失敗:",e)}},children:"匯出報表"})})]})}),(0,a.jsx)(l.TableContainer,{component:l.Paper,children:(0,a.jsxs)(l.Table,{children:[(0,a.jsx)(l.TableHead,{children:(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:"會員編號"}),(0,a.jsx)(l.TableCell,{children:"姓名"}),(0,a.jsx)(l.TableCell,{children:"會員類型"}),(0,a.jsx)(l.TableCell,{align:"right",children:"金額"}),(0,a.jsx)(l.TableCell,{children:"到期日"}),(0,a.jsx)(l.TableCell,{children:"繳費日期"}),(0,a.jsx)(l.TableCell,{children:"繳費方式"}),(0,a.jsx)(l.TableCell,{children:"狀態"}),(0,a.jsx)(l.TableCell,{children:"備註"}),(0,a.jsx)(l.TableCell,{children:"操作"})]})}),(0,a.jsx)(l.TableBody,{children:0===e.length?(0,a.jsx)(l.TableRow,{children:(0,a.jsx)(l.TableCell,{colSpan:11,align:"center",children:"目前沒有符合條件的歷史記錄"})}):e.map((e=>(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:e.userId}),(0,a.jsx)(l.TableCell,{children:e.userName}),(0,a.jsx)(l.TableCell,{children:e.memberType}),(0,a.jsx)(l.TableCell,{align:"right",children:(0,c.formatCurrency)(e.amount)}),(0,a.jsx)(l.TableCell,{children:(0,o.formatDate)(e.dueDate)}),(0,a.jsx)(l.TableCell,{children:e.paymentDate?(0,o.formatDate)(e.paymentDate):"-"}),(0,a.jsx)(l.TableCell,{children:e.paymentMethod||"-"}),(0,a.jsx)(l.TableCell,{children:m(e.status)}),(0,a.jsx)(l.TableCell,{children:e.note||"-"}),(0,a.jsxs)(l.TableCell,{children:[(0,a.jsx)(l.Tooltip,{title:"編輯",children:(0,a.jsx)(l.IconButton,{size:"small",onClick:()=>(e=>{b({...e})})(e),children:(0,a.jsx)(s.Edit,{})})}),(0,a.jsx)(l.Tooltip,{title:"刪除",children:(0,a.jsx)(l.IconButton,{size:"small",onClick:()=>(e=>{f(e)})(e),color:"error",children:(0,a.jsx)(s.Delete,{})})})]})]},e.id)))})]})}),(0,a.jsxs)(l.Dialog,{open:!!j,onClose:()=>b(null),maxWidth:"md",fullWidth:!0,children:[(0,a.jsx)(l.DialogTitle,{children:"編輯歷史記錄"}),(0,a.jsx)(l.DialogContent,{children:(0,a.jsxs)(l.Grid,{container:!0,spacing:2,sx:{pt:2},children:[(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"會員編號",value:(null==j?void 0:j.userId)||"",disabled:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"姓名",value:(null==j?void 0:j.userName)||"",disabled:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"會員類型",value:(null==j?void 0:j.memberType)||"",disabled:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"金額",type:"number",value:(null==j?void 0:j.amount)||"",onChange:e=>I("amount",Number(e.target.value))})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"到期日",type:"date",value:(null==j?void 0:j.dueDate)||"",onChange:e=>I("dueDate",e.target.value),InputLabelProps:{shrink:!0}})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"繳費日期",type:"date",value:(null==j?void 0:j.paymentDate)||"",onChange:e=>I("paymentDate",e.target.value),InputLabelProps:{shrink:!0}})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsxs)(l.FormControl,{fullWidth:!0,children:[(0,a.jsx)(l.InputLabel,{children:"狀態"}),(0,a.jsxs)(l.Select,{value:(null==j?void 0:j.status)||"",onChange:e=>{const t=e.target.value;"待收款"!==t&&"已收款"!==t&&"逾期"!==t&&"終止"!==t||I("status",t)},label:"狀態",children:[(0,a.jsx)(l.MenuItem,{value:"待收款",children:"待收款"}),(0,a.jsx)(l.MenuItem,{value:"已收款",children:"已收款"}),(0,a.jsx)(l.MenuItem,{value:"逾期",children:"逾期"}),(0,a.jsx)(l.MenuItem,{value:"終止",children:"終止"})]})]})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsxs)(l.FormControl,{fullWidth:!0,children:[(0,a.jsx)(l.InputLabel,{children:"收款方式"}),(0,a.jsxs)(l.Select,{value:(null==j?void 0:j.paymentMethod)||"",onChange:e=>{const t=e.target.value;"轉帳"!==t&&"Line Pay"!==t&&"現金"!==t&&"票據"!==t&&"其他"!==t||I("paymentMethod",t)},label:"收款方式",children:[(0,a.jsx)(l.MenuItem,{value:"轉帳",children:"轉帳"}),(0,a.jsx)(l.MenuItem,{value:"Line Pay",children:"Line Pay"}),(0,a.jsx)(l.MenuItem,{value:"現金",children:"現金"}),(0,a.jsx)(l.MenuItem,{value:"票據",children:"票據"}),(0,a.jsx)(l.MenuItem,{value:"其他",children:"其他"})]})]})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"備註",multiline:!0,rows:4,value:(null==j?void 0:j.note)||"",onChange:e=>I("note",e.target.value)})})]})}),(0,a.jsxs)(l.DialogActions,{children:[(0,a.jsx)(l.Button,{onClick:()=>b(null),children:"取消"}),(0,a.jsx)(l.Button,{onClick:async()=>{if(j){try{const e=await d.feeHistoryService.updateRecord(j.id,j);e&&(t((t=>t.map((t=>t.id===e.id?e:t)))),S({open:!0,message:"更新成功",severity:"success"}))}catch(e){console.error("更新失敗:",e),S({open:!0,message:"更新失敗",severity:"error"})}b(null)}},variant:"contained",children:"儲存"})]})]}),(0,a.jsxs)(l.Dialog,{open:!!v,onClose:()=>f(null),children:[(0,a.jsx)(l.DialogTitle,{children:"確認刪除"}),(0,a.jsx)(l.DialogContent,{children:(0,a.jsxs)(l.Typography,{children:["確定要刪除 ",null==v?void 0:v.userName," 的歷史記錄嗎？此操作無法復原。"]})}),(0,a.jsxs)(l.DialogActions,{children:[(0,a.jsx)(l.Button,{onClick:()=>f(null),children:"取消"}),(0,a.jsx)(l.Button,{onClick:async()=>{if(v){try{await d.feeHistoryService.deleteRecord(v.id)&&(t((e=>e.filter((e=>e.id!==v.id)))),S({open:!0,message:"刪除成功",severity:"success"}))}catch(e){console.error("刪除失敗:",e),S({open:!0,message:"刪除失敗",severity:"error"})}f(null)}},variant:"contained",color:"error",children:"刪除"})]})]}),(0,a.jsx)(l.Snackbar,{open:T.open,autoHideDuration:3e3,onClose:()=>S((e=>({...e,open:!1}))),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,a.jsx)(l.Alert,{onClose:()=>S((e=>({...e,open:!1}))),severity:T.severity,children:T.message})})]})},t.default=t.FeeHistory},257150:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.feeService=void 0;const a=n(640182),r=n(209965),l=n(470750),i="feeSettings",s="paymentStatuses";const o=new class{constructor(){this.feeSettings=[],this.paymentStatuses=[],this.loadData()}async loadData(){const e=await r.storageService.getData(i),t=await r.storageService.getData(s);e&&(this.feeSettings=e),t&&(this.paymentStatuses=t)}async getFeeSettings(){return 0===this.feeSettings.length&&await this.loadData(),this.feeSettings}async getPaymentStatuses(){return 0===this.paymentStatuses.length&&await this.loadData(),this.paymentStatuses}async getPayments(e){return await this.loadData(),(null==e?void 0:e.isHistoryPage)?this.paymentStatuses.filter((e=>"已收款"===e.status)):this.paymentStatuses}async createPayment(e){await this.loadData();const t={...e,id:(0,a.v4)()};return this.paymentStatuses.push(t),await r.storageService.updateData(s,this.paymentStatuses),t}async updatePayment(e,t){await this.loadData();const n=this.paymentStatuses.findIndex((t=>t.id===e));if(-1===n)return null;const a=this.paymentStatuses[n];return this.paymentStatuses[n]=t,await r.storageService.updateData(s,this.paymentStatuses),"已收款"===t.status&&"已收款"!==a.status&&await this.addHistory({paymentId:t.id,memberId:t.memberId,memberName:t.memberName,memberType:t.memberType,action:t.status,amount:t.amount,date:(new Date).toISOString().split("T")[0],dueDate:t.dueDate,paymentDate:t.paidDate,status:t.status,note:t.note||"",userId:t.memberId,userName:t.memberName,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}),t}async deletePayment(e){await this.loadData();if(!this.paymentStatuses.find((t=>t.id===e)))return!1;this.paymentStatuses=this.paymentStatuses.filter((t=>t.id!==e)),await r.storageService.updateData(s,this.paymentStatuses);const t=(await r.storageService.getData("fee_history")||[]).filter((t=>t.paymentId!==e));return await r.storageService.updateData("fee_history",t),!0}async addHistory(e){await l.feeHistoryService.addHistory(e)}async addFeeSetting(e){await this.loadData(),this.feeSettings.push(e),await r.storageService.updateData(i,this.feeSettings)}async updateFeeSetting(e,t){await this.loadData();const n=this.feeSettings.findIndex((t=>t.id===e));-1!==n&&(this.feeSettings[n]={...this.feeSettings[n],...t},await r.storageService.updateData(i,this.feeSettings))}async deleteFeeSetting(e){await this.loadData(),this.feeSettings=this.feeSettings.filter((t=>t.id!==e)),await r.storageService.updateData(i,this.feeSettings)}async addPaymentStatus(e){await this.loadData(),this.paymentStatuses.push(e),await r.storageService.updateData(s,this.paymentStatuses)}async updatePaymentStatus(e,t){await this.loadData();const n=this.paymentStatuses.findIndex((t=>t.id===e));-1!==n&&(this.paymentStatuses[n]={...this.paymentStatuses[n],...t},await r.storageService.updateData(s,this.paymentStatuses))}async deletePaymentStatus(e){await this.loadData(),this.paymentStatuses=this.paymentStatuses.filter((t=>t.id!==e)),await r.storageService.updateData(s,this.paymentStatuses)}async initialize(){const e=await r.storageService.getData(i),t=await r.storageService.getData(s);if(!e||0===e.length){const e=[{id:"1",name:"一般會員年費",description:"一般會員年費",amount:3e4,frequency:"yearly",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{id:"2",name:"商務會員年費",description:"商務會員年費",amount:3e5,frequency:"yearly",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{id:"3",name:"永久會員5年費用",description:"永久會員5年費用",amount:3e6,frequency:"yearly",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{id:"4",name:"管理員免費",description:"管理員免費",amount:0,frequency:"yearly",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}];await r.storageService.updateData(i,e)}t||await r.storageService.updateData(s,[]),await this.loadData()}};t.feeService=o,o.initialize().catch((e=>{console.error("初始化 feeService 失敗:",e)}))},332584:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useAuth=t.AuthProvider=void 0;const a=n(474848),r=n(296540),l=n(428526),i=(0,r.createContext)({isAuthenticated:!1,user:null,login:async()=>{},logout:()=>{}});t.AuthProvider=({children:e})=>{const[t,n]=(0,r.useState)(null),[s,o]=(0,r.useState)(!1);(0,r.useEffect)((()=>{const e=l.AuthService.getCurrentUser();e&&(n(e),o(!0))}),[]);return(0,a.jsx)(i.Provider,{value:{isAuthenticated:s,user:t,login:async(e,t)=>{try{const a=await l.AuthService.login(e,t);n(a),o(!0)}catch(e){throw e}},logout:()=>{l.AuthService.logout(),n(null),o(!1)}},children:e})};t.useAuth=()=>(0,r.useContext)(i)},332988:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(474848),r=n(296540),l=n(264456),i=n(859325),s=n(257150),o=n(583380),c=e=>{const t={待收款:{label:"待收款",color:"warning"},已收款:{label:"已收款",color:"success"},逾期:{label:"逾期",color:"error"},終止:{label:"終止",color:"default"}}[e]||{label:e,color:"default"};return(0,a.jsx)(l.Chip,{label:t.label,color:t.color,size:"small"})},d=e=>{if(!e||""===e)return"-";return{轉帳:"轉帳",transfer:"轉帳","Line Pay":"Line Pay",linepay:"Line Pay",現金:"現金",cash:"現金",票據:"票據",check:"票據",其他:"其他",other:"其他"}[e.toLowerCase()]||e};t.default=()=>{const[e,t]=(0,r.useState)([]),[n,m]=(0,r.useState)([]),[u,h]=(0,r.useState)(!0),[x,p]=(0,r.useState)(null),[g,y]=(0,r.useState)(null),[j,b]=(0,r.useState)({status:"",memberType:"",search:""}),[v,f]=(0,r.useState)(!1),[T,S]=(0,r.useState)({open:!1,message:"",severity:"success"}),[C,I]=(0,r.useState)(!1),[w,D]=(0,r.useState)(""),[P,N]=(0,r.useState)(""),[A,R]=(0,r.useState)((new Date).getFullYear()),[E,k]=(0,r.useState)([{id:"M001",name:"張三",type:"一般會員"},{id:"M002",name:"李四",type:"商務會員"}]),[M,B]=(0,r.useState)((()=>window.location.pathname.includes("歷史記錄")?"歷史記錄":"收款狀況"));(0,r.useEffect)((()=>{(async()=>{h(!0);try{const[e,n]=await Promise.all([s.feeService.getPayments({isHistoryPage:window.location.pathname.includes("歷史記錄")}),s.feeService.getFeeSettings()]);t(e||[]),m(n||[]);const a=(await o.ApiService.getUsers()).map((e=>({id:e.memberNo,name:e.name,type:"lifetime"===e.role?"永久會員":"admin"===e.role?"管理員":"business"===e.role?"商務會員":"一般會員"})));k(a)}catch(e){console.error("載入資料失敗:",e),S({open:!0,message:"載入資料失敗",severity:"error"})}finally{h(!1)}})()}),[]);const O=e.filter((e=>{const t=!j.status||e.status===j.status,n=!j.memberType||e.memberType===j.memberType,a=!j.search||e.memberName.toLowerCase().includes(j.search.toLowerCase())||e.memberId.toLowerCase().includes(j.search.toLowerCase());return t&&n&&a})).sort(((e,t)=>{const n=new Date(e.dueDate);return new Date(t.dueDate).getTime()-n.getTime()})),_=(Array.from(new Set(e.map((e=>e.memberType)))),E.filter((t=>!e.some((e=>{var n;return e.memberId===t.id&&(null===(n=e.note)||void 0===n?void 0:n.includes(`${A}年度會費`))}))&&"管理員"!==t.type)));if(u)return(0,a.jsx)(l.Box,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,a.jsx)(l.CircularProgress,{})});const F=(e,t)=>{if(x){const n={...x};switch(e){case"amount":n.amount=Number(t);break;case"status":n.status=t;break;case"paymentMethod":n.paymentMethod=t;break;case"dueDate":case"paidDate":case"note":n[e]=t}p(n)}};return(0,a.jsxs)(l.Box,{children:[(0,a.jsxs)(l.Box,{sx:{mb:3,display:"flex",justifyContent:"flex-end",alignItems:"center"},children:[(0,a.jsx)(l.Button,{variant:"contained",startIcon:(0,a.jsx)(i.Add,{}),onClick:()=>I(!0),sx:{mr:2},children:"產生年度應收"}),(0,a.jsx)(l.TextField,{size:"small",placeholder:"搜尋會員編號或姓名",value:j.search,onChange:e=>{return t="search",n=e.target.value,void b((e=>({...e,[t]:n})));var t,n},InputProps:{startAdornment:(0,a.jsx)(l.InputAdornment,{position:"start",children:(0,a.jsx)(i.Search,{})})},sx:{width:250}})]}),(0,a.jsx)(l.TableContainer,{component:l.Paper,children:(0,a.jsxs)(l.Table,{children:[(0,a.jsx)(l.TableHead,{children:(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:"會員編號"}),(0,a.jsx)(l.TableCell,{children:"姓名"}),(0,a.jsx)(l.TableCell,{children:"會員類型"}),(0,a.jsx)(l.TableCell,{align:"right",children:"金額"}),(0,a.jsx)(l.TableCell,{children:"到期日"}),(0,a.jsx)(l.TableCell,{children:"繳費日期"}),(0,a.jsx)(l.TableCell,{children:"收款方式"}),(0,a.jsx)(l.TableCell,{children:"狀態"}),(0,a.jsx)(l.TableCell,{children:"備註"}),(0,a.jsx)(l.TableCell,{children:"操作"})]})}),(0,a.jsx)(l.TableBody,{children:O.map((e=>(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:e.memberId}),(0,a.jsx)(l.TableCell,{children:e.memberName}),(0,a.jsx)(l.TableCell,{children:e.memberType}),(0,a.jsx)(l.TableCell,{align:"right",children:e.amount.toLocaleString()}),(0,a.jsx)(l.TableCell,{children:e.dueDate}),(0,a.jsx)(l.TableCell,{children:e.paidDate||"-"}),(0,a.jsx)(l.TableCell,{children:d(e.paymentMethod)}),(0,a.jsx)(l.TableCell,{children:c(e.status)}),(0,a.jsx)(l.TableCell,{children:e.note||"-"}),(0,a.jsxs)(l.TableCell,{children:[(0,a.jsx)(l.Tooltip,{title:"編輯",children:(0,a.jsx)(l.IconButton,{size:"small",onClick:()=>(e=>{p({...e})})(e),children:(0,a.jsx)(i.Edit,{})})}),(0,a.jsx)(l.Tooltip,{title:"刪除",children:(0,a.jsx)(l.IconButton,{size:"small",onClick:()=>(e=>{y(e)})(e),color:"error",children:(0,a.jsx)(i.Delete,{})})})]})]},e.id)))})]})}),(0,a.jsxs)(l.Dialog,{open:!!x,onClose:()=>p(null),maxWidth:"md",fullWidth:!0,children:[(0,a.jsx)(l.DialogTitle,{children:"編輯收款資訊"}),(0,a.jsx)(l.DialogContent,{children:(0,a.jsxs)(l.Grid,{container:!0,spacing:2,sx:{pt:2},children:[(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"會員編號",name:"memberId",value:(null==x?void 0:x.memberId)||"",disabled:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"姓名",name:"memberName",value:(null==x?void 0:x.memberName)||"",disabled:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"會員類型",name:"memberType",value:(null==x?void 0:x.memberType)||"",disabled:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"金額",name:"amount",type:"number",value:(null==x?void 0:x.amount)||"",onChange:e=>F("amount",e.target.value)})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"到期日",name:"dueDate",type:"date",value:(null==x?void 0:x.dueDate)||"",onChange:e=>F("dueDate",e.target.value),InputLabelProps:{shrink:!0}})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsxs)(l.FormControl,{fullWidth:!0,children:[(0,a.jsx)(l.InputLabel,{children:"狀態"}),(0,a.jsxs)(l.Select,{value:(null==x?void 0:x.status)||"",onChange:e=>{if(x){const t=e.target.value,n={...x,status:t,paymentMethod:"已收款"!==t||x.paymentMethod?x.paymentMethod:"轉帳",paidDate:"已收款"!==t||x.paidDate?x.paidDate:(new Date).toISOString().split("T")[0]};p(n)}},label:"狀態",children:[(0,a.jsx)(l.MenuItem,{value:"待收款",children:"待收款"}),(0,a.jsx)(l.MenuItem,{value:"已收款",children:"已收款"}),(0,a.jsx)(l.MenuItem,{value:"逾期",children:"逾期"}),(0,a.jsx)(l.MenuItem,{value:"終止",children:"終止"})]})]})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsxs)(l.FormControl,{fullWidth:!0,children:[(0,a.jsx)(l.InputLabel,{children:"收款方式"}),(0,a.jsxs)(l.Select,{value:(null==x?void 0:x.paymentMethod)||"",onChange:e=>{x&&p({...x,paymentMethod:e.target.value})},label:"收款方式",children:[(0,a.jsx)(l.MenuItem,{value:"轉帳",children:"轉帳"}),(0,a.jsx)(l.MenuItem,{value:"Line Pay",children:"Line Pay"}),(0,a.jsx)(l.MenuItem,{value:"現金",children:"現金"}),(0,a.jsx)(l.MenuItem,{value:"票據",children:"票據"}),(0,a.jsx)(l.MenuItem,{value:"其他",children:"其他"})]})]})}),(0,a.jsx)(l.Grid,{item:!0,xs:6,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"繳費日期",name:"paidDate",type:"date",value:(null==x?void 0:x.paidDate)||"",onChange:e=>F("paidDate",e.target.value),InputLabelProps:{shrink:!0}})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"備註",name:"note",multiline:!0,rows:4,value:(null==x?void 0:x.note)||"",onChange:e=>F("note",e.target.value)})})]})}),(0,a.jsxs)(l.DialogActions,{children:[(0,a.jsx)(l.Button,{onClick:()=>p(null),children:"取消"}),(0,a.jsx)(l.Button,{onClick:async()=>{if(x){try{const e=await s.feeService.updatePayment(x.id,x);e&&t((t=>t.map((t=>t.id===e.id?e:t))))}catch(e){console.error("更新失敗:",e)}p(null)}},variant:"contained",children:"儲存"})]})]}),(0,a.jsxs)(l.Dialog,{open:!!g,onClose:()=>y(null),children:[(0,a.jsx)(l.DialogTitle,{children:"確認刪除"}),(0,a.jsx)(l.DialogContent,{children:(0,a.jsxs)(l.Typography,{children:["確定要刪除 ",null==g?void 0:g.memberName," 的繳費記錄嗎？此操作無法復原。"]})}),(0,a.jsxs)(l.DialogActions,{children:[(0,a.jsx)(l.Button,{onClick:()=>y(null),children:"取消"}),(0,a.jsx)(l.Button,{onClick:async()=>{if(g){try{await s.feeService.deletePayment(g.id)&&(t((e=>e.filter((e=>e.id!==g.id)))),S({open:!0,message:"成功刪除記錄",severity:"success"}))}catch(e){console.error("刪除失敗:",e),S({open:!0,message:"刪除失敗",severity:"error"})}y(null)}},variant:"contained",color:"error",children:"刪除"})]})]}),(0,a.jsxs)(l.Dialog,{open:C,onClose:()=>I(!1),maxWidth:"sm",fullWidth:!0,children:[(0,a.jsx)(l.DialogTitle,{children:"產生年度應收"}),(0,a.jsx)(l.DialogContent,{children:(0,a.jsxs)(l.Grid,{container:!0,spacing:2,sx:{pt:2},children:[(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"年度",type:"number",value:A,onChange:e=>{const t=parseInt(e.target.value);t>=1911&&R(t)},InputProps:{inputProps:{min:1911}}})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsxs)(l.FormControl,{fullWidth:!0,children:[(0,a.jsx)(l.InputLabel,{children:"選擇會員"}),(0,a.jsxs)(l.Select,{value:w||"",onChange:e=>(e=>{D(e);const t=E.find((t=>t.id===e));if(t){console.log("選擇的會員:",t);const e={一般會員:"一般會員年費",商務會員:"商務會員年費",永久會員:"永久會員5年費用",管理員:"管理員免費"}[t.type];console.log("預期的會費名稱:",e),console.log("可用的會費設定:",n);const a=n.find((t=>(console.log("比對:",t.name,e),t.name===e)));console.log("匹配的會費設定:",a),a&&N(a.id)}})(e.target.value),fullWidth:!0,children:[(0,a.jsx)(l.MenuItem,{value:"",children:"請選擇會員"}),_.map((e=>(0,a.jsxs)(l.MenuItem,{value:e.id,children:[e.name," (",e.type,")"]},e.id)))]})]})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsxs)(l.FormControl,{fullWidth:!0,children:[(0,a.jsx)(l.InputLabel,{children:"會費標準"}),(0,a.jsx)(l.Select,{value:P,label:"會費標準",onChange:e=>N(e.target.value),children:(n||[]).map((e=>(0,a.jsxs)(l.MenuItem,{value:e.id,children:[e.name," - ",e.amount.toLocaleString()," 元"]},e.id)))})]})})]})}),(0,a.jsxs)(l.DialogActions,{children:[(0,a.jsx)(l.Button,{onClick:()=>I(!1),children:"取消"}),(0,a.jsx)(l.Button,{onClick:async()=>{if(!w||!P)return;const e=E.find((e=>e.id===w)),a=n.find((e=>e.id===P));if(e&&a){try{const n={memberId:e.id,memberName:e.name,memberType:e.type,amount:a.amount,dueDate:`${A}-12-31`,status:"待收款",note:`${A}年度會費`,feeSettingId:a.id},r=await s.feeService.createPayment(n);r&&(t((e=>[...e,r])),S({open:!0,message:"成功建立年度應收項目",severity:"success"}))}catch(e){S({open:!0,message:"建立年度應收項目失敗",severity:"error"})}I(!1),D(""),N("")}},variant:"contained",disabled:!w||!P,children:"建立"})]})]}),(0,a.jsx)(l.Snackbar,{open:T.open,autoHideDuration:3e3,onClose:()=>S((e=>({...e,open:!1}))),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,a.jsx)(l.Alert,{onClose:()=>S((e=>({...e,open:!1}))),severity:T.severity,children:T.message})})]})}},353900:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=a(n(296540)),i=a(n(205338)),s=n(445759),o=n(892278),c=a(n(78577));n(532216),n(246940);i.default.createRoot(document.getElementById("root")).render((0,r.jsx)(l.default.StrictMode,{children:(0,r.jsx)(s.LocalizationProvider,{dateAdapter:o.AdapterDayjs,children:(0,r.jsx)(c.default,{})})}))},356456:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FeeReport=void 0;const r=n(474848),l=n(296540),i=n(264456),s=n(859325),o=n(470750),c=n(189915),d=n(94644),m=a(n(44451));t.FeeReport=()=>{const[e,t]=(0,l.useState)("all"),[n,a]=(0,l.useState)([]),[u,h]=(0,l.useState)({yearlyTotal:0,yearlyPending:0,memberTypeStats:{一般會員:0,商務會員:0,終身會員:0}}),[x,p]=(0,l.useState)([]),[g,y]=(0,l.useState)([{id:"memberId",label:"會員編號",selected:!0},{id:"memberName",label:"會員姓名",selected:!0},{id:"memberType",label:"會員類別",selected:!0},{id:"paymentDate",label:"繳費日期",selected:!0},{id:"paymentMethod",label:"繳費方式",selected:!0},{id:"status",label:"繳費狀態",selected:!0},{id:"hasInvoice",label:"發票/收據",selected:!0}]),[j,b]=(0,l.useState)({}),[v,f]=(0,l.useState)({});(0,l.useEffect)((()=>{const e=(new Date).getFullYear(),t=Array.from({length:e-2019},((t,n)=>(e-n).toString()));a(t),T()}),[]),(0,l.useEffect)((()=>{T()}),[e]);const T=async()=>{try{const t=await o.feeHistoryService.getHistories();let n=t;if("all"!==e){const a=parseInt(e);n=t.filter((e=>!!e.paymentDate&&new Date(e.paymentDate).getFullYear()===a))}const a=(await d.memberService.getMembers()).reduce(((e,t)=>(e[t.id]=t,e)),{});f(a),p(n);const r={};for(const e of n){const t=await c.invoiceService.getDocuments({memberId:e.memberId});r[e.id]=t.length>0}b(r);const l=n.filter((e=>!!e.paymentDate&&"已收款"===e.status)).reduce(((e,t)=>e+t.amount),0),i=n.filter((e=>!!e.dueDate&&"待收款"===e.status)).reduce(((e,t)=>e+t.amount),0),s=n.filter((e=>!!e.paymentDate&&"已收款"===e.status)).reduce(((e,t)=>(t.memberType&&(e[t.memberType]=(e[t.memberType]||0)+t.amount),e)),{});h({yearlyTotal:l,yearlyPending:i,memberTypeStats:{一般會員:s["一般會員"]||0,商務會員:s["商務會員"]||0,終身會員:s["終身會員"]||0}})}catch(e){console.error("載入資料失敗:",e)}},S=(e,t)=>"hasInvoice"===t?j[e.id]?"是":"否":e[t]||"-";return(0,r.jsxs)(i.Box,{children:[(0,r.jsxs)(i.Box,{sx:{mb:3},children:[(0,r.jsx)(i.Typography,{variant:"h6",sx:{mb:2},children:"會費報表"}),(0,r.jsxs)(i.FormControl,{sx:{minWidth:120},children:[(0,r.jsx)(i.InputLabel,{children:"選擇年度"}),(0,r.jsxs)(i.Select,{value:e,label:"選擇年度",onChange:e=>t(e.target.value),size:"small",children:[(0,r.jsx)(i.MenuItem,{value:"all",children:"全部"}),n.map((e=>(0,r.jsxs)(i.MenuItem,{value:e,children:[e,"年"]},e)))]})]})]}),(0,r.jsxs)(i.Grid,{container:!0,spacing:3,sx:{mb:4},children:[(0,r.jsx)(i.Grid,{item:!0,xs:12,md:4,children:(0,r.jsx)(i.Card,{sx:{height:"100%",minHeight:200},children:(0,r.jsxs)(i.CardContent,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,r.jsx)(i.Typography,{color:"textSecondary",gutterBottom:!0,children:"all"===e?"全部總收":`${e}年度總收`}),(0,r.jsxs)(i.Typography,{variant:"h4",children:["$",u.yearlyTotal.toLocaleString()]})]})})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:4,children:(0,r.jsx)(i.Card,{sx:{height:"100%",minHeight:200},children:(0,r.jsxs)(i.CardContent,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,r.jsx)(i.Typography,{color:"textSecondary",gutterBottom:!0,children:"all"===e?"全部待收":`${e}年度待收`}),(0,r.jsxs)(i.Typography,{variant:"h4",children:["$",u.yearlyPending.toLocaleString()]})]})})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:4,children:(0,r.jsx)(i.Card,{sx:{height:"100%",minHeight:200},children:(0,r.jsxs)(i.CardContent,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,r.jsx)(i.Typography,{color:"textSecondary",gutterBottom:!0,children:"all"===e?"全部類別會員總收":`${e}年度各類別會員總收`}),(0,r.jsx)(i.Box,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:Object.entries(u.memberTypeStats).map((([e,t])=>(0,r.jsxs)(i.Box,{sx:{display:"flex",justifyContent:"space-between",mb:1,alignItems:"center"},children:[(0,r.jsxs)(i.Typography,{variant:"body1",children:[e,":"]}),(0,r.jsxs)(i.Typography,{variant:"h6",children:["$",t.toLocaleString()]})]},e)))})]})})})]}),(0,r.jsxs)(i.Paper,{sx:{p:2,mb:3},children:[(0,r.jsxs)(i.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,r.jsx)(i.Typography,{variant:"h6",children:"all"===e?"會費收款總表":`${e}年度會費收款總表`}),(0,r.jsx)(i.Button,{variant:"contained",startIcon:(0,r.jsx)(s.Download,{}),onClick:()=>{const t=g.filter((e=>e.selected)),n=x.map(((e,n)=>{const a={序號:n+1};return t.forEach((t=>{a[t.label]=S(e,t.id)})),a})),a=m.default.utils.json_to_sheet(n),r=m.default.utils.book_new();m.default.utils.book_append_sheet(r,a,"會費收款報表");const l="all"===e?"會費收款總表.xlsx":`${e}年度會費收款總表.xlsx`;m.default.writeFile(r,l)},children:"匯出 Excel"})]}),(0,r.jsxs)(i.Box,{sx:{mb:2},children:[(0,r.jsx)(i.Typography,{variant:"subtitle1",sx:{mb:1},children:"選擇顯示欄位："}),(0,r.jsx)(i.FormGroup,{row:!0,children:g.map((e=>(0,r.jsx)(i.FormControlLabel,{control:(0,r.jsx)(i.Checkbox,{checked:e.selected,onChange:()=>{return t=e.id,void y(g.map((e=>e.id===t?{...e,selected:!e.selected}:e)));var t}}),label:e.label},e.id)))})]}),(0,r.jsx)(i.TableContainer,{children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHead,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"序號"}),g.map((e=>e.selected&&(0,r.jsx)(i.TableCell,{children:e.label},e.id)))]})}),(0,r.jsx)(i.TableBody,{children:x.map(((e,t)=>(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:t+1}),g.map((t=>t.selected&&(0,r.jsx)(i.TableCell,{children:S(e,t.id)},t.id)))]},e.id)))})]})})]})]})}},381894:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=n(859325),o=n(409938),c=n(583380),d=n(500523),m=a(n(825734)),u=a(n(455549));t.default=({investments:e})=>{const[t,n]=(0,l.useState)([]),[a,h]=(0,l.useState)(!0),[x,p]=(0,l.useState)(null),[g,y]=(0,l.useState)(!1),[j,b]=(0,l.useState)(null),[v,f]=(0,l.useState)({investmentId:"",type:o.ProfitSharingType.PERCENTAGE,value:0,startDate:"",endDate:"",note:""});(0,l.useEffect)((()=>{T()}),[]);const T=async()=>{h(!0);try{const e=await c.ApiService.getProfitSharingStandards();n(e)}catch(e){p("載入資料失敗")}finally{h(!1)}},S=e=>t=>{f({...v,[e]:t.target.value})};return a?(0,r.jsx)(m.default,{}):x?(0,r.jsx)(u.default,{message:x}):(0,r.jsxs)(i.Box,{children:[(0,r.jsxs)(i.Box,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(i.Typography,{variant:"h6",children:"分潤標準設定"}),(0,r.jsx)(i.Button,{variant:"contained",startIcon:(0,r.jsx)(s.Add,{}),onClick:()=>{b(null),f({investmentId:"",type:o.ProfitSharingType.PERCENTAGE,value:0,startDate:"",endDate:"",note:""}),y(!0)},children:"新增分潤標準"})]}),(0,r.jsx)(i.TableContainer,{component:i.Paper,children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHead,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"投資項目"}),(0,r.jsx)(i.TableCell,{children:"分潤類型"}),(0,r.jsx)(i.TableCell,{align:"right",children:"分潤金額/比例"}),(0,r.jsx)(i.TableCell,{children:"生效日期"}),(0,r.jsx)(i.TableCell,{children:"結束日期"}),(0,r.jsx)(i.TableCell,{children:"備註"}),(0,r.jsx)(i.TableCell,{children:"操作"})]})}),(0,r.jsxs)(i.TableBody,{children:[t.map((t=>{const n=e.find((e=>e.id===t.investmentId));return(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:(null==n?void 0:n.name)||"未知項目"}),(0,r.jsx)(i.TableCell,{children:t.type===o.ProfitSharingType.PERCENTAGE?"百分比":t.type===o.ProfitSharingType.FIXED_AMOUNT?"固定金額":"其他"}),(0,r.jsx)(i.TableCell,{align:"right",children:t.type===o.ProfitSharingType.PERCENTAGE?`${t.value}%`:(0,d.formatCurrency)(t.value)}),(0,r.jsx)(i.TableCell,{children:(0,d.formatDate)(t.startDate)}),(0,r.jsx)(i.TableCell,{children:t.endDate?(0,d.formatDate)(t.endDate):"-"}),(0,r.jsx)(i.TableCell,{children:t.note||"-"}),(0,r.jsxs)(i.TableCell,{children:[(0,r.jsx)(i.IconButton,{size:"small",onClick:()=>(e=>{b(e),f({investmentId:e.investmentId,type:e.type,value:e.value,startDate:e.startDate,endDate:e.endDate||"",note:e.note||""}),y(!0)})(t),children:(0,r.jsx)(s.Edit,{})}),(0,r.jsx)(i.IconButton,{size:"small",color:"error",onClick:()=>(async e=>{if(window.confirm("確定要刪除此分潤標準？")){h(!0);try{await c.ApiService.deleteProfitSharingStandard(e),await T()}catch(e){p("刪除分潤標準失敗")}finally{h(!1)}}})(t.id),children:(0,r.jsx)(s.Delete,{})})]})]},t.id)})),0===t.length&&(0,r.jsx)(i.TableRow,{children:(0,r.jsx)(i.TableCell,{colSpan:7,align:"center",children:"尚無分潤標準資料"})})]})]})}),(0,r.jsxs)(i.Dialog,{open:g,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[(0,r.jsx)(i.DialogTitle,{children:j?"編輯分潤標準":"新增分潤標準"}),(0,r.jsx)(i.DialogContent,{children:(0,r.jsxs)(i.Grid,{container:!0,spacing:2,sx:{mt:1},children:[(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{select:!0,fullWidth:!0,label:"投資項目",value:v.investmentId,onChange:S("investmentId"),required:!0,children:e.map((e=>(0,r.jsx)(i.MenuItem,{value:e.id,children:e.name},e.id)))})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsxs)(i.TextField,{select:!0,fullWidth:!0,label:"分潤類型",value:v.type,onChange:S("type"),required:!0,children:[(0,r.jsx)(i.MenuItem,{value:o.ProfitSharingType.PERCENTAGE,children:"百分比"}),(0,r.jsx)(i.MenuItem,{value:o.ProfitSharingType.FIXED_AMOUNT,children:"固定金額"}),(0,r.jsx)(i.MenuItem,{value:o.ProfitSharingType.OTHER,children:"其他"})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:v.type===o.ProfitSharingType.PERCENTAGE?"分潤比例 (%)":"分潤金額",type:"number",value:v.value,onChange:S("value"),required:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"生效日期",type:"date",value:v.startDate,onChange:S("startDate"),required:!0,InputLabelProps:{shrink:!0}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"結束日期",type:"date",value:v.endDate,onChange:S("endDate"),InputLabelProps:{shrink:!0}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"備註",multiline:!0,rows:3,value:v.note,onChange:S("note")})})]})}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:()=>y(!1),children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{if(v.investmentId&&v.type&&v.value&&v.startDate){h(!0);try{j?await c.ApiService.updateProfitSharingStandard(j.id,v):await c.ApiService.createProfitSharingStandard(v),await T(),y(!1)}catch(e){p("儲存分潤標準失敗")}finally{h(!1)}}else p("請填寫必要欄位")},variant:"contained",children:"儲存"})]})]})]})}},403519:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(474848),r=n(296540),l=n(264456),i=n(859325),s=n(500523),o=n(583380);t.default=({investments:e,onEditInvestment:t,onDeleteInvestment:n})=>{const[c,d]=(0,r.useState)({}),[m,u]=(0,r.useState)({});(0,r.useEffect)((()=>{(async()=>{try{const e=(await o.ApiService.getCompanies()).reduce(((e,t)=>(e[t.id]=t,e)),{});d(e)}catch(e){console.error("載入公司資料失敗:",e)}})(),(async()=>{try{const e=(await o.ApiService.getUsers()).reduce(((e,t)=>(e[t.id]=t,e)),{});u(e)}catch(e){console.error("載入會員資料失敗:",e)}})()}),[]);const h=e=>{switch(e){case"active":case"completed":return"success";case"terminated":return"error";case"pending":return"warning";default:return"default"}},x=e=>{switch(e){case"active":return"進行中";case"completed":return"已完成";case"terminated":return"已終止";case"pending":return"審核中";default:return e}};return(0,a.jsx)(l.TableContainer,{component:l.Paper,children:(0,a.jsxs)(l.Table,{children:[(0,a.jsx)(l.TableHead,{children:(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:"投資項目"}),(0,a.jsx)(l.TableCell,{children:"類型"}),(0,a.jsx)(l.TableCell,{children:"投資金額"}),(0,a.jsx)(l.TableCell,{children:"起訖日期"}),(0,a.jsx)(l.TableCell,{children:"所屬公司"}),(0,a.jsx)(l.TableCell,{children:"所屬會員"}),(0,a.jsx)(l.TableCell,{children:"狀態"}),(0,a.jsx)(l.TableCell,{children:"操作"})]})}),(0,a.jsxs)(l.TableBody,{children:[e.map((e=>{var r,o;return(0,a.jsxs)(l.TableRow,{children:[(0,a.jsxs)(l.TableCell,{children:[(0,a.jsx)(l.Typography,{variant:"body1",children:e.name}),e.description&&(0,a.jsx)(l.Typography,{variant:"body2",color:"textSecondary",children:e.description})]}),(0,a.jsx)(l.TableCell,{children:"movable"===e.type?"動產":"不動產"}),(0,a.jsx)(l.TableCell,{children:(0,s.formatCurrency)(e.amount)}),(0,a.jsxs)(l.TableCell,{children:[e.startDate," ",e.endDate?`~ ${e.endDate}`:""]}),(0,a.jsx)(l.TableCell,{children:e.companyId&&(null===(r=c[e.companyId])||void 0===r?void 0:r.name)||""}),(0,a.jsx)(l.TableCell,{children:e.userId&&(null===(o=m[e.userId])||void 0===o?void 0:o.name)||""}),(0,a.jsx)(l.TableCell,{children:(0,a.jsx)(l.Chip,{label:x(e.status),color:h(e.status),size:"small"})}),(0,a.jsx)(l.TableCell,{children:(0,a.jsxs)(l.Box,{display:"flex",gap:1,children:[(0,a.jsx)(l.Tooltip,{title:"編輯",children:(0,a.jsx)(l.IconButton,{size:"small",onClick:()=>t(e),children:(0,a.jsx)(i.Edit,{})})}),(0,a.jsx)(l.Tooltip,{title:"刪除",children:(0,a.jsx)(l.IconButton,{size:"small",onClick:()=>n(e),color:"error",children:(0,a.jsx)(i.Delete,{})})})]})})]},e.id)})),0===e.length&&(0,a.jsx)(l.TableRow,{children:(0,a.jsx)(l.TableCell,{colSpan:8,align:"center",children:"尚無投資項目"})})]})]})})}},403903:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=a(n(466145)),o=a(n(332988)),c=a(n(238824)),d=n(979426),m=n(356456);function u(e){const{children:t,value:n,index:a,...l}=e;return(0,r.jsx)("div",{role:"tabpanel",hidden:n!==a,id:`fee-tabpanel-${a}`,"aria-labelledby":`fee-tab-${a}`,...l,children:n===a&&(0,r.jsx)(i.Box,{sx:{p:3},children:t})})}t.default=()=>{const[e,t]=(0,l.useState)(0);return(0,r.jsxs)(i.Box,{sx:{width:"100%"},children:[(0,r.jsxs)(i.Paper,{elevation:2,sx:{mb:2},children:[(0,r.jsx)(i.Typography,{variant:"h5",sx:{p:2},children:"會費管理"}),(0,r.jsxs)(i.Tabs,{value:e,onChange:(e,n)=>{t(n)},"aria-label":"會費管理功能頁籤",sx:{borderBottom:1,borderColor:"divider"},children:[(0,r.jsx)(i.Tab,{label:"會費標準設定"}),(0,r.jsx)(i.Tab,{label:"收款狀況"}),(0,r.jsx)(i.Tab,{label:"歷史記錄"}),(0,r.jsx)(i.Tab,{label:"發票管理"}),(0,r.jsx)(i.Tab,{label:"會費報表"})]})]}),(0,r.jsx)(u,{value:e,index:0,children:(0,r.jsx)(s.default,{})}),(0,r.jsx)(u,{value:e,index:1,children:(0,r.jsx)(o.default,{})}),(0,r.jsx)(u,{value:e,index:2,children:(0,r.jsx)(c.default,{})}),(0,r.jsx)(u,{value:e,index:3,children:(0,r.jsx)(d.InvoiceManagement,{})}),(0,r.jsx)(u,{value:e,index:4,children:(0,r.jsx)(m.FeeReport,{})})]})}},409938:(e,t)=>{"use strict";var n,a,r;Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentMethod=t.PaymentStatus=t.ProfitSharingType=void 0,function(e){e.PERCENTAGE="percentage",e.FIXED_AMOUNT="fixed_amount",e.OTHER="other"}(n||(t.ProfitSharingType=n={})),function(e){e.PENDING="pending",e.PAID="paid",e.OVERDUE="overdue"}(a||(t.PaymentStatus=a={})),function(e){e.CASH="cash",e.BANK_TRANSFER="bank_transfer",e.LINE_PAY="line_pay",e.CHECK="check",e.OTHER="other"}(r||(t.PaymentMethod=r={}))},428526:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthService=void 0;class n{constructor(){this.API_URL="http://localhost:3001/api",this.mockAdmin={id:"1",memberNo:"A001",username:"admin",password:"admin123",name:"系統管理員",email:"admin@example.com",role:"admin",status:"active",preferences:[],isFirstLogin:!1,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},this.currentUser=null;const e=localStorage.getItem("user");e&&(this.currentUser=JSON.parse(e))}static getInstance(){return n.instance||(n.instance=new n),n.instance}async login(e,t){try{if(e===this.mockAdmin.username&&t===this.mockAdmin.password){const{password:e,...t}=this.mockAdmin;return this.currentUser=t,localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("token","mock-jwt-token"),t}throw new Error("Invalid credentials")}catch(e){throw console.error("Login error:",e),e}}async register(e){try{const t=await fetch(`${this.API_URL}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Registration failed");return await t.json()}catch(e){throw console.error("Registration error:",e),e}}logout(){this.currentUser=null,localStorage.removeItem("user"),localStorage.removeItem("token")}isAuthenticated(){return!!this.currentUser&&!!this.getToken()}isAdmin(){return"admin"===localStorage.getItem("userRole")}getCurrentUser(){return this.currentUser}getToken(){return localStorage.getItem("token")}setSession(e){localStorage.setItem("token",e.token),localStorage.setItem("user",JSON.stringify(e.user)),localStorage.setItem("userRole",e.user.role)}async updateUserProfile(e){try{const t=this.getToken(),n=await fetch(`${this.API_URL}/users/profile`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!n.ok)throw new Error("Profile update failed");const a=await n.json();return localStorage.setItem("user",JSON.stringify(a)),a}catch(e){throw console.error("Profile update error:",e),e}}async changePassword(e,t){try{const n=this.getToken();return(await fetch(`${this.API_URL}/auth/change-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({oldPassword:e,newPassword:t})})).ok}catch(e){return console.error("Password change error:",e),!1}}}t.AuthService=n.getInstance()},455549:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(474848),r=n(264456);t.default=({message:e})=>(0,a.jsx)(r.Alert,{severity:"error",sx:{m:2},children:e})},460003:()=>{},466145:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(474848),r=n(296540),l=n(264456),i=n(859325),s=[{id:"1",memberType:"一般會員",amount:3e4,period:"年",description:"一般會員年費"},{id:"2",memberType:"商務會員",amount:3e5,period:"年",description:"商務會員年費"},{id:"3",memberType:"永久會員",amount:3e6,period:"5年",description:"永久會員5年費用"},{id:"4",memberType:"管理員",amount:0,period:"永久",description:"管理員免費"}];t.default=()=>{const[e,t]=(0,r.useState)(s),[n,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),m=()=>{o(!1),d(null)},u=e=>{c&&d({...c,[e.target.name]:"amount"===e.target.name?Number(e.target.value):e.target.value})};return(0,a.jsxs)(l.Box,{children:[(0,a.jsx)(l.Typography,{variant:"h6",sx:{mb:2},children:"會費標準設定"}),(0,a.jsx)(l.TableContainer,{component:l.Paper,children:(0,a.jsxs)(l.Table,{children:[(0,a.jsx)(l.TableHead,{children:(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:"會員類型"}),(0,a.jsx)(l.TableCell,{align:"right",children:"金額"}),(0,a.jsx)(l.TableCell,{children:"期間"}),(0,a.jsx)(l.TableCell,{children:"說明"}),(0,a.jsx)(l.TableCell,{children:"操作"})]})}),(0,a.jsx)(l.TableBody,{children:e.map((e=>(0,a.jsxs)(l.TableRow,{children:[(0,a.jsx)(l.TableCell,{children:e.memberType}),(0,a.jsx)(l.TableCell,{align:"right",children:e.amount.toLocaleString()}),(0,a.jsx)(l.TableCell,{children:e.period}),(0,a.jsx)(l.TableCell,{children:e.description}),(0,a.jsx)(l.TableCell,{children:(0,a.jsx)(l.IconButton,{onClick:()=>(e=>{d({...e}),o(!0)})(e),children:(0,a.jsx)(i.Edit,{})})})]},e.id)))})]})}),(0,a.jsxs)(l.Dialog,{open:n,onClose:m,children:[(0,a.jsx)(l.DialogTitle,{children:"編輯會費標準"}),(0,a.jsx)(l.DialogContent,{children:(0,a.jsxs)(l.Box,{sx:{pt:2},children:[(0,a.jsx)(l.TextField,{fullWidth:!0,margin:"dense",label:"會員類型",name:"memberType",value:(null==c?void 0:c.memberType)||"",onChange:u,disabled:!0}),(0,a.jsx)(l.TextField,{fullWidth:!0,margin:"dense",label:"金額",name:"amount",type:"number",value:(null==c?void 0:c.amount)||"",onChange:u}),(0,a.jsx)(l.TextField,{fullWidth:!0,margin:"dense",label:"期間",name:"period",value:(null==c?void 0:c.period)||"",onChange:u}),(0,a.jsx)(l.TextField,{fullWidth:!0,margin:"dense",label:"說明",name:"description",value:(null==c?void 0:c.description)||"",onChange:u})]})}),(0,a.jsxs)(l.DialogActions,{children:[(0,a.jsx)(l.Button,{onClick:m,children:"取消"}),(0,a.jsx)(l.Button,{onClick:()=>{c&&(t(e.map((e=>e.id===c.id?c:e))),m())},variant:"contained",children:"儲存"})]})]})]})}},470750:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.feeHistoryService=void 0;const a=n(640182),r=n(209965),l="fee_history";t.feeHistoryService=new class{constructor(){this.histories=[],this.loadHistories()}async loadHistories(){try{const e=await r.storageService.getData(l);this.histories=e||[]}catch(e){console.error("載入繳費歷史記錄失敗:",e),this.histories=[]}}async getHistories(e){return await this.loadHistories(),e?this.histories.filter((t=>{const n=!e.status||t.action.includes(e.status),a=!e.memberId||t.memberId===e.memberId,r=!e.userId||t.memberId===e.userId,l=(!e.startDate||t.date>=e.startDate)&&(!e.endDate||t.date<=e.endDate);return n&&a&&r&&l})):this.histories}async addHistory(e){await this.loadHistories();const t={...e,id:(0,a.v4)()};return this.histories.push(t),await this.saveHistories(),t}async updateHistory(e,t){await this.loadHistories();const n=this.histories.findIndex((t=>t.id===e));return-1===n?null:(this.histories[n]={...this.histories[n],...t,updatedAt:(new Date).toISOString()},await this.saveHistories(),this.histories[n])}async deleteHistory(e){await this.loadHistories();const t=this.histories.filter((t=>t.id!==e));return t.length!==this.histories.length&&(this.histories=t,await this.saveHistories(),!0)}async exportToExcel(e){const t=(await this.getHistories(e)).map((e=>[e.memberId,e.memberName,e.memberType,e.action,e.amount.toString(),e.date,e.dueDate,e.paymentDate||"",e.paymentMethod||"",e.status,e.note])),n=[["會員編號","會員姓名","會員類型","操作","金額","日期","到期日","繳費日期","繳費方式","狀態","備註"].join(","),...t.map((e=>e.join(",")))].join("\n");return new Blob(["\ufeff"+n],{type:"text/csv;charset=utf-8"})}async saveHistories(){try{await r.storageService.updateData(l,this.histories)}catch(e){throw console.error("儲存繳費歷史記錄失敗:",e),e}}async updateRecord(e,t){return this.updateHistory(e,t)}async deleteRecord(e){await this.loadHistories();const t=this.histories.filter((t=>t.id!==e));return t.length!==this.histories.length&&(this.histories=t,await this.saveHistories(),!0)}}},500523:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatDate=t.formatCurrency=void 0;t.formatCurrency=e=>{const t=Number(e);return isNaN(t)?"$0":new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)};t.formatDate=e=>new Date(e).toLocaleDateString("zh-TW")},502505:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=n(859325),o=n(409938),c=n(64545),d=n(500523),m=a(n(825734)),u=a(n(455549)),h=n(407514);t.default=({investments:e})=>{const[t,n]=(0,l.useState)([]),[a,x]=(0,l.useState)(!0),[p,g]=(0,l.useState)(null),[y,j]=(0,l.useState)(!1),[b,v]=(0,l.useState)(null),[f,T]=(0,l.useState)((new Date).getFullYear()),[S,C]=(0,l.useState)((new Date).getMonth()+1),{enqueueSnackbar:I}=(0,h.useSnackbar)(),[w,D]=(0,l.useState)({investmentId:"",year:(new Date).getFullYear(),month:(new Date).getMonth()+1,amount:0,status:o.PaymentStatus.PENDING,paymentMethod:o.PaymentMethod.BANK_TRANSFER,paymentDate:"",renterName:"",payerName:"",note:""}),[P,N]=(0,l.useState)(!1),[A,R]=(0,l.useState)([]),[E,k]=(0,l.useState)(!1);(0,l.useEffect)((()=>{M()}),[f,S]);const M=async()=>{x(!0);try{const e=await c.ApiService.getRentalPayments(void 0,f,S),t=Array.from(new Set(e.map((e=>e.investmentId)))).map((e=>c.ApiService.getRentalStandards(e))),a=(await Promise.all(t)).reduce(((e,t)=>e.concat(t)),[]),r=e.map((e=>{const t=a.find((t=>{const n=new Date(t.startDate),a=t.endDate?new Date(t.endDate):new Date("9999-12-31"),r=new Date(e.year,e.month-1,1);return t.investmentId===e.investmentId&&n<=r&&r<=a}));return{...e,renterName:e.renterName||(null==t?void 0:t.renterName)||"",renterTaxId:e.renterTaxId||(null==t?void 0:t.renterTaxId)||"",payerName:e.payerName||e.renterName||(null==t?void 0:t.renterName)||""}}));n(r)}catch(e){g("載入資料失敗")}finally{x(!1)}},B=e=>t=>{D({...w,[e]:t.target.value})},O=e=>t=>{D({...w,[e]:t.target.value})},_=e=>{switch(e){case o.PaymentStatus.PAID:return"success";case o.PaymentStatus.PENDING:return"warning";case o.PaymentStatus.OVERDUE:return"error";default:return"default"}},F=e=>{switch(e){case o.PaymentStatus.PAID:return"已收款";case o.PaymentStatus.PENDING:return"待收款";case o.PaymentStatus.OVERDUE:return"逾期";default:return"未知"}};return a?(0,r.jsx)(m.default,{}):p?(0,r.jsx)(u.default,{message:p}):(0,r.jsxs)(i.Box,{children:[(0,r.jsxs)(i.Box,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(i.Typography,{variant:"h6",children:"租金收款管理"}),(0,r.jsxs)(i.Box,{children:[(0,r.jsxs)(i.FormControl,{sx:{mr:2,minWidth:100},children:[(0,r.jsx)(i.InputLabel,{id:"year-filter-label",htmlFor:"year-filter",children:"年度"}),(0,r.jsx)(i.Select,{labelId:"year-filter-label",id:"year-filter",name:"year-filter",value:f.toString(),label:"年度",onChange:e=>T(Number(e.target.value)),inputProps:{"aria-labelledby":"year-filter-label"},children:Array.from({length:10},((e,t)=>(new Date).getFullYear()-5+t)).map((e=>(0,r.jsx)(i.MenuItem,{value:e,id:`year-option-${e}`,children:e},e)))})]}),(0,r.jsxs)(i.FormControl,{sx:{mr:2,minWidth:100},children:[(0,r.jsx)(i.InputLabel,{id:"month-filter-label",htmlFor:"month-filter",children:"月份"}),(0,r.jsx)(i.Select,{labelId:"month-filter-label",id:"month-filter",name:"month-filter",value:S.toString(),label:"月份",onChange:e=>C(Number(e.target.value)),inputProps:{"aria-labelledby":"month-filter-label"},children:Array.from({length:12},((e,t)=>t+1)).map((e=>(0,r.jsx)(i.MenuItem,{value:e,id:`month-option-${e}`,children:e},e)))})]}),(0,r.jsx)(i.Button,{variant:"contained",startIcon:(0,r.jsx)(s.Refresh,{}),onClick:async()=>{if(f)try{const t=await c.ApiService.getRentalPayments(void 0,f),n=e.map((e=>({id:e.id,name:e.name,selected:!1,hasExistingPayments:t.some((t=>t.investmentId===e.id))})));R(n),N(!0)}catch(e){I("生成租金收款項目失敗",{variant:"error"})}else I("請選擇要生成的年度",{variant:"error"})},sx:{mr:1},"aria-label":"生成收款項目",children:"生成收款項目"}),(0,r.jsx)(i.Button,{variant:"outlined",color:"error",startIcon:(0,r.jsx)(s.Delete,{}),onClick:()=>{k(!0)},children:"清除租金項目"})]})]}),(0,r.jsx)(i.TableContainer,{component:i.Paper,children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHead,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"投資項目"}),(0,r.jsx)(i.TableCell,{children:"年月"}),(0,r.jsx)(i.TableCell,{align:"right",children:"租金金額"}),(0,r.jsx)(i.TableCell,{children:"收款狀態"}),(0,r.jsx)(i.TableCell,{children:"收款方式"}),(0,r.jsx)(i.TableCell,{children:"收款日期"}),(0,r.jsx)(i.TableCell,{children:"承租人"}),(0,r.jsx)(i.TableCell,{children:"繳款人"}),(0,r.jsx)(i.TableCell,{children:"備註"}),(0,r.jsx)(i.TableCell,{children:"操作"})]})}),(0,r.jsxs)(i.TableBody,{children:[t.map((t=>{const n=e.find((e=>e.id===t.investmentId));return(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:(null==n?void 0:n.name)||"未知項目"}),(0,r.jsx)(i.TableCell,{children:`${t.year}年${t.month}月`}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,d.formatCurrency)(t.amount)}),(0,r.jsx)(i.TableCell,{children:(0,r.jsx)(i.Chip,{label:F(t.status),color:_(t.status),size:"small"})}),(0,r.jsx)(i.TableCell,{children:t.paymentMethod===o.PaymentMethod.CASH?"現金":t.paymentMethod===o.PaymentMethod.BANK_TRANSFER?"銀行轉帳":t.paymentMethod===o.PaymentMethod.CHECK?"支票":"其他"}),(0,r.jsx)(i.TableCell,{children:t.paymentDate?(0,d.formatDate)(t.paymentDate):"-"}),(0,r.jsx)(i.TableCell,{children:t.renterName||"-"}),(0,r.jsx)(i.TableCell,{children:t.payerName||t.renterName||"-"}),(0,r.jsx)(i.TableCell,{children:t.note||"-"}),(0,r.jsxs)(i.TableCell,{children:[(0,r.jsx)(i.IconButton,{size:"small",onClick:()=>(async e=>{try{const t=await c.ApiService.getRentalStandards(e.investmentId);console.log("所有租賃標準:",t);const n=new Date(e.year,e.month-1,1);console.log("付款日期:",n);const a=t.find((e=>{const t=new Date(e.startDate),a=e.endDate?new Date(e.endDate):new Date("9999-12-31");return console.log("比較日期:",{標準ID:e.id,標準開始日期:t,標準結束日期:a,付款日期:n,是否適用:t<=n&&n<=a}),t<=n&&n<=a}));let r={renterName:"",renterTaxId:""};if(a)r.renterName=a.renterName||"",r.renterTaxId=a.renterTaxId||"";else if(t.length>0){const e=t.sort(((e,t)=>new Date(t.startDate).getTime()-new Date(e.startDate).getTime()))[0];console.log("使用最新的標準:",e),r.renterName=e.renterName||"",r.renterTaxId=e.renterTaxId||""}console.log("最終承租人資訊:",{payment:e,applicableStandard:a,renterInfo:r,renterName:e.renterName||r.renterName}),v(e),D({...e,paymentMethod:e.paymentMethod||o.PaymentMethod.BANK_TRANSFER,paymentDate:e.paymentDate||"",renterName:e.renterName||r.renterName,renterTaxId:e.renterTaxId||r.renterTaxId,payerName:e.payerName||e.renterName||r.renterName,note:e.note||""}),j(!0)}catch(t){console.error("載入租賃標準資訊失敗:",t),v(e),D({...e,paymentMethod:e.paymentMethod||o.PaymentMethod.BANK_TRANSFER,paymentDate:e.paymentDate||"",renterName:e.renterName||"",renterTaxId:e.renterTaxId||"",payerName:e.payerName||e.renterName||"",note:e.note||""}),j(!0)}})(t),"aria-label":`編輯 ${(null==n?void 0:n.name)||"未知項目"} ${t.year}年${t.month}月 的收款項目`,children:(0,r.jsx)(s.Edit,{})}),(0,r.jsx)(i.IconButton,{size:"small",onClick:()=>(async e=>{if(window.confirm("確定要刪除此筆租金收款項目？")){x(!0);try{await c.ApiService.deleteRentalPayment(e.id),await M()}catch(e){g("刪除租金收款項目失敗")}finally{x(!1)}}})(t),color:"error","aria-label":`刪除 ${(null==n?void 0:n.name)||"未知項目"} ${t.year}年${t.month}月 的收款項目`,children:(0,r.jsx)(s.Delete,{})})]})]},t.id)})),0===t.length&&(0,r.jsx)(i.TableRow,{children:(0,r.jsx)(i.TableCell,{colSpan:10,align:"center",children:"尚無租金收款資料"})})]})]})}),(0,r.jsxs)(i.Dialog,{open:y,onClose:()=>j(!1),maxWidth:"sm",fullWidth:!0,"aria-labelledby":"edit-rental-payment-title",disableEnforceFocus:!0,keepMounted:!1,children:[(0,r.jsx)(i.DialogTitle,{id:"edit-rental-payment-title",children:"編輯租金收款項目"}),(0,r.jsx)(i.DialogContent,{children:(0,r.jsxs)(i.Grid,{container:!0,spacing:2,sx:{mt:1},children:[(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsxs)(i.FormControl,{fullWidth:!0,required:!0,disabled:!0,children:[(0,r.jsx)(i.InputLabel,{id:"rental-investment-label",htmlFor:"rental-investment",children:"投資項目"}),(0,r.jsx)(i.Select,{labelId:"rental-investment-label",id:"rental-investment",name:"investmentId",value:w.investmentId,label:"投資項目",onChange:O("investmentId"),inputProps:{"aria-labelledby":"rental-investment-label"},children:e.map((e=>(0,r.jsx)(i.MenuItem,{value:e.id,id:`investment-option-${e.id}`,children:e.name},e.id)))})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"rental-year",name:"year",label:"年度",value:w.year,disabled:!0,InputLabelProps:{htmlFor:"rental-year"}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"rental-month",name:"month",label:"月份",value:w.month,disabled:!0,InputLabelProps:{htmlFor:"rental-month"}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"rental-amount",name:"amount",label:"租金金額",type:"number",value:w.amount,onChange:B("amount"),required:!0,InputLabelProps:{htmlFor:"rental-amount"}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsxs)(i.FormControl,{fullWidth:!0,required:!0,children:[(0,r.jsx)(i.InputLabel,{id:"rental-status-label",htmlFor:"rental-status",children:"收款狀態"}),(0,r.jsxs)(i.Select,{labelId:"rental-status-label",id:"rental-status",name:"status",value:w.status,label:"收款狀態",onChange:O("status"),inputProps:{"aria-labelledby":"rental-status-label"},children:[(0,r.jsx)(i.MenuItem,{value:o.PaymentStatus.PENDING,id:"status-option-pending",children:"待收款"}),(0,r.jsx)(i.MenuItem,{value:o.PaymentStatus.PAID,id:"status-option-paid",children:"已收款"}),(0,r.jsx)(i.MenuItem,{value:o.PaymentStatus.OVERDUE,id:"status-option-overdue",children:"逾期"})]})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsxs)(i.FormControl,{fullWidth:!0,children:[(0,r.jsx)(i.InputLabel,{id:"rental-payment-method-label",htmlFor:"rental-payment-method",children:"收款方式"}),(0,r.jsxs)(i.Select,{labelId:"rental-payment-method-label",id:"rental-payment-method",name:"paymentMethod",value:w.paymentMethod,label:"收款方式",onChange:O("paymentMethod"),inputProps:{"aria-labelledby":"rental-payment-method-label"},children:[(0,r.jsx)(i.MenuItem,{value:o.PaymentMethod.CASH,id:"payment-method-option-cash",children:"現金"}),(0,r.jsx)(i.MenuItem,{value:o.PaymentMethod.BANK_TRANSFER,id:"payment-method-option-bank",children:"銀行轉帳"}),(0,r.jsx)(i.MenuItem,{value:o.PaymentMethod.CHECK,id:"payment-method-option-check",children:"支票"}),(0,r.jsx)(i.MenuItem,{value:o.PaymentMethod.OTHER,id:"payment-method-option-other",children:"其他"})]})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"rental-payment-date",name:"paymentDate",label:"收款日期",type:"date",value:w.paymentDate,onChange:B("paymentDate"),InputLabelProps:{shrink:!0,htmlFor:"rental-payment-date"}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"rental-renter-name",name:"renterName",label:"承租人",value:w.renterName,disabled:!0,InputLabelProps:{htmlFor:"rental-renter-name"}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"rental-payer-name",name:"payerName",label:"繳款人",value:w.payerName,onChange:B("payerName"),placeholder:"預設同承租人",InputLabelProps:{htmlFor:"rental-payer-name"}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,id:"rental-note",name:"note",label:"備註",multiline:!0,rows:3,value:w.note,onChange:B("note"),InputLabelProps:{htmlFor:"rental-note"}})})]})}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:()=>j(!1),"aria-label":"取消編輯",tabIndex:0,children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{if(w.investmentId&&w.amount&&w.status){x(!0);try{b&&await c.ApiService.updateRentalPayment(b.id,w),await M(),j(!1)}catch(e){g("儲存租金收款項目失敗")}finally{x(!1)}}else g("請填寫必要欄位")},variant:"contained","aria-label":"儲存變更",tabIndex:0,children:"儲存"})]})]}),(0,r.jsxs)(i.Dialog,{open:E,onClose:()=>k(!1),children:[(0,r.jsx)(i.DialogTitle,{children:"確認清除"}),(0,r.jsx)(i.DialogContent,{children:(0,r.jsxs)(i.DialogContentText,{children:["確定要清除 ",f,"年",S?S+"月":"","的所有租金項目嗎？此操作無法復原。"]})}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:()=>k(!1),children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{try{await c.ApiService.clearRentalPayments(f,S),I(`已清除 ${f}年${S?S+"月":""}的租金項目`,{variant:"success"}),await M()}catch(e){I("清除租金項目失敗",{variant:"error"})}finally{k(!1)}},color:"error",children:"確認清除"})]})]}),(0,r.jsxs)(i.Dialog,{open:P,onClose:()=>N(!1),maxWidth:"sm",fullWidth:!0,"aria-labelledby":"select-investments-title",disableEnforceFocus:!0,keepMounted:!1,children:[(0,r.jsx)(i.DialogTitle,{id:"select-investments-title",children:"選擇要生成收款項目的投資項目"}),(0,r.jsx)(i.DialogContent,{children:A.map((e=>(0,r.jsxs)(i.Box,{sx:{mb:1},children:[(0,r.jsx)(i.FormControlLabel,{control:(0,r.jsx)(i.Checkbox,{id:`investment-selection-${e.id}`,name:`investment-selection-${e.id}`,checked:e.selected,onChange:()=>{return t=e.id,void R((e=>e.map((e=>e.id===t?{...e,selected:!e.selected}:e))));var t},disabled:e.hasExistingPayments}),label:e.name,htmlFor:`investment-selection-${e.id}`}),e.hasExistingPayments&&(0,r.jsx)(i.Typography,{variant:"caption",color:"error",component:"span",children:"（已存在收款項目）"})]},e.id)))}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:()=>N(!1),"aria-label":"取消選擇",tabIndex:0,children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{N(!1),x(!0);let e=!1,t="";try{const n=A.filter((e=>e.selected));for(const a of n)try{await c.ApiService.generateRentalPayments(a.id,f)}catch(n){e=!0,t+=`${a.name}: ${n instanceof Error?n.message:"生成失敗"}\n`}e?I(t,{variant:"warning"}):I("租金收款項目生成完成",{variant:"success"}),await M()}catch(e){I("生成租金收款項目時發生錯誤",{variant:"error"})}finally{x(!1)}},variant:"contained",disabled:!A.some((e=>e.selected)),"aria-label":"確認生成選擇的收款項目",tabIndex:0,children:"生成"})]})]})]})}},506523:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(231601),r=n.n(a),l=n(576314),i=n.n(l)()(r());i.push([e.id,"body {\n    margin: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n        sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n}\n\ncode {\n    font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n        monospace;\n}\n\n/* 全局樣式 */\n.container {\n    padding: 20px;\n}\n\n/* 表格樣式優化 */\n.MuiTableContainer-root {\n    margin-top: 16px;\n    margin-bottom: 16px;\n}\n\n/* 表單元素間距 */\n.MuiFormControl-root {\n    margin: 8px 0;\n}\n\n/* 按鈕間距 */\n.MuiButton-root {\n    margin: 4px;\n}\n\n/* 卡片樣式 */\n.MuiCard-root {\n    margin: 16px 0;\n}\n\n/* 統計數據區塊樣式 */\n.statistics-box {\n    background-color: #f5f5f5;\n    padding: 16px;\n    border-radius: 8px;\n    margin-bottom: 16px;\n}\n\n/* 狀態標籤樣式 */\n.status-chip {\n    min-width: 80px;\n}\n\n/* 表格行高度 */\n.MuiTableRow-root {\n    height: 60px;\n}\n\n/* 表格單元格內容垂直居中 */\n.MuiTableCell-root {\n    vertical-align: middle;\n}",""]);const s=i},517192:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(474848),r=n(296540),l=n(264456),i=n(859325),s=n(484976);t.default=()=>{const e=(0,s.useNavigate)(),t=(0,s.useLocation)(),[n,o]=(0,r.useState)((()=>localStorage.getItem("app_version")||"1.0")),c=(new Date).getFullYear();(0,r.useEffect)((()=>{localStorage.setItem("app_version",n)}),[n]);const d=[{text:"會員管理",icon:(0,a.jsx)(i.People,{}),path:"/users"},{text:"會費管理",icon:(0,a.jsx)(i.Receipt,{}),path:"/fees"},{text:"公司資訊",icon:(0,a.jsx)(i.Business,{}),path:"/companies"},{text:"投資管理",icon:(0,a.jsx)(i.AccountBalance,{}),path:"/investment"},{text:"會員服務",icon:(0,a.jsx)(i.Support,{}),path:"/services"},{text:"交易支付",icon:(0,a.jsx)(i.Payment,{}),path:"/payment"},{text:"通知提醒",icon:(0,a.jsx)(i.Notifications,{}),path:"/notifications"},{text:"安全隱私",icon:(0,a.jsx)(i.Security,{}),path:"/security"}];return(0,a.jsxs)(l.Drawer,{variant:"permanent",sx:{width:"240px",flexShrink:0,position:"fixed",height:"100vh","& .MuiDrawer-paper":{width:"240px",boxSizing:"border-box",borderRight:"1px solid rgba(0, 0, 0, 0.12)",backgroundColor:"#fff",position:"fixed",height:"100vh",display:"flex",flexDirection:"column"}},children:[(0,a.jsx)(l.Toolbar,{})," ",(0,a.jsx)(l.Box,{sx:{overflow:"auto",flex:1},children:(0,a.jsx)(l.List,{children:d.map((n=>(0,a.jsx)(l.ListItem,{disablePadding:!0,children:(0,a.jsxs)(l.ListItemButton,{selected:t.pathname===n.path,onClick:()=>e(n.path),sx:{"&.Mui-selected":{backgroundColor:"rgba(25, 118, 210, 0.08)"},"&.Mui-selected:hover":{backgroundColor:"rgba(25, 118, 210, 0.12)"},py:1.5},children:[(0,a.jsx)(l.ListItemIcon,{sx:{minWidth:40},children:n.icon}),(0,a.jsx)(l.ListItemText,{primary:n.text})]})},n.path)))})}),(0,a.jsxs)(l.Box,{sx:{p:2,borderTop:"1px solid rgba(0, 0, 0, 0.12)",backgroundColor:"#f5f5f5"},children:[(0,a.jsxs)(l.Typography,{variant:"caption",component:"div",align:"center",color:"text.secondary",sx:{mb:1},children:["Copy Right © ",c," XXXX"]}),(0,a.jsxs)(l.Typography,{variant:"caption",component:"div",align:"center",sx:{cursor:"pointer",userSelect:"none","&:hover":{color:"primary.main"}},onMouseDown:e=>{const t=0===e.button,a=n.split("."),r=parseInt(a[0]);let l=parseInt(a[1]);if(t){l=9===l?0:l+1;o(`${0===l?r+1:r}.${l}`)}else if(2===e.button){if(e.preventDefault(),1===r&&0===l)return;l=0===l?9:l-1;o(`${9===l?r-1:r}.${l}`)}},onContextMenu:e=>e.preventDefault(),children:["Version ",n]})]})]})}},531114:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=n(859325),o=n(64545),c=a(n(825734)),d=a(n(455549)),m=a(n(229704));t.default=()=>{const[e,t]=(0,l.useState)([]),[n,a]=(0,l.useState)(!0),[u,h]=(0,l.useState)(null),[x,p]=(0,l.useState)(!1),[g,y]=(0,l.useState)(null),[j,b]=(0,l.useState)("");(0,l.useEffect)((()=>{v()}),[]);const v=async()=>{a(!0);try{const e=await o.ApiService.getCompanies();t(e)}catch(e){h("載入公司資料失敗")}finally{a(!1)}},f=e.filter((e=>{var t,n;if(!j)return!0;const a=j.toLowerCase();return e.companyNo.toLowerCase().includes(a)||e.name.toLowerCase().includes(a)||(null===(t=e.nameEn)||void 0===t?void 0:t.toLowerCase().includes(a))||e.taxId.toLowerCase().includes(a)||e.address.toLowerCase().includes(a)||(null===(n=e.fax)||void 0===n?void 0:n.toLowerCase().includes(a))||e.contact.name.toLowerCase().includes(a)||e.contact.email.toLowerCase().includes(a)||e.contact.phone.toLowerCase().includes(a)}));return n?(0,r.jsx)(c.default,{}):u?(0,r.jsx)(d.default,{message:u}):(0,r.jsxs)(i.Box,{sx:{p:3},children:[(0,r.jsxs)(i.Toolbar,{sx:{mb:2},children:[(0,r.jsx)(i.Typography,{variant:"h6",component:"div",sx:{flexGrow:1},children:"公司資訊管理"}),(0,r.jsx)(i.TextField,{size:"small",placeholder:"搜尋公司...",value:j,onChange:e=>b(e.target.value),sx:{mr:2,width:300},InputProps:{startAdornment:(0,r.jsx)(i.InputAdornment,{position:"start",children:(0,r.jsx)(s.Search,{})}),endAdornment:j&&(0,r.jsx)(i.InputAdornment,{position:"end",children:(0,r.jsx)(i.IconButton,{size:"small",onClick:()=>b(""),children:(0,r.jsx)(s.Clear,{})})})}}),(0,r.jsx)(i.Button,{variant:"contained",startIcon:(0,r.jsx)(s.Add,{}),onClick:()=>{y(null),p(!0)},children:"新增公司"})]}),(0,r.jsx)(i.TableContainer,{component:i.Paper,children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHead,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"公司編號"}),(0,r.jsx)(i.TableCell,{children:"統一編號"}),(0,r.jsx)(i.TableCell,{children:"公司名稱"}),(0,r.jsx)(i.TableCell,{children:"英文簡稱"}),(0,r.jsx)(i.TableCell,{children:"產業類別"}),(0,r.jsx)(i.TableCell,{children:"聯絡人"}),(0,r.jsx)(i.TableCell,{children:"聯絡電話"}),(0,r.jsx)(i.TableCell,{children:"傳真"}),(0,r.jsx)(i.TableCell,{children:"電子郵件"}),(0,r.jsx)(i.TableCell,{children:"備註"}),(0,r.jsx)(i.TableCell,{children:"操作"})]})}),(0,r.jsx)(i.TableBody,{children:f.map((e=>(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:e.companyNo}),(0,r.jsx)(i.TableCell,{children:e.taxId}),(0,r.jsx)(i.TableCell,{children:e.name}),(0,r.jsx)(i.TableCell,{children:e.nameEn}),(0,r.jsx)(i.TableCell,{children:e.industry&&(0,r.jsx)(i.Chip,{label:e.industry,color:"primary",size:"small"})}),(0,r.jsx)(i.TableCell,{children:e.contact.name}),(0,r.jsx)(i.TableCell,{children:e.contact.phone}),(0,r.jsx)(i.TableCell,{children:e.fax||"-"}),(0,r.jsx)(i.TableCell,{children:e.contact.email}),(0,r.jsx)(i.TableCell,{children:e.note||"-"}),(0,r.jsxs)(i.TableCell,{children:[(0,r.jsx)(i.IconButton,{size:"small",onClick:()=>(e=>{y(e),p(!0)})(e),children:(0,r.jsx)(s.Edit,{})}),(0,r.jsx)(i.IconButton,{size:"small",color:"error",onClick:()=>(async e=>{if(window.confirm("確定要刪除此公司資料？")){a(!0);try{await o.ApiService.deleteCompany(e),await v()}catch(e){h("刪除公司失敗")}finally{a(!1)}}})(e.id),children:(0,r.jsx)(s.Delete,{})})]})]},e.id)))})]})}),(0,r.jsx)(m.default,{open:x,onClose:()=>p(!1),companyData:g,onSave:async e=>{a(!0);try{e.id?await o.ApiService.updateCompany(e.id,e):await o.ApiService.createCompany(e),await v(),p(!1)}catch(e){h("儲存公司資料失敗")}finally{a(!1)}}})]})}},532216:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>y});var a=n(785072),r=n.n(a),l=n(697825),i=n.n(l),s=n(777659),o=n.n(s),c=n(655056),d=n.n(c),m=n(510540),u=n.n(m),h=n(341113),x=n.n(h),p=n(506523),g={};g.styleTagTransform=x(),g.setAttributes=d(),g.insert=o().bind(null,"head"),g.domAPI=i(),g.insertStyleElement=u();r()(p.A,g);const y=p.A&&p.A.locals?p.A.locals:void 0},533736:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=n(491178),o=n(853729),c=n(892278),d=a(n(974353)),m=n(583380);t.default=({open:e,onClose:t,onSave:n,investment:a})=>{const[u,h]=(0,l.useState)((()=>({companyId:(null==a?void 0:a.companyId)||"",userId:"",type:(null==a?void 0:a.type)||"movable",name:(null==a?void 0:a.name)||"",description:(null==a?void 0:a.description)||"",amount:(null==a?void 0:a.amount)||0,startDate:(null==a?void 0:a.startDate)||(0,d.default)().format("YYYY-MM-DD"),endDate:(null==a?void 0:a.endDate)||"",status:(null==a?void 0:a.status)||"pending",assetType:"movable"===(null==a?void 0:a.type)?a.assetType:"",serialNumber:"movable"===(null==a?void 0:a.type)?a.serialNumber:"",manufacturer:"movable"===(null==a?void 0:a.type)?a.manufacturer:"",location:"immovable"===(null==a?void 0:a.type)?a.location:"",area:"immovable"===(null==a?void 0:a.type)?a.area:0,propertyType:"immovable"===(null==a?void 0:a.type)?a.propertyType:"",registrationNumber:"immovable"===(null==a?void 0:a.type)?a.registrationNumber:""}))),[x,p]=(0,l.useState)({}),[g,y]=(0,l.useState)([]),[j,b]=(0,l.useState)([]);(0,l.useEffect)((()=>{h(a?{...a,userId:a.userId||"",assetType:"movable"===a.type?a.assetType:"",serialNumber:"movable"===a.type?a.serialNumber:"",manufacturer:"movable"===a.type?a.manufacturer:"",location:"immovable"===a.type?a.location:"",area:"immovable"===a.type?a.area:0,propertyType:"immovable"===a.type?a.propertyType:"",registrationNumber:"immovable"===a.type?a.registrationNumber:""}:{type:"movable",name:"",description:"",amount:0,startDate:(0,d.default)().format("YYYY-MM-DD"),status:"pending",companyId:"",userId:"",assetType:"",serialNumber:"",manufacturer:"",location:"",area:0,propertyType:"",registrationNumber:""}),p({}),v(),f()}),[a]);const v=async()=>{try{const e=await m.ApiService.getCompanies();y(e)}catch(e){console.error("載入公司資料失敗:",e)}},f=async()=>{try{const e=await m.ApiService.getUsers();b(e)}catch(e){console.error("載入會員資料失敗:",e)}},T=e=>t=>{const n=t.target.value;h((t=>({...t,[e]:n}))),x[e]&&p((t=>({...t,[e]:""})))},S=e=>t=>{h((n=>({...n,[e]:t.target.value})))},C=e=>t=>{h((n=>({...n,[e]:t?t.format("YYYY-MM-DD"):""})))};return(0,r.jsxs)(i.Dialog,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[(0,r.jsx)(i.DialogTitle,{children:a?"編輯投資":"新增投資"}),(0,r.jsx)(i.DialogContent,{children:(0,r.jsxs)(i.Grid,{container:!0,spacing:2,sx:{mt:1},children:[(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.Typography,{variant:"subtitle1",gutterBottom:!0,children:"基本資料"})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"名稱",value:u.name,onChange:T("name"),error:!!x.name,helperText:x.name,required:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsxs)(i.FormControl,{fullWidth:!0,error:!!x.type,children:[(0,r.jsx)(i.InputLabel,{children:"類型"}),(0,r.jsxs)(i.Select,{value:u.type,onChange:S("type"),label:"類型",children:[(0,r.jsx)(i.MenuItem,{value:"movable",children:"動產"}),(0,r.jsx)(i.MenuItem,{value:"immovable",children:"不動產"})]}),x.type&&(0,r.jsx)(i.FormHelperText,{children:x.type})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"描述",value:u.description,onChange:T("description"),multiline:!0,rows:2})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"投資金額",type:"number",value:u.amount,onChange:T("amount"),error:!!x.amount,helperText:x.amount,required:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsxs)(i.FormControl,{fullWidth:!0,error:!!x.status,children:[(0,r.jsx)(i.InputLabel,{children:"狀態"}),(0,r.jsxs)(i.Select,{value:u.status,onChange:S("status"),label:"狀態",children:[(0,r.jsx)(i.MenuItem,{value:"pending",children:"審核中"}),(0,r.jsx)(i.MenuItem,{value:"active",children:"進行中"}),(0,r.jsx)(i.MenuItem,{value:"completed",children:"已完成"}),(0,r.jsx)(i.MenuItem,{value:"terminated",children:"已終止"})]}),x.status&&(0,r.jsx)(i.FormHelperText,{children:x.status})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsx)(o.LocalizationProvider,{dateAdapter:c.AdapterDayjs,children:(0,r.jsx)(s.DatePicker,{label:"開始日期",value:(0,d.default)(u.startDate),onChange:C("startDate"),slotProps:{textField:{fullWidth:!0,error:!!x.startDate,helperText:x.startDate}}})})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsx)(o.LocalizationProvider,{dateAdapter:c.AdapterDayjs,children:(0,r.jsx)(s.DatePicker,{label:"結束日期",value:u.endDate?(0,d.default)(u.endDate):null,onChange:C("endDate"),slotProps:{textField:{fullWidth:!0}}})})}),"movable"===u.type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.Typography,{variant:"subtitle1",gutterBottom:!0,children:"動產資料"})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"資產類型",value:u.assetType,onChange:T("assetType")})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"序號",value:u.serialNumber,onChange:T("serialNumber")})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"製造商",value:u.manufacturer,onChange:T("manufacturer")})})]}),"immovable"===u.type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.Typography,{variant:"subtitle1",gutterBottom:!0,children:"不動產資料"})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"位置",value:u.location,onChange:T("location")})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"面積",type:"number",value:u.area,onChange:T("area")})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,md:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"地號",value:u.registrationNumber,onChange:T("registrationNumber")})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"用地類型",value:u.propertyType,onChange:T("propertyType")})})]}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsxs)(i.FormControl,{fullWidth:!0,error:!!x.companyId,children:[(0,r.jsx)(i.InputLabel,{children:"所屬公司"}),(0,r.jsxs)(i.Select,{value:u.companyId||"",onChange:S("companyId"),label:"所屬公司",children:[(0,r.jsx)(i.MenuItem,{value:"",children:"無"}),g.map((e=>(0,r.jsx)(i.MenuItem,{value:e.id,children:e.name},e.id)))]}),x.companyId&&(0,r.jsx)(i.FormHelperText,{children:x.companyId})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsxs)(i.FormControl,{fullWidth:!0,error:!!x.userId,children:[(0,r.jsx)(i.InputLabel,{children:"所屬會員"}),(0,r.jsxs)(i.Select,{value:u.userId||"",onChange:S("userId"),label:"所屬會員",children:[(0,r.jsx)(i.MenuItem,{value:"",children:"無"}),j.map((e=>(0,r.jsxs)(i.MenuItem,{value:e.id,children:[e.name," (",e.memberNo,")"]},e.id)))]}),x.userId&&(0,r.jsx)(i.FormHelperText,{children:x.userId})]})})]})}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:t,children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{if((()=>{const e={};return u.name||(e.name="請輸入投資名稱"),u.type||(e.type="請選擇投資類型"),(!u.amount||u.amount<=0)&&(e.amount="請輸入有效的投資金額"),u.startDate||(e.startDate="請選擇開始日期"),u.companyId||(e.companyId="請選擇所屬公司"),u.userId||(e.userId="請選擇所屬會員"),"movable"===u.type?(u.assetType||(e.assetType="請輸入資產類型"),u.serialNumber||(e.serialNumber="請輸入序號")):"immovable"===u.type&&(u.location||(e.location="請輸入位置"),u.propertyType||(e.propertyType="請輸入物業類型"),u.registrationNumber||(e.registrationNumber="請輸入登記號碼")),p(e),0===Object.keys(e).length})())try{await n(u),t()}catch(e){console.error("Failed to save investment:",e)}},variant:"contained",color:"primary",children:"保存"})]})]})}},549140:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=n(859325),o=n(64545),c=n(500523),d=a(n(825734)),m=a(n(455549));t.default=({investments:e})=>{const[t,n]=(0,l.useState)([]),[a,u]=(0,l.useState)(!0),[h,x]=(0,l.useState)(null),[p,g]=(0,l.useState)(!1),[y,j]=(0,l.useState)(null),[b,v]=(0,l.useState)({investmentId:"",monthlyRent:0,startDate:"",endDate:"",renterName:"",renterTaxId:"",note:""});(0,l.useEffect)((()=>{f()}),[]);const f=async()=>{u(!0);try{const[e,t]=await Promise.all([o.ApiService.getInvestments(),o.ApiService.getRentalStandards()]);n(t)}catch(e){x("載入資料失敗")}finally{u(!1)}},T=e=>t=>{v({...b,[e]:t.target.value})};return a?(0,r.jsx)(d.default,{}):h?(0,r.jsx)(m.default,{message:h}):(0,r.jsxs)(i.Box,{children:[(0,r.jsxs)(i.Box,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(i.Typography,{variant:"h6",children:"租賃標準設定"}),(0,r.jsx)(i.Button,{variant:"contained",startIcon:(0,r.jsx)(s.Add,{}),onClick:()=>{j(null),v({investmentId:"",monthlyRent:0,startDate:"",endDate:"",renterName:"",renterTaxId:"",note:""}),g(!0)},children:"新增租賃標準"})]}),(0,r.jsx)(i.TableContainer,{component:i.Paper,children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHead,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"投資項目"}),(0,r.jsx)(i.TableCell,{align:"right",children:"月租金"}),(0,r.jsx)(i.TableCell,{children:"生效日期"}),(0,r.jsx)(i.TableCell,{children:"結束日期"}),(0,r.jsx)(i.TableCell,{children:"承租人"}),(0,r.jsx)(i.TableCell,{children:"備註"}),(0,r.jsx)(i.TableCell,{children:"操作"})]})}),(0,r.jsxs)(i.TableBody,{children:[t.map((t=>{const n=e.find((e=>e.id===t.investmentId));return(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:(null==n?void 0:n.name)||"未知項目"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(t.monthlyRent)}),(0,r.jsx)(i.TableCell,{children:(0,c.formatDate)(t.startDate)}),(0,r.jsx)(i.TableCell,{children:t.endDate?(0,c.formatDate)(t.endDate):"-"}),(0,r.jsx)(i.TableCell,{children:t.renterName}),(0,r.jsx)(i.TableCell,{children:t.note||"-"}),(0,r.jsxs)(i.TableCell,{children:[(0,r.jsx)(i.IconButton,{size:"small",onClick:()=>(e=>{j(e),v({investmentId:e.investmentId,monthlyRent:e.monthlyRent,startDate:e.startDate,endDate:e.endDate||"",renterName:e.renterName||"",renterTaxId:e.renterTaxId||"",note:e.note||""}),g(!0)})(t),children:(0,r.jsx)(s.Edit,{})}),(0,r.jsx)(i.IconButton,{size:"small",color:"error",onClick:()=>(async e=>{if(window.confirm("確定要刪除此租賃標準？")){u(!0);try{await o.ApiService.deleteRentalStandard(e),await f()}catch(e){x("刪除租賃標準失敗")}finally{u(!1)}}})(t.id),children:(0,r.jsx)(s.Delete,{})})]})]},t.id)})),0===t.length&&(0,r.jsx)(i.TableRow,{children:(0,r.jsx)(i.TableCell,{colSpan:6,align:"center",children:"尚無租賃標準資料"})})]})]})}),(0,r.jsxs)(i.Dialog,{open:p,onClose:()=>g(!1),maxWidth:"sm",fullWidth:!0,children:[(0,r.jsx)(i.DialogTitle,{children:y?"編輯租賃標準":"新增租賃標準"}),(0,r.jsx)(i.DialogContent,{children:(0,r.jsxs)(i.Grid,{container:!0,spacing:2,sx:{mt:1},children:[(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{select:!0,fullWidth:!0,label:"投資項目",value:b.investmentId,onChange:T("investmentId"),required:!0,children:e.map((e=>(0,r.jsx)(i.MenuItem,{value:e.id,children:e.name},e.id)))})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"月租金",type:"number",value:b.monthlyRent,onChange:T("monthlyRent"),required:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"生效日期",type:"date",value:b.startDate,onChange:T("startDate"),required:!0,InputLabelProps:{shrink:!0}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"結束日期",type:"date",value:b.endDate,onChange:T("endDate"),InputLabelProps:{shrink:!0}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"承租人姓名",value:b.renterName,onChange:T("renterName"),required:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"統一編號",value:b.renterTaxId,onChange:T("renterTaxId")})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"備註",multiline:!0,rows:3,value:b.note,onChange:T("note")})})]})}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:()=>g(!1),children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{if(b.investmentId&&b.monthlyRent&&b.startDate){u(!0);try{y?await o.ApiService.updateRentalStandard(y.id,b):await o.ApiService.createRentalStandard(b),await f(),g(!1)}catch(e){x("儲存租賃標準失敗")}finally{u(!1)}}else x("請填寫必要欄位")},variant:"contained",children:"儲存"})]})]})]})}},583380:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiServiceInstance=t.ApiService=void 0;const r=n(65980),l=a(n(686425)),i=n(409938);class s{constructor(){}static getInstance(){return s.instance||(s.instance=new s),s.instance}static loadUsersFromStorage(){const e=localStorage.getItem("users");e?s.mockUsers=JSON.parse(e):(s.mockUsers=[{id:"1",memberNo:"M001",username:"admin",name:"管理員",email:"admin@example.com",role:"admin",status:"active",preferences:[],isFirstLogin:!1,createdAt:"2025-01-01T00:00:00Z",updatedAt:"2025-01-01T00:00:00Z"}],localStorage.setItem("users",JSON.stringify(s.mockUsers)))}static saveUsersToStorage(){localStorage.setItem("users",JSON.stringify(s.mockUsers))}static async getUsers(){return 0===s.mockUsers.length&&s.loadUsersFromStorage(),Promise.resolve([...s.mockUsers])}static async createUser(e){var t;console.log("Creating user:",e);const n={...e,id:e.id||crypto.randomUUID(),memberNo:e.memberNo||await this.generateMemberNo(e.role),createdAt:e.createdAt||(new Date).toISOString(),updatedAt:(new Date).toISOString(),preferences:e.preferences||[],isFirstLogin:null===(t=e.isFirstLogin)||void 0===t||t,status:e.status||"active"};return console.log("New user to be created:",n),s.mockUsers.push(n),s.saveUsersToStorage(),Promise.resolve(n)}static async updateUser(e){if(console.log("Updating user:",e),console.log("Current users:",s.mockUsers),!e.id)throw new Error("會員 ID 不能為空");const t=s.mockUsers.findIndex((t=>t.id===e.id));if(console.log("Found user index:",t),-1===t)throw new Error(`會員不存在 (ID: ${e.id})`);const n={...s.mockUsers[t],...e,updatedAt:(new Date).toISOString()};return console.log("Updated user:",n),s.mockUsers[t]=n,s.saveUsersToStorage(),Promise.resolve(n)}static async deleteUser(e){const t=s.mockUsers.findIndex((t=>t.id===e));if(-1===t)throw new Error("會員不存在");return s.mockUsers.splice(t,1),s.saveUsersToStorage(),Promise.resolve()}static async generateMemberNo(e){const t=(await this.getUsers()).filter((t=>t.role===e)).length;return`${r.USER_ROLE_PREFIX[e]}${String(t+1).padStart(3,"0")}`}static async generateCompanyNo(){const e=(await this.getCompanies()).length;return`A${String(e+1).padStart(3,"0")}`}static async getNewCompanyNo(){return this.generateCompanyNo()}async getData(e){const t=localStorage.getItem(e);return t?JSON.parse(t):null}async setData(e,t){localStorage.setItem(e,JSON.stringify(t))}static loadInvestmentsFromStorage(){console.log("正在載入投資資料從本地存儲...");const e=localStorage.getItem("investments");if(e)try{s.investments=JSON.parse(e),console.log(`已載入 ${s.investments.length} 筆投資資料`)}catch(e){console.error("解析投資資料時發生錯誤:",e),s.investments=[]}else{console.log("本地存儲中無投資資料，使用默認值");const e=s.mockMembers.map((e=>e.id)),t=e.length>0?e[0]:"6e74484c-af9c-4a4e-be82-c91d65000c29";console.log("使用預設會員ID:",t),console.log("可用會員列表:",s.mockMembers.map((e=>`${e.name}(${e.id})`))),s.investments=[{id:"1",companyId:"1",userId:t,type:"movable",name:"設備投資A",description:"生產線設備",amount:1e6,startDate:"2023-01-01",status:"active",assetType:"機械設備",serialNumber:"EQ-001",manufacturer:"台灣機械",createdAt:"2023-01-01T00:00:00Z",updatedAt:"2023-01-01T00:00:00Z"},{id:"2",companyId:"2",userId:t,type:"immovable",name:"不動產投資B",description:"商業辦公室",amount:5e6,startDate:"2023-02-01",status:"active",location:"台北市信義區",area:150,propertyType:"商業辦公室",registrationNumber:"LD-002",createdAt:"2023-02-01T00:00:00Z",updatedAt:"2023-02-01T00:00:00Z"}],console.log("已初始化預設投資資料")}localStorage.setItem("investments",JSON.stringify(s.investments))}static saveInvestmentsToStorage(){localStorage.setItem("investments",JSON.stringify(s.investments))}static async getInvestments(){console.log("獲取所有投資項目..."),0===s.investments.length&&s.loadInvestmentsFromStorage();const e=Array.from(s.investments);return console.log(`返回 ${e.length} 筆投資項目`),Promise.resolve(e)}static async getInvestment(e){console.log(`正在查找投資項目 ID: ${e}`),0===s.investments.length&&s.loadInvestmentsFromStorage();const t=s.investments.find((t=>t.id===e));return console.log("查找結果:",t?"找到項目":"未找到項目"),Promise.resolve(t||null)}static async createInvestment(e){let t;return t="movable"===e.type?await s.createMovableInvestment(e):"immovable"===e.type?await s.createImmovableInvestment(e):await s.createMovableInvestment({...e,type:"movable"}),s.investments.push(t),s.saveInvestmentsToStorage(),Promise.resolve(t)}static async updateInvestment(e){const t=s.investments.findIndex((t=>t.id===e.id));if(-1===t)throw new Error("Investment not found");const n={...e,updatedAt:(new Date).toISOString()};return s.investments[t]=n,s.saveInvestmentsToStorage(),Promise.resolve(n)}static async deleteInvestment(e){const t=s.investments.findIndex((t=>t.id===e));if(-1===t)throw new Error("Investment not found");return s.investments.splice(t,1),s.saveInvestmentsToStorage(),Promise.resolve()}static loadCompaniesFromStorage(){const e=localStorage.getItem("companies");e&&(s.mockCompanies=JSON.parse(e))}static saveCompaniesToStorage(){localStorage.setItem("companies",JSON.stringify(s.mockCompanies))}static async getCompanies(){return 0===s.mockCompanies.length&&s.loadCompaniesFromStorage(),Promise.resolve([...s.mockCompanies])}static async getCompany(e){0===s.mockCompanies.length&&s.loadCompaniesFromStorage();const t=s.mockCompanies.find((t=>t.id===e));return Promise.resolve(t||null)}static async createCompany(e){0===s.mockCompanies.length&&s.loadCompaniesFromStorage();const t={id:crypto.randomUUID(),companyNo:await this.generateCompanyNo(),taxId:e.taxId||"",name:e.name||"",nameEn:e.nameEn,industry:e.industry||"other",address:e.address||"",contact:e.contact||{name:"",phone:"",email:""},fax:e.fax||"",note:e.note||"",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};return s.mockCompanies.push(t),s.saveCompaniesToStorage(),Promise.resolve(t)}static async updateCompany(e,t){0===s.mockCompanies.length&&s.loadCompaniesFromStorage();const n=s.mockCompanies.findIndex((t=>t.id===e));if(-1===n)throw new Error("公司不存在");const a={...s.mockCompanies[n],...t,updatedAt:(new Date).toISOString()};return s.mockCompanies[n]=a,s.saveCompaniesToStorage(),Promise.resolve(a)}static async deleteCompany(e){0===s.mockCompanies.length&&s.loadCompaniesFromStorage();const t=s.mockCompanies.findIndex((t=>t.id===e));if(-1===t)throw new Error("公司不存在");return s.mockCompanies.splice(t,1),s.saveCompaniesToStorage(),Promise.resolve()}static async createMovableInvestment(e){return{id:e.id||crypto.randomUUID(),companyId:e.companyId||"",userId:e.userId||"",type:"movable",name:e.name||"",description:e.description||"",amount:e.amount||0,startDate:e.startDate||(new Date).toISOString(),endDate:e.endDate,status:e.status||"active",assetType:e.assetType||"",serialNumber:e.serialNumber||"",manufacturer:e.manufacturer||"",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}}static async createImmovableInvestment(e){return{id:e.id||crypto.randomUUID(),companyId:e.companyId||"",userId:e.userId||"",type:"immovable",name:e.name||"",description:e.description||"",amount:e.amount||0,startDate:e.startDate||(new Date).toISOString(),endDate:e.endDate,status:e.status||"active",location:e.location||"",area:e.area||0,propertyType:e.propertyType||"",registrationNumber:e.registrationNumber||"",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}}static async getUserPreferences(e){const t=s.mockUsers.find((t=>t.id===e));return Promise.resolve((null==t?void 0:t.preferences)||[])}static async updateUserPreferences(e,t){const n=s.mockUsers.findIndex((t=>t.id===e));if(-1===n)throw new Error("User not found");return s.mockUsers[n].preferences=t,Promise.resolve(t)}static loadRentalStandardsFromStorage(){const e=localStorage.getItem("rentalStandards");e?s.mockRentalStandards=JSON.parse(e):(s.mockRentalStandards=[{id:"1",investmentId:"1",monthlyRent:1e4,startDate:"2023-01-01",endDate:"2026-12-31",renterName:"LKT",renterTaxId:"123456789",note:"Standard rental agreement",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}],localStorage.setItem("rentalStandards",JSON.stringify(s.mockRentalStandards)))}static saveRentalStandardsToStorage(){localStorage.setItem("rentalStandards",JSON.stringify(s.mockRentalStandards))}static loadProfitSharingStandardsFromStorage(){const e=localStorage.getItem("profitSharingStandards");e?s.mockProfitSharingStandards=JSON.parse(e):(s.mockProfitSharingStandards=[{id:"1",investmentId:"1",type:i.ProfitSharingType.PERCENTAGE,value:10,startDate:"2023-01-01",endDate:"2026-12-31",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}],localStorage.setItem("profitSharingStandards",JSON.stringify(s.mockProfitSharingStandards)))}static saveProfitSharingStandardsToStorage(){localStorage.setItem("profitSharingStandards",JSON.stringify(s.mockProfitSharingStandards))}static async getRentalStandards(e){0===s.mockRentalStandards.length&&s.loadRentalStandardsFromStorage();let t=[...s.mockRentalStandards];return e&&(t=t.filter((t=>t.investmentId===e))),Promise.resolve(t)}static async createRentalStandard(e){const t={id:crypto.randomUUID(),investmentId:e.investmentId||"",monthlyRent:e.monthlyRent||0,startDate:e.startDate||(new Date).toISOString(),endDate:e.endDate,renterName:e.renterName||"",renterTaxId:e.renterTaxId,note:e.note,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};return s.mockRentalStandards.push(t),s.saveRentalStandardsToStorage(),Promise.resolve(t)}static async updateRentalStandard(e,t){const n=s.mockRentalStandards.findIndex((t=>t.id===e));if(-1===n)throw new Error("租賃標準不存在");const a={...s.mockRentalStandards[n],...t,updatedAt:(new Date).toISOString()};return s.mockRentalStandards[n]=a,s.saveRentalStandardsToStorage(),Promise.resolve(a)}static async deleteRentalStandard(e){const t=s.mockRentalStandards.findIndex((t=>t.id===e));if(-1===t)throw new Error("租賃標準不存在");return s.mockRentalStandards.splice(t,1),s.saveRentalStandardsToStorage(),Promise.resolve()}static async getProfitSharingStandards(e){0===s.mockProfitSharingStandards.length&&s.loadProfitSharingStandardsFromStorage();let t=[...s.mockProfitSharingStandards];return e&&(t=t.filter((t=>t.investmentId===e))),Promise.resolve(t)}static async createProfitSharingStandard(e){const t={...e,id:crypto.randomUUID(),createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};return s.mockProfitSharingStandards.push(t),s.saveProfitSharingStandardsToStorage(),Promise.resolve(t)}static async updateProfitSharingStandard(e,t){const n=s.mockProfitSharingStandards.findIndex((t=>t.id===e));if(-1===n)throw new Error("分潤標準不存在");const a={...s.mockProfitSharingStandards[n],...t,updatedAt:(new Date).toISOString()};return s.mockProfitSharingStandards[n]=a,s.saveProfitSharingStandardsToStorage(),Promise.resolve(a)}static async deleteProfitSharingStandard(e){const t=s.mockProfitSharingStandards.findIndex((t=>t.id===e));if(-1===t)throw new Error("分潤標準不存在");return s.mockProfitSharingStandards.splice(t,1),s.saveProfitSharingStandardsToStorage(),Promise.resolve()}static loadRentalPaymentsFromStorage(){const e=localStorage.getItem("rentalPayments");e?s.mockRentalPayments=JSON.parse(e):(s.mockRentalPayments=[],localStorage.setItem("rentalPayments",JSON.stringify(s.mockRentalPayments)))}static saveRentalPaymentsToStorage(){localStorage.setItem("rentalPayments",JSON.stringify(s.mockRentalPayments))}static async getRentalPayments(e,t,n){0===s.mockRentalPayments.length&&s.loadRentalPaymentsFromStorage();let a=[...s.mockRentalPayments].map((e=>({...e,amount:Number(e.amount)})));return e&&(a=a.filter((t=>t.investmentId===e))),t&&(a=a.filter((e=>e.year===t))),n&&(a=a.filter((e=>e.month===n))),Promise.resolve(a)}static async generateRentalPayments(e,t){try{await s.loadRentalPaymentsFromStorage(),await s.loadRentalStandardsFromStorage();if(s.mockRentalPayments.filter((n=>n.investmentId===e&&n.year===t)).length>0)throw new Error("該年度的租金收款項目已經存在，請勿重複生成");const n=s.mockRentalStandards.filter((t=>t.investmentId===e&&t.startDate&&t.endDate));if(!n||0===n.length)throw new Error("尚未設定租賃標準");const a=n.find((e=>{if(!e.startDate||!e.endDate)return!1;const n=new Date(e.startDate),a=new Date(e.endDate),r=new Date(t,0,1);return n<=new Date(t,11,31)&&a>=r}));if(!a||!a.startDate||!a.endDate)throw new Error("找不到適用於該年度的租賃標準");if(!a.renterName)throw new Error("租賃標準中未設定承租人資訊");const r=new Date(a.startDate),l=new Date(a.endDate);let o=0,c=11;t===r.getFullYear()&&(o=r.getMonth()),t===l.getFullYear()&&(c=l.getMonth());const d=[];for(let n=o;n<=c;n++){const r=new Date(t,n,1),l=new Date(t,n+1,0),s={id:crypto.randomUUID(),investmentId:e,year:t,month:n+1,amount:a.monthlyRent,startDate:r.toISOString(),endDate:l.toISOString(),renterName:a.renterName,renterTaxId:a.renterTaxId,payerName:a.renterName,status:i.PaymentStatus.PENDING,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};d.push(s)}s.mockRentalPayments=[...s.mockRentalPayments,...d],await s.saveRentalPaymentsToStorage()}catch(e){throw console.error("生成租金收款項目時發生錯誤:",e),e}}static async updateRentalPayment(e,t){const n=s.mockRentalPayments.findIndex((t=>t.id===e));if(-1===n)throw new Error("租金收款項目不存在");const a={...s.mockRentalPayments[n],...t,updatedAt:(new Date).toISOString()};return s.mockRentalPayments[n]=a,s.saveRentalPaymentsToStorage(),Promise.resolve(a)}static async deleteRentalPayment(e){const t=s.mockRentalPayments.findIndex((t=>t.id===e));if(-1===t)throw new Error("Rental payment not found");return s.mockRentalPayments.splice(t,1),s.saveRentalPaymentsToStorage(),Promise.resolve()}static async clearRentalPayments(e,t){console.log(`開始清除租金收款記錄 - 年度: ${e}, 月份: ${t}`);try{if(!e)return Promise.resolve();0===s.mockRentalPayments.length&&s.loadRentalPaymentsFromStorage();const n=s.mockRentalPayments.length;s.mockRentalPayments=t?s.mockRentalPayments.filter((n=>n.year!==e||n.month!==t)):s.mockRentalPayments.filter((t=>t.year!==e));const a=n-s.mockRentalPayments.length;return console.log(`租金收款記錄清除完成：刪除 ${a} 筆記錄`),s.saveRentalPaymentsToStorage(),Promise.resolve()}catch(e){return console.error("清除租金收款記錄時發生錯誤:",e),Promise.reject(e)}}static loadMemberProfitsFromStorage(){const e=localStorage.getItem("memberProfits");s.mockMemberProfits=e?JSON.parse(e):[]}static saveMemberProfitsToStorage(){localStorage.setItem("memberProfits",JSON.stringify(s.mockMemberProfits))}static async getMemberProfits(e,t,n,a){0===s.mockMemberProfits.length&&s.loadMemberProfitsFromStorage();const r=[];for(const e of s.mockMemberProfits){const t={id:e.id,investmentId:e.investmentId,memberId:e.memberId,year:e.year,month:e.month,amount:Number(e.amount),status:e.status,paymentDate:e.paymentDate,paymentMethod:e.paymentMethod,note:e.note,createdAt:e.createdAt,updatedAt:e.updatedAt};r.push(t)}let l=r;return e&&(l=l.filter((t=>t.investmentId===e))),t&&(l=l.filter((e=>e.memberId===t))),n&&(l=l.filter((e=>e.year===n))),a&&(l=l.filter((e=>e.month===a))),Promise.resolve(l)}static async generateMemberProfits(e,t){try{s.loadRentalStandardsFromStorage(),s.loadRentalPaymentsFromStorage(),s.loadMemberProfitsFromStorage(),s.loadInvestmentsFromStorage(),console.log("生成會員分潤項目 - 開始",{investmentId:e,year:t});const n=s.mockMemberProfits.filter((n=>n.investmentId===e&&n.year===t));if(n.length>0)throw console.warn("該投資項目已存在分潤項目:",n.length,"筆"),new Error("該投資項目的分潤項目已存在，請勿重複生成");const a=s.investments.find((t=>t.id===e));if(console.log("投資項目",(null==a?void 0:a.name)||(null==a?void 0:a.id)||"未找到"),!a)throw console.error("找不到投資項目:",e),new Error("找不到投資項目");if(!a.userId)throw console.error("投資項目未指定所屬會員:",a.id,a.name),new Error("投資項目未指定所屬會員");console.log("投資項目所屬會員 ID",a.userId);const r=await this.getMembers();console.log("載入會員資料, 共",r.length,"位會員"),console.log("所有會員 ID:",r.map((e=>e.id)));const l=r.find((e=>e.id===a.userId));if(!l){if(console.error("投資項目所屬會員: 未找到"),console.error("找不到會員:",a.userId),r.length>0){console.log("嘗試將投資項目關聯到現有會員...");const n=r[0],l=s.investments.findIndex((t=>t.id===e));if(-1!==l)return s.investments[l].userId=n.id,s.saveInvestmentsToStorage(),console.log(`已更新投資項目 ${a.name} 關聯到會員 ${n.name}(${n.id})`),this.generateMemberProfits(e,t)}throw new Error("找不到所屬會員，請確保投資項目已正確關聯到現有會員")}console.log("找到投資項目所屬會員:",l.name,`(${l.id})`);const o=s.mockRentalPayments.filter((n=>n.investmentId===e&&n.year===t));if(console.log("找到租金收款項目:",o.length,"筆"),0===o.length)throw console.error("未找到租金收款項目:",{investmentId:e,year:t}),new Error("未找到該投資項目的租金收款項目");const c=await this.getProfitSharingStandards(e);if(console.log("載入分潤標準:",c.length,"筆"),0===c.length)throw console.error("未設定分潤標準:",{investmentId:e}),new Error("未設定分潤標準");const d=[];for(const n of c){const a=new Date(n.startDate),r=n.endDate?new Date(n.endDate):new Date(t,11,31);if(console.log("處理分潤標準",{標準ID:n.id,標準開始日期:a.toISOString().split("T")[0],標準結束日期:r.toISOString().split("T")[0],年度:t}),a.getFullYear()>t||r.getFullYear()<t){console.log("跳過不適用的分潤標準",{標準ID:n.id,標準開始年度:a.getFullYear(),標準結束年度:r.getFullYear(),目標年度:t});continue}const s=a.getFullYear()===t?a.getMonth()+1:1,c=r.getFullYear()===t?r.getMonth()+1:12;console.log("計算適用的月份範圍",{標準ID:n.id,開始月份:s,結束月份:c});let m=0;for(let a=s;a<=c;a++){const r=o.find((e=>e.month===a));if(!r){console.warn("找不到對應月份的租金收款項目",{月份:a});continue}console.log("找到對應月份的租金收款項目",{月份:a,租金ID:r.id,金額:r.amount});let s=0;n.type===i.ProfitSharingType.FIXED_AMOUNT?(s=n.value,console.log("使用固定金額分潤:",n.value)):n.type===i.ProfitSharingType.PERCENTAGE&&(s=r.amount*(n.value/100),console.log("使用百分比計算分潤:",{百分比:n.value,計算結果:s}));let c=s;void 0!==n.minAmount&&(s=Math.max(s,n.minAmount),s!==c&&console.log("應用最小金額限制:",{原始金額:c,最小限制:n.minAmount,調整後:s})),c=s,void 0!==n.maxAmount&&(s=Math.min(s,n.maxAmount),s!==c&&console.log("應用最大金額限制:",{原始金額:c,最大限制:n.maxAmount,調整後:s})),s=Math.round(s),console.log(`${a}月份最終分潤金額:`,s);const u={id:crypto.randomUUID(),investmentId:e,memberId:l.id,year:t,month:a,amount:s,status:i.PaymentStatus.PENDING,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};d.push(u),m++}console.log(`依照分潤標準 ${n.id} 生成了 ${m} 筆分潤記錄`)}if(console.log(`總共生成 ${d.length} 筆會員分潤項目`),0===d.length)throw console.error("無法生成分潤項目:",{investmentId:e,year:t}),new Error("無法生成分潤項目，請檢查分潤標準的生效日期");return s.mockMemberProfits.push(...d),s.saveMemberProfitsToStorage(),console.log("分潤項目已保存到本地存儲"),Promise.resolve(d)}catch(e){return console.error("生成會員分潤項目失敗:",e),Promise.reject(e)}}static async updateMemberProfit(e,t){const n=s.mockMemberProfits.findIndex((t=>t.id===e));if(-1===n)throw new Error("會員分潤項目不存在");const a={...s.mockMemberProfits[n],...t,updatedAt:(new Date).toISOString()};return s.mockMemberProfits[n]=a,s.saveMemberProfitsToStorage(),Promise.resolve(a)}static async deleteMemberProfit(e){const t=s.mockMemberProfits.findIndex((t=>t.id===e));if(-1===t)throw new Error("會員分潤項目不存在");return s.mockMemberProfits.splice(t,1),s.saveMemberProfitsToStorage(),Promise.resolve()}static async clearMemberProfits(e){console.log(`開始清除會員分潤記錄 - 年度: ${e}`);try{if(0===s.mockMemberProfits.length&&s.loadMemberProfitsFromStorage(),e){const t=s.mockMemberProfits.length;s.mockMemberProfits=s.mockMemberProfits.filter((t=>t.year!==e));const n=t-s.mockMemberProfits.length;console.log(`會員分潤記錄清除完成：刪除 ${n} 筆記錄`)}else{const e=s.mockMemberProfits.length;s.mockMemberProfits=[],console.log(`會員分潤記錄清除完成：刪除所有 ${e} 筆記錄`)}return s.saveMemberProfitsToStorage(),Promise.resolve()}catch(e){return console.error("清除會員分潤記錄時發生錯誤:",e),Promise.reject(e)}}static async getMembers(){return Promise.resolve(s.mockMembers)}static async getMember(e){const t=s.mockMembers.find((t=>t.id===e));if(!t)throw new Error("會員不存在");return Promise.resolve(t)}static async createMember(e){return(await this.post("/members",e)).data}static async updateMember(e,t){return(await this.put(`/members/${e}`,t)).data}static async deleteMember(e){await this.delete(`/members/${e}`)}static getAuthToken(){return localStorage.getItem(this.LOCAL_STORAGE_KEY)}static setAuthToken(e){localStorage.setItem(this.LOCAL_STORAGE_KEY,e)}static clearAuthToken(){localStorage.removeItem(this.LOCAL_STORAGE_KEY)}static async get(e){const t=this.getAuthToken();return l.default.get(`${this.API_BASE_URL}${e}`,{headers:{Authorization:`Bearer ${t}`}})}static async post(e,t){const n=this.getAuthToken();return l.default.post(`${this.API_BASE_URL}${e}`,t,{headers:{Authorization:`Bearer ${n}`}})}static async put(e,t){const n=this.getAuthToken();return l.default.put(`${this.API_BASE_URL}${e}`,t,{headers:{Authorization:`Bearer ${n}`}})}static async delete(e){const t=this.getAuthToken();return l.default.delete(`${this.API_BASE_URL}${e}`,{headers:{Authorization:`Bearer ${t}`}})}static loadInvoicesFromStorage(){const e=localStorage.getItem("invoices");e&&(s.mockInvoices=JSON.parse(e))}static saveInvoicesToStorage(){localStorage.setItem("invoices",JSON.stringify(s.mockInvoices))}static async createInvoice(e){s.loadInvoicesFromStorage();if(s.mockInvoices.find((t=>t.paymentId===e.paymentId&&t.type===e.type)))throw new Error("此筆租金已開立過"+("receipt"===e.type?"收據":"發票"));const t={id:crypto.randomUUID(),...e,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};s.mockInvoices.push(t),s.saveInvoicesToStorage();const n=s.mockRentalPayments.findIndex((t=>t.id===e.paymentId));return-1!==n&&(s.mockRentalPayments[n]={...s.mockRentalPayments[n],hasInvoice:!0,updatedAt:(new Date).toISOString()},s.saveRentalPaymentsToStorage()),Promise.resolve(t)}static async getInvoice(e,t){let n;return s.loadInvoicesFromStorage(),n=t?s.mockInvoices.find((n=>n.paymentId===e&&n.type===t)):s.mockInvoices.find((t=>t.paymentId===e)),Promise.resolve(n||null)}static async getInvoices(e,t){s.loadInvoicesFromStorage();let n=[...s.mockInvoices];return e&&(n=n.filter((t=>t.investmentId===e))),t&&(n=n.filter((e=>e.paymentId===t))),Promise.resolve(n)}static async deleteInvoice(e){s.loadInvoicesFromStorage();const t=s.mockInvoices.findIndex((t=>t.id===e));if(-1===t)throw new Error("發票不存在");const n=s.mockInvoices[t];s.mockInvoices.splice(t,1),s.saveInvoicesToStorage();if(!s.mockInvoices.some((e=>e.paymentId===n.paymentId))){const e=s.mockRentalPayments.findIndex((e=>e.id===n.paymentId));-1!==e&&(s.mockRentalPayments[e]={...s.mockRentalPayments[e],hasInvoice:!1,updatedAt:(new Date).toISOString()},s.saveRentalPaymentsToStorage())}return Promise.resolve()}static async purgeLocalStorage(e){console.log(`直接清除本地存儲中的 ${e} 年度數據`);try{let t=[];const n=localStorage.getItem("rentalPayments");if(n)try{const a=JSON.parse(n);t=a.filter((t=>t.year!==e)),console.log(`租金收款：從 ${a.length} 筆過濾到 ${t.length} 筆`),localStorage.setItem("rentalPayments",JSON.stringify(t))}catch(e){console.error("解析租金收款數據時出錯:",e)}let a=[];const r=localStorage.getItem("memberProfits");if(r)try{const t=JSON.parse(r);a=t.filter((t=>t.year!==e)),console.log(`會員分潤：從 ${t.length} 筆過濾到 ${a.length} 筆`),localStorage.setItem("memberProfits",JSON.stringify(a))}catch(e){console.error("解析會員分潤數據時出錯:",e)}return s.mockRentalPayments=t,s.mockMemberProfits=a,console.log(`${e} 年度數據已從本地存儲中清除`),Promise.resolve()}catch(e){return console.error("清除本地存儲數據時出錯:",e),Promise.reject(e)}}}t.ApiService=s,s.API_BASE_URL=(()=>{const e=window.location.hostname,t=e.includes("render.com")||e.includes("onrender.com"),n=t?"https://asset-mgmt-api.onrender.com/api":"localhost"===e||"127.0.0.1"===e?"/api":"https://asset-mgmt-api.onrender.com/api";return console.log(`API 服務初始化 - 主機名稱: ${e}, 基礎 URL: ${n}, 是否在 Render: ${t}`),n})(),s.LOCAL_STORAGE_KEY="auth_token",s.investments=[],s.mockUsers=[],s.mockCompanies=[],s.mockRentalStandards=[],s.mockProfitSharingStandards=[],s.mockRentalPayments=[],s.mockMemberProfits=[],s.mockMembers=[{id:"6e74484c-af9c-4a4e-be82-c91d65000c29",memberNo:"C001",username:"test",name:"測試會員",email:"test@example.com",status:"active",role:"normal",preferences:[],isFirstLogin:!1,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{id:"ad9bfa89-6ea5-43fa-92e8-9ecbfb5d69c5",memberNo:"C002",username:"lkt",name:"LKT",email:"lkt@example.com",status:"active",role:"normal",preferences:[],isFirstLogin:!1,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{id:"68aa110c-3b7e-42f8-9a4f-ab63a5c152a6",memberNo:"C003",username:"bmw",name:"BMW",email:"bmw@example.com",status:"active",role:"normal",preferences:[],isFirstLogin:!1,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}],s.mockInvoices=[],t.ApiServiceInstance=s.getInstance()},689207:function(e,t,n){"use strict";var a,r=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},a(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=a(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return l(t,e),t});Object.defineProperty(t,"__esModule",{value:!0});const s=n(474848),o=i(n(296540)),c=n(484976),d=n(264456),m=n(859325),u=i(n(36049)),h=n(64545),x={"@media print":{"@page":{size:"A4",margin:0},body:{margin:0,padding:0},"html, body":{height:"100%",overflow:"visible !important"}}},p=(0,d.styled)(d.Container)((({theme:e})=>({marginTop:e.spacing(4),marginBottom:e.spacing(4),"@media print":{margin:0,padding:0}}))),g=(0,d.styled)(d.Box)((({theme:e})=>({display:"flex",justifyContent:"space-between",marginBottom:e.spacing(2),"@media print":{display:"none"}}))),y=(0,d.styled)(d.Button)((({theme:e})=>({"@media print":{display:"none"}}))),j=(0,d.styled)(d.Box)((({theme:e})=>({display:"flex",flexDirection:"column",gap:e.spacing(4),"@media print":{margin:0,padding:0,gap:0}}))),b=(0,d.styled)(d.Box)((({theme:e})=>({position:"relative",marginBottom:e.spacing(4),"@media print":{marginBottom:0,pageBreakAfter:"always","&:last-child":{pageBreakAfter:"auto"}}}))),v=(0,d.styled)(d.Box)({height:"1px",width:"100%","@media print":{pageBreakAfter:"always"},"@media screen":{marginBottom:"2rem",borderBottom:"1px dashed #ccc"}});t.default=()=>{const{invoiceId:e}=(0,c.useParams)(),t=(0,c.useNavigate)(),[n,a]=(0,o.useState)(!0),[r,l]=(0,o.useState)(null),[i,f]=(0,o.useState)(null);(0,o.useEffect)((()=>{(async()=>{if(!e)return l("發票 ID 無效"),void a(!1);try{const t=(await h.ApiService.getInvoices()).find((t=>t.id===e));if(!t)return l("找不到發票資料"),void a(!1);const n=await h.ApiService.getInvestment(t.investmentId);if(!n)return l("找不到投資項目資料"),void a(!1);const r=await h.ApiService.getRentalPayments(t.investmentId).then((e=>e.find((e=>e.id===t.paymentId))));if(!r)return l("找不到租金收款資料"),void a(!1);f({id:t.id,type:t.type,number:t.number||`INV-${t.id.substring(0,8)}`,date:t.date,buyerName:t.buyerName,buyerTaxId:t.buyerTaxId,amount:t.amount,itemName:t.itemName||"租金收入",note:t.note,investmentName:n.name,year:r.year,month:r.month}),a(!1)}catch(e){console.error("載入發票資料失敗:",e),l("載入發票資料失敗"),a(!1)}})()}),[e]);const T=()=>{t("/investment")};if(n)return(0,s.jsxs)(d.Container,{maxWidth:"md",sx:{mt:4,textAlign:"center"},children:[(0,s.jsx)(d.CircularProgress,{}),(0,s.jsx)(d.Typography,{variant:"body1",sx:{mt:2},children:"載入發票資料中..."})]});if(r||!i)return(0,s.jsx)(d.Container,{maxWidth:"md",sx:{mt:4},children:(0,s.jsxs)(d.Paper,{sx:{p:3},children:[(0,s.jsx)(d.Typography,{variant:"h6",color:"error",gutterBottom:!0,children:"錯誤"}),(0,s.jsx)(d.Typography,{variant:"body1",children:r||"無法載入發票資料"}),(0,s.jsx)(d.Button,{variant:"contained",startIcon:(0,s.jsx)(m.ArrowBack,{}),onClick:T,sx:{mt:2},children:"返回"})]})});const S=i.type===u.InvoiceType.INVOICE3?[u.InvoiceCopy.STUB,u.InvoiceCopy.RECEIPT,u.InvoiceCopy.ACCOUNTING]:i.type===u.InvoiceType.INVOICE2?[u.InvoiceCopy.STUB,u.InvoiceCopy.RECEIPT]:[u.InvoiceCopy.RECEIPT];return(0,s.jsxs)(p,{maxWidth:"lg",children:[(0,s.jsx)(d.GlobalStyles,{styles:x}),(0,s.jsxs)(g,{children:[(0,s.jsx)(d.Button,{variant:"outlined",startIcon:(0,s.jsx)(m.ArrowBack,{}),onClick:T,children:"返回"}),(0,s.jsx)(y,{variant:"contained",startIcon:(0,s.jsx)(m.Print,{}),onClick:()=>{window.print()},color:"primary",children:"列印"})]}),(0,s.jsx)(j,{children:S.map(((e,t)=>(0,s.jsxs)(o.default.Fragment,{children:[(0,s.jsx)(b,{children:(0,s.jsx)(u.default,{data:i,copy:e})}),t<S.length-1&&(0,s.jsx)(v,{})]},e)))})]})}},733274:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(474848),r=n(296540),l=n(264456),i=n(583380),s={username:"",name:"",email:"",role:"normal",status:"active",companyId:""};t.default=({open:e,onClose:t,onSave:n,user:o})=>{const[c,d]=(0,r.useState)(s),[m,u]=(0,r.useState)({}),[h,x]=(0,r.useState)([]);(0,r.useEffect)((()=>{p()}),[]);(0,r.useEffect)((()=>{e&&(d(o||{...s}),u({}))}),[o,e]);const p=async()=>{try{const e=await i.ApiService.getCompanies();x(e)}catch(e){console.error("載入公司資料失敗:",e)}},g=(e,t)=>{d((n=>({...n,[e]:t}))),m[e]&&u((t=>({...t,[e]:""})))},y=()=>{d({...s}),t()};return(0,a.jsxs)(l.Dialog,{open:e,onClose:y,maxWidth:"sm",fullWidth:!0,children:[(0,a.jsx)(l.DialogTitle,{children:(0,a.jsx)(l.Typography,{children:o?"編輯會員":"新增會員"})}),(0,a.jsx)(l.DialogContent,{children:(0,a.jsxs)(l.Grid,{container:!0,spacing:2,sx:{mt:1},children:[(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"會員帳號",value:c.username,onChange:e=>g("username",e.target.value),error:!!m.username,helperText:m.username,required:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"姓名",value:c.name,onChange:e=>g("name",e.target.value),error:!!m.name,helperText:m.name,required:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,children:(0,a.jsx)(l.TextField,{fullWidth:!0,label:"電子郵件",type:"email",value:c.email,onChange:e=>g("email",e.target.value),error:!!m.email,helperText:m.email,required:!0})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsxs)(l.FormControl,{fullWidth:!0,children:[(0,a.jsx)(l.InputLabel,{children:"角色"}),(0,a.jsxs)(l.Select,{value:c.role,onChange:e=>g("role",e.target.value),label:"角色",children:[(0,a.jsx)(l.MenuItem,{value:"admin",children:"管理員"}),(0,a.jsx)(l.MenuItem,{value:"normal",children:"一般會員"}),(0,a.jsx)(l.MenuItem,{value:"business",children:"商務會員"}),(0,a.jsx)(l.MenuItem,{value:"lifetime",children:"永久會員"})]})]})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsxs)(l.FormControl,{fullWidth:!0,children:[(0,a.jsx)(l.InputLabel,{children:"狀態"}),(0,a.jsxs)(l.Select,{value:c.status,onChange:e=>g("status",e.target.value),label:"狀態",children:[(0,a.jsx)(l.MenuItem,{value:"active",children:"啟用"}),(0,a.jsx)(l.MenuItem,{value:"inactive",children:"停用"}),(0,a.jsx)(l.MenuItem,{value:"suspended",children:"暫停"})]})]})}),(0,a.jsx)(l.Grid,{item:!0,xs:12,sm:6,children:(0,a.jsxs)(l.FormControl,{fullWidth:!0,children:[(0,a.jsx)(l.InputLabel,{children:"所屬公司"}),(0,a.jsxs)(l.Select,{value:c.companyId||"",onChange:e=>g("companyId",e.target.value),label:"所屬公司",children:[(0,a.jsx)(l.MenuItem,{value:"",children:"無"}),h.map((e=>(0,a.jsx)(l.MenuItem,{value:e.id,children:e.name},e.id)))]})]})})]})}),(0,a.jsxs)(l.DialogActions,{children:[(0,a.jsx)(l.Button,{onClick:y,children:"取消"}),(0,a.jsx)(l.Button,{onClick:async()=>{if(!(()=>{const e={};return c.username||(e.username="請輸入會員帳號"),c.name||(e.name="請輸入姓名"),c.email?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(c.email)||(e.email="請輸入有效的電子郵件地址"):e.email="請輸入電子郵件",u(e),0===Object.keys(e).length})())return;const e={...o,username:c.username,name:c.name,email:c.email,role:c.role,status:c.status,companyId:c.companyId,updatedAt:(new Date).toISOString()};await n(e),t()},variant:"contained",color:"primary",children:"保存"})]})]})}},749443:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=n(859325),o=n(409938),c=n(583380),d=n(500523),m=a(n(825734)),u=a(n(455549)),h=n(484976),x=n(407514);t.default=({investments:e})=>{const{id:t}=(0,h.useParams)(),[n,a]=(0,l.useState)([]),[p,g]=(0,l.useState)([]),[y,j]=(0,l.useState)(!0),[b,v]=(0,l.useState)(null),[f,T]=(0,l.useState)(!1),[S,C]=(0,l.useState)(null),[I,w]=(0,l.useState)((new Date).getFullYear()),[D,P]=(0,l.useState)((new Date).getMonth()+1),[N,A]=(0,l.useState)({investmentId:"",memberId:"",year:(new Date).getFullYear(),month:(new Date).getMonth()+1,amount:0,status:o.PaymentStatus.PENDING,paymentMethod:o.PaymentMethod.BANK_TRANSFER,paymentDate:"",note:""}),[R,E]=(0,l.useState)(!1),[k,M]=(0,l.useState)(null),{enqueueSnackbar:B}=(0,x.useSnackbar)(),[O,_]=(0,l.useState)(!1),[F,G]=(0,l.useState)([]);(0,l.useEffect)((()=>{W()}),[I,D]);const W=async()=>{j(!0);try{const[e,t]=await Promise.all([c.ApiService.getMembers(),c.ApiService.getMemberProfits(void 0,void 0,I,D)]);a(e),g(t)}catch(e){v("載入資料失敗")}finally{j(!1)}},$=e=>t=>{A({...N,[e]:t.target.value})},L=e=>t=>{A({...N,[e]:t.target.value})},z=e=>{switch(e){case o.PaymentStatus.PAID:return"success";case o.PaymentStatus.PENDING:return"warning";case o.PaymentStatus.OVERDUE:return"error";default:return"default"}},H=e=>{switch(e){case o.PaymentStatus.PAID:return"已發放";case o.PaymentStatus.PENDING:return"待發放";case o.PaymentStatus.OVERDUE:return"逾期";default:return"未知"}},U=()=>{E(!1),M(null)};return y?(0,r.jsx)(m.default,{}):b?(0,r.jsx)(u.default,{message:b}):(0,r.jsxs)(i.Box,{children:[(0,r.jsxs)(i.Box,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)(i.Typography,{variant:"h6",children:"會員分潤管理"}),(0,r.jsxs)(i.Box,{children:[(0,r.jsxs)(i.FormControl,{sx:{mr:2,minWidth:100},children:[(0,r.jsx)(i.InputLabel,{children:"年度"}),(0,r.jsx)(i.Select,{value:I.toString(),label:"年度",onChange:e=>w(Number(e.target.value)),children:Array.from({length:5},((e,t)=>(new Date).getFullYear()-2+t)).map((e=>(0,r.jsx)(i.MenuItem,{value:e,children:e},e)))})]}),(0,r.jsxs)(i.FormControl,{sx:{mr:2,minWidth:100},children:[(0,r.jsx)(i.InputLabel,{children:"月份"}),(0,r.jsx)(i.Select,{value:D.toString(),label:"月份",onChange:e=>P(Number(e.target.value)),children:Array.from({length:12},((e,t)=>t+1)).map((e=>(0,r.jsx)(i.MenuItem,{value:e,children:e},e)))})]}),(0,r.jsx)(i.Button,{variant:"contained",startIcon:(0,r.jsx)(s.Refresh,{}),onClick:async()=>{if(I)try{const t=await c.ApiService.getMemberProfits(void 0,void 0,I),n=e.map((e=>({id:e.id,name:e.name,selected:!1,hasExistingProfits:t.some((t=>t.investmentId===e.id))})));G(n),_(!0)}catch(e){B("準備生成資料時發生錯誤",{variant:"error"})}else B("請選擇要生成的年度",{variant:"error"})},sx:{mr:1},children:"生成分潤項目"}),(0,r.jsx)(i.Button,{variant:"outlined",color:"error",onClick:async()=>{if(window.confirm("確定要清除所有會員分潤項目嗎？這將刪除所有已生成的分潤項目。")){j(!0);try{await c.ApiService.clearMemberProfits(),B("已清除所有會員分潤項目",{variant:"success"}),await W()}catch(e){B("清除會員分潤項目失敗",{variant:"error"})}finally{j(!1)}}},sx:{mr:1},children:"清除分潤項目"})]})]}),(0,r.jsx)(i.TableContainer,{component:i.Paper,children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHead,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"投資項目"}),(0,r.jsx)(i.TableCell,{children:"會員"}),(0,r.jsx)(i.TableCell,{children:"年月"}),(0,r.jsx)(i.TableCell,{align:"right",children:"分潤金額"}),(0,r.jsx)(i.TableCell,{children:"發放狀態"}),(0,r.jsx)(i.TableCell,{children:"發放方式"}),(0,r.jsx)(i.TableCell,{children:"發放日期"}),(0,r.jsx)(i.TableCell,{children:"備註"}),(0,r.jsx)(i.TableCell,{children:"操作"})]})}),(0,r.jsxs)(i.TableBody,{children:[p.map((t=>{const a=e.find((e=>e.id===t.investmentId)),l=n.find((e=>e.id===t.memberId));return(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:(null==a?void 0:a.name)||"未知項目"}),(0,r.jsx)(i.TableCell,{children:(null==l?void 0:l.name)||"未知會員"}),(0,r.jsx)(i.TableCell,{children:`${t.year}年${t.month}月`}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,d.formatCurrency)(t.amount)}),(0,r.jsx)(i.TableCell,{children:(0,r.jsx)(i.Chip,{label:H(t.status),color:z(t.status),size:"small"})}),(0,r.jsx)(i.TableCell,{children:t.paymentMethod===o.PaymentMethod.CASH?"現金":t.paymentMethod===o.PaymentMethod.BANK_TRANSFER?"銀行轉帳":t.paymentMethod===o.PaymentMethod.CHECK?"支票":"其他"}),(0,r.jsx)(i.TableCell,{children:t.paymentDate?(0,d.formatDate)(t.paymentDate):"-"}),(0,r.jsx)(i.TableCell,{children:t.note||"-"}),(0,r.jsxs)(i.TableCell,{children:[(0,r.jsx)(i.IconButton,{size:"small",onClick:()=>(e=>{C(e),A({investmentId:e.investmentId,memberId:e.memberId,year:e.year,month:e.month,amount:e.amount,status:e.status,paymentMethod:e.paymentMethod||o.PaymentMethod.BANK_TRANSFER,paymentDate:e.paymentDate||"",note:e.note||""}),T(!0)})(t),children:(0,r.jsx)(s.Edit,{})}),(0,r.jsx)(i.IconButton,{size:"small",onClick:()=>(e=>{M(e),E(!0)})(t),children:(0,r.jsx)(s.Delete,{})})]})]},t.id)})),0===p.length&&(0,r.jsx)(i.TableRow,{children:(0,r.jsx)(i.TableCell,{colSpan:9,align:"center",children:"尚無會員分潤資料"})})]})]})}),(0,r.jsxs)(i.Dialog,{open:f,onClose:()=>T(!1),maxWidth:"sm",fullWidth:!0,children:[(0,r.jsx)(i.DialogTitle,{children:"編輯會員分潤項目"}),(0,r.jsx)(i.DialogContent,{children:(0,r.jsxs)(i.Grid,{container:!0,spacing:2,sx:{mt:1},children:[(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{select:!0,fullWidth:!0,label:"投資項目",value:N.investmentId,onChange:$("investmentId"),required:!0,disabled:!0,children:e.map((e=>(0,r.jsx)(i.MenuItem,{value:e.id,children:e.name},e.id)))})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{select:!0,fullWidth:!0,label:"會員",value:N.memberId,onChange:$("memberId"),required:!0,disabled:!0,children:n.map((e=>(0,r.jsx)(i.MenuItem,{value:e.id,children:e.name},e.id)))})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"年度",value:N.year,disabled:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"月份",value:N.month,disabled:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"分潤金額",type:"number",value:N.amount,onChange:$("amount"),required:!0})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsxs)(i.FormControl,{fullWidth:!0,required:!0,children:[(0,r.jsx)(i.InputLabel,{children:"發放狀態"}),(0,r.jsxs)(i.Select,{value:N.status,label:"發放狀態",onChange:L("status"),children:[(0,r.jsx)(i.MenuItem,{value:o.PaymentStatus.PENDING,children:"待發放"}),(0,r.jsx)(i.MenuItem,{value:o.PaymentStatus.PAID,children:"已發放"}),(0,r.jsx)(i.MenuItem,{value:o.PaymentStatus.OVERDUE,children:"逾期"})]})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:6,children:(0,r.jsxs)(i.FormControl,{fullWidth:!0,children:[(0,r.jsx)(i.InputLabel,{children:"發放方式"}),(0,r.jsxs)(i.Select,{value:N.paymentMethod,label:"發放方式",onChange:L("paymentMethod"),children:[(0,r.jsx)(i.MenuItem,{value:o.PaymentMethod.CASH,children:"現金"}),(0,r.jsx)(i.MenuItem,{value:o.PaymentMethod.BANK_TRANSFER,children:"銀行轉帳"}),(0,r.jsx)(i.MenuItem,{value:o.PaymentMethod.CHECK,children:"支票"}),(0,r.jsx)(i.MenuItem,{value:o.PaymentMethod.OTHER,children:"其他"})]})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"發放日期",type:"date",value:N.paymentDate,onChange:$("paymentDate"),InputLabelProps:{shrink:!0}})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,children:(0,r.jsx)(i.TextField,{fullWidth:!0,label:"備註",multiline:!0,rows:3,value:N.note,onChange:$("note")})})]})}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:()=>T(!1),children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{if(N.investmentId&&N.memberId&&N.amount&&N.status){j(!0);try{S&&await c.ApiService.updateMemberProfit(S.id,N),await W(),T(!1)}catch(e){v("儲存會員分潤項目失敗")}finally{j(!1)}}else v("請填寫必要欄位")},variant:"contained",children:"儲存"})]})]}),(0,r.jsxs)(i.Dialog,{open:R,onClose:U,children:[(0,r.jsx)(i.DialogTitle,{children:"確認刪除"}),(0,r.jsx)(i.DialogContent,{children:"確定要刪除這個分潤項目嗎？此操作無法復原。"}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:U,children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{if(k)try{await c.ApiService.deleteMemberProfit(k.id),B("分潤項目已刪除",{variant:"success"}),await W()}catch(e){B("刪除分潤項目失敗",{variant:"error"})}finally{E(!1),M(null)}},color:"error",children:"刪除"})]})]}),(0,r.jsxs)(i.Dialog,{open:O,onClose:()=>_(!1),maxWidth:"sm",fullWidth:!0,children:[(0,r.jsx)(i.DialogTitle,{children:"選擇要生成分潤項目的投資項目"}),(0,r.jsx)(i.DialogContent,{children:F.map((e=>(0,r.jsxs)(i.Box,{sx:{mb:1},children:[(0,r.jsx)(i.FormControlLabel,{control:(0,r.jsx)(i.Checkbox,{checked:e.selected,onChange:()=>(e=>{G((t=>t.map((t=>t.id===e?{...t,selected:!t.selected}:t))))})(e.id),disabled:e.hasExistingProfits}),label:e.name}),e.hasExistingProfits&&(0,r.jsx)(i.Typography,{variant:"caption",color:"error",children:"（已存在分潤項目）"})]},e.id)))}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:()=>_(!1),children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{_(!1),j(!0);let e=!1,t="";console.log("開始生成會員分潤項目...");try{const n=F.filter((e=>e.selected));if(console.log(`選擇了 ${n.length} 個投資項目進行分潤生成`),0===n.length)return B("請選擇至少一個投資項目進行分潤生成",{variant:"warning"}),void j(!1);for(const a of n)try{console.log(`正在為投資項目 ${a.name}(${a.id}) 生成分潤...`),await c.ApiService.generateMemberProfits(a.id,I),console.log(`投資項目 ${a.name} 分潤生成成功`)}catch(n){e=!0;const r=n instanceof Error?n.message:"生成失敗";t+=`${a.name}: ${r}\n`,console.error(`投資項目 ${a.name} 分潤生成失敗:`,n),r.includes("找不到所屬會員")&&B(`投資項目 ${a.name} 的所屬會員不存在或未設定，請先更新投資項目的會員關聯`,{variant:"error",autoHideDuration:6e3})}e?(console.warn("部分投資項目生成失敗:",t),B("部分投資項目生成失敗:\n"+t,{variant:"warning",autoHideDuration:8e3})):(console.log("所有投資項目分潤生成完成"),B("會員分潤項目生成完成",{variant:"success"})),console.log("重新載入分潤資料..."),await W(),console.log("資料重新載入完成"),setTimeout((()=>{console.log("使用路由導航..."),window.location.href="#/investment/member-profit"}),500)}catch(e){const t=e instanceof Error?e.message:"未知錯誤";console.error("生成會員分潤項目時發生錯誤:",t),B(`生成會員分潤項目時發生錯誤: ${t}`,{variant:"error"})}finally{j(!1)}},variant:"contained",disabled:!F.some((e=>e.selected)),children:"生成"})]})]})]})}},750701:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(474848),r=n(264456),l=n(859325),i=n(332584);t.default=()=>{const{user:e,logout:t}=(0,i.useAuth)();return(0,a.jsx)(r.AppBar,{position:"fixed",sx:{zIndex:e=>e.zIndex.drawer+1,backgroundColor:"#1976d2",width:"100%"},children:(0,a.jsxs)(r.Toolbar,{sx:{pr:3},children:[(0,a.jsx)(r.Typography,{variant:"h6",component:"div",sx:{flexGrow:1},children:"資產管理系統"}),(0,a.jsxs)(r.Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[e&&(0,a.jsx)(r.Typography,{variant:"body1",children:e.name}),(0,a.jsx)(r.Button,{color:"inherit",onClick:()=>{t()},startIcon:(0,a.jsx)(l.ExitToApp,{}),children:"登出"})]})]})})}},785739:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatDate=void 0;t.formatDate=e=>new Date(e).toLocaleDateString("zh-TW")},800232:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(474848),r=n(296540),l=n(264456),i=n(332584),s=n(484976);t.default=()=>{const[e,t]=(0,r.useState)(null),[n,o]=(0,r.useState)(!1),{login:c}=(0,i.useAuth)(),d=(0,s.useNavigate)();return(0,a.jsx)(l.Container,{component:"main",maxWidth:"xs",children:(0,a.jsx)(l.Box,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:(0,a.jsxs)(l.Paper,{elevation:3,sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[(0,a.jsx)(l.Typography,{component:"h1",variant:"h5",sx:{mb:3},children:"資產管理系統"}),(0,a.jsxs)(l.Box,{component:"form",onSubmit:async e=>{e.preventDefault(),o(!0),t(null);const n=new FormData(e.currentTarget),a=n.get("username"),r=n.get("password");if(!a||!r)return t("請輸入帳號和密碼"),void o(!1);try{await c(a,r),d("/")}catch(e){console.error("登入錯誤:",e),t("登入失敗，請檢查帳號密碼")}finally{o(!1)}},sx:{mt:1,width:"100%"},children:[e&&(0,a.jsx)(l.Alert,{severity:"error",sx:{mb:2},children:e}),(0,a.jsx)(l.TextField,{margin:"normal",required:!0,fullWidth:!0,id:"username",name:"username",label:"帳號",autoComplete:"username",autoFocus:!0}),(0,a.jsx)(l.TextField,{margin:"normal",required:!0,fullWidth:!0,id:"password",name:"password",label:"密碼",type:"password",autoComplete:"current-password"}),(0,a.jsx)(l.Button,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:n,children:n?(0,a.jsx)(l.CircularProgress,{size:24}):"登入"})]})]})})})}},801460:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatCurrency=void 0;t.formatCurrency=e=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)},807273:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(484976),i=n(332584),s=a(n(99748)),o=a(n(800232)),c=a(n(221400)),d=a(n(531114)),m=a(n(27978)),u=a(n(403903)),h=a(n(689207)),x=a(n(46056)),p=({children:e})=>{const{isAuthenticated:t}=(0,i.useAuth)();return t?(0,r.jsx)(s.default,{children:e}):(0,r.jsx)(l.Navigate,{to:"/login",replace:!0})};t.default=()=>(0,r.jsxs)(l.Routes,{children:[(0,r.jsx)(l.Route,{path:"/login",element:(0,r.jsx)(o.default,{})}),(0,r.jsx)(l.Route,{path:"/",element:(0,r.jsx)(p,{children:(0,r.jsx)(l.Navigate,{to:"/users",replace:!0})})}),(0,r.jsx)(l.Route,{path:"/users",element:(0,r.jsx)(p,{children:(0,r.jsx)(c.default,{})})}),(0,r.jsx)(l.Route,{path:"/fees",element:(0,r.jsx)(p,{children:(0,r.jsx)(u.default,{})})}),(0,r.jsx)(l.Route,{path:"/companies",element:(0,r.jsx)(p,{children:(0,r.jsx)(d.default,{})})}),(0,r.jsx)(l.Route,{path:"/investment",element:(0,r.jsx)(p,{children:(0,r.jsx)(m.default,{})})}),(0,r.jsx)(l.Route,{path:"/investment/rental-payment",element:(0,r.jsx)(p,{children:(0,r.jsx)(x.default,{initialTab:1})})}),(0,r.jsx)(l.Route,{path:"/investment/member-profit",element:(0,r.jsx)(p,{children:(0,r.jsx)(x.default,{initialTab:2})})}),(0,r.jsx)(l.Route,{path:"/investment/history",element:(0,r.jsx)(p,{children:(0,r.jsx)(x.default,{initialTab:3})})}),(0,r.jsx)(l.Route,{path:"/investment/invoice/print/:invoiceId",element:(0,r.jsx)(h.default,{})}),(0,r.jsx)(l.Route,{path:"/services",element:(0,r.jsx)(p,{children:(0,r.jsx)("div",{children:"會員服務"})})}),(0,r.jsx)(l.Route,{path:"/payment",element:(0,r.jsx)(p,{children:(0,r.jsx)("div",{children:"交易支付"})})}),(0,r.jsx)(l.Route,{path:"/notifications",element:(0,r.jsx)(p,{children:(0,r.jsx)("div",{children:"通知提醒"})})}),(0,r.jsx)(l.Route,{path:"/security",element:(0,r.jsx)(p,{children:(0,r.jsx)("div",{children:"安全隱私"})})}),(0,r.jsx)(l.Route,{path:"*",element:(0,r.jsx)(p,{children:(0,r.jsx)("div",{children:"404 Not Found"})})})]})},825734:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(474848),r=n(264456);t.default=()=>(0,a.jsx)(r.Box,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,a.jsx)(r.CircularProgress,{})})},964110:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=a(n(403519)),o=n(64545),c=n(407514);t.default=({investments:e,onEdit:t,onRefresh:n})=>{const[a,d]=(0,l.useState)(!1),[m,u]=(0,l.useState)(null),{enqueueSnackbar:h}=(0,c.useSnackbar)(),x=()=>{d(!1),u(null)};return(0,r.jsxs)(i.Box,{children:[(0,r.jsx)(s.default,{investments:e,onEditInvestment:t,onDeleteInvestment:e=>{u(e),d(!0)}}),(0,r.jsxs)(i.Dialog,{open:a,onClose:x,children:[(0,r.jsx)(i.DialogTitle,{children:"確認刪除"}),(0,r.jsxs)(i.DialogContent,{children:["確定要刪除「",null==m?void 0:m.name,"」這個投資項目嗎？此操作無法復原。"]}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:x,children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{if(m)try{await o.ApiService.deleteInvestment(m.id),h("投資項目已刪除",{variant:"success"}),await n()}catch(e){h("刪除投資項目失敗",{variant:"error"})}finally{d(!1),u(null)}},color:"error",children:"刪除"})]})]})]})}},979426:function(e,t,n){"use strict";var a,r=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(a=function(e){return a=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},a(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=a(e),i=0;i<n.length;i++)"default"!==n[i]&&r(t,e,n[i]);return l(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.InvoiceManagement=void 0;const s=n(474848),o=i(n(296540)),c=n(264456),d=n(859325),m=n(135630),u=n(189915),h=n(470750),x=n(221701),p=({open:e,onClose:t,memberId:n,memberName:a})=>{const[r,l]=(0,o.useState)([]),[i,m]=(0,o.useState)(n),[p,g]=(0,o.useState)(a),[y,j]=(0,o.useState)([]),[b,v]=(0,o.useState)({open:!1,message:"",severity:"success"}),[f,T]=(0,o.useState)(!1),[S,C]=(0,o.useState)(null);o.default.useEffect((()=>{e&&I()}),[e]);const I=async()=>{try{const e=await h.feeHistoryService.getHistories({status:"已收款"}),t=Array.from(new Map(e.map((e=>[`${e.memberId}-${e.memberName}`,{memberId:e.memberId,memberName:e.memberName}]))).values());j(t)}catch(e){console.error("載入會員資料失敗:",e),v({open:!0,message:"載入會員資料失敗",severity:"error"})}};o.default.useEffect((()=>{e&&i&&w()}),[e,i]);const w=async()=>{try{const e=await u.invoiceService.getDocuments({memberId:i});l(e)}catch(e){console.error("載入文件失敗:",e),v({open:!0,message:"載入文件失敗",severity:"error"})}},D=()=>{T(!1),C(null)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c.Dialog,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[(0,s.jsxs)(c.DialogTitle,{children:[(0,s.jsx)(c.Typography,{variant:"h6",children:"已開立發票/收據列表"}),(0,s.jsx)(c.Typography,{variant:"subtitle1",color:"textSecondary",children:i?`會員：${p} (${i})`:"請選擇會員"})]}),(0,s.jsx)(c.DialogContent,{children:(0,s.jsxs)(c.Box,{sx:{p:2},children:[(0,s.jsxs)(c.FormControl,{fullWidth:!0,sx:{mb:2},children:[(0,s.jsx)(c.InputLabel,{children:"選擇會員"}),(0,s.jsx)(c.Select,{value:i,label:"選擇會員",onChange:e=>(e=>{const t=y.find((t=>t.memberId===e.target.value));t&&(m(t.memberId),g(t.memberName))})(e),children:y.map((e=>(0,s.jsxs)(c.MenuItem,{value:e.memberId,children:[e.memberName," (",e.memberId,")"]},e.memberId)))})]}),i&&(0,s.jsx)(c.TableContainer,{component:c.Paper,children:(0,s.jsxs)(c.Table,{children:[(0,s.jsx)(c.TableHead,{children:(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableCell,{children:"類型"}),(0,s.jsx)(c.TableCell,{children:"編號"}),(0,s.jsx)(c.TableCell,{children:"日期"}),(0,s.jsx)(c.TableCell,{align:"right",children:"金額"}),(0,s.jsx)(c.TableCell,{children:"操作"})]})}),(0,s.jsx)(c.TableBody,{children:0===r.length?(0,s.jsx)(c.TableRow,{children:(0,s.jsx)(c.TableCell,{colSpan:5,align:"center",children:"尚未開立任何發票或收據"})}):r.map((e=>(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableCell,{children:(0,s.jsx)(c.Chip,{label:"收據"===e.type?"收據":"二聯式"===e.type?"二聯式（存根聯、收執聯）":"三聯式（存根聯、報帳聯、扣抵聯）",color:"收據"===e.type?"default":"primary",size:"small"})}),(0,s.jsx)(c.TableCell,{children:"收據"===e.type?e.receiptNumber:e.invoiceNumber}),(0,s.jsx)(c.TableCell,{children:e.date}),(0,s.jsx)(c.TableCell,{align:"right",children:e.amount.toLocaleString()}),(0,s.jsx)(c.TableCell,{children:(0,s.jsxs)(c.Box,{sx:{display:"flex",gap:1},children:[(0,s.jsx)(c.IconButton,{size:"small",title:"列印",onClick:()=>(async e=>{try{await x.documentService.printDocument(e)}catch(e){console.error("列印失敗:",e),v({open:!0,message:"列印失敗",severity:"error"})}})(e),children:(0,s.jsx)(d.Print,{})}),(0,s.jsx)(c.IconButton,{color:"error",onClick:()=>(e=>{C(e),T(!0)})(e),children:(0,s.jsx)(d.Delete,{})})]})})]},e.id)))})]})})]})}),(0,s.jsx)(c.DialogActions,{children:(0,s.jsx)(c.Button,{onClick:t,children:"關閉"})})]}),(0,s.jsxs)(c.Dialog,{open:f,onClose:D,children:[(0,s.jsx)(c.DialogTitle,{children:"確認刪除"}),(0,s.jsx)(c.DialogContent,{children:(0,s.jsx)(c.DialogContentText,{children:"確定要刪除這份文件嗎？此操作無法復原。"})}),(0,s.jsxs)(c.DialogActions,{children:[(0,s.jsx)(c.Button,{onClick:D,children:"取消"}),(0,s.jsx)(c.Button,{onClick:async()=>{if(S)try{await u.invoiceService.deleteDocument(S.id),await w(),v({open:!0,message:"刪除成功",severity:"success"})}catch(e){console.error("刪除失敗:",e),v({open:!0,message:"刪除失敗",severity:"error"})}T(!1),C(null)},color:"error",autoFocus:!0,children:"刪除"})]})]}),(0,s.jsx)(c.Snackbar,{open:b.open,autoHideDuration:3e3,onClose:()=>v((e=>({...e,open:!1}))),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,s.jsx)(c.Alert,{onClose:()=>v((e=>({...e,open:!1}))),severity:b.severity,children:b.message})})]})};t.InvoiceManagement=()=>{const[e,t]=(0,o.useState)([]),[n,a]=(0,o.useState)(!0),[r,l]=(0,o.useState)(!1),[i,u]=(0,o.useState)({memberId:"",memberName:"",amount:0}),[x,g]=(0,o.useState)(!1),[y,j]=(0,o.useState)(!1),[b,v]=(0,o.useState)(null),[f,T]=(0,o.useState)({open:!1,message:"",severity:"success"}),[S,C]=(0,o.useState)(null),[I,w]=(0,o.useState)(null),D=async()=>{try{const e=await h.feeHistoryService.getHistories({status:"已收款"});t(e)}catch(e){console.error("載入付款記錄失敗:",e)}finally{a(!1)}};(0,o.useEffect)((()=>{D()}),[]);const P=()=>{l(!1),u({memberId:"",memberName:"",amount:0})},N=e=>{const{name:t,value:n}=e.target;u((e=>({...e,[t]:"amount"===t?Number(n):n})))},A=()=>{j(!1),v(null)},R=()=>{C(null),w(null)},E=async e=>{if(I)try{await h.feeHistoryService.updateRecord(I.id,{paymentMethod:e,updatedAt:(new Date).toISOString()}),await D(),T({open:!0,message:"更新收款方式成功",severity:"success"})}catch(e){console.error("更新收款方式失敗:",e),T({open:!0,message:"更新收款方式失敗",severity:"error"})}R()};return(0,s.jsxs)(c.Box,{children:[(0,s.jsxs)(c.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,s.jsx)(c.Typography,{variant:"h6",children:"發票管理"}),(0,s.jsx)(c.Box,{sx:{display:"flex",gap:1},children:(0,s.jsx)(c.Button,{variant:"contained",color:"primary",onClick:()=>g(!0),startIcon:(0,s.jsx)(d.Print,{}),children:"列印發票/收據"})})]}),(0,s.jsx)(c.TableContainer,{component:c.Paper,children:(0,s.jsxs)(c.Table,{children:[(0,s.jsx)(c.TableHead,{children:(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableCell,{children:"會員編號"}),(0,s.jsx)(c.TableCell,{children:"會員姓名"}),(0,s.jsx)(c.TableCell,{children:"會員類型"}),(0,s.jsx)(c.TableCell,{align:"right",children:"金額"}),(0,s.jsx)(c.TableCell,{children:"繳費日期"}),(0,s.jsx)(c.TableCell,{children:"收款方式"}),(0,s.jsx)(c.TableCell,{children:"操作"})]})}),(0,s.jsxs)(c.TableBody,{children:[e.map((e=>(0,s.jsxs)(c.TableRow,{children:[(0,s.jsx)(c.TableCell,{children:e.memberId}),(0,s.jsx)(c.TableCell,{children:e.memberName}),(0,s.jsx)(c.TableCell,{children:e.memberType}),(0,s.jsx)(c.TableCell,{align:"right",children:e.amount.toLocaleString()}),(0,s.jsx)(c.TableCell,{children:e.paymentDate}),(0,s.jsx)(c.TableCell,{children:(0,s.jsx)(c.Chip,{label:e.paymentMethod||"未設定",color:e.paymentMethod?"primary":"default",size:"small",onClick:t=>((e,t)=>{C(e.currentTarget),w(t)})(t,e)})}),(0,s.jsx)(c.TableCell,{children:(0,s.jsxs)(c.Box,{sx:{display:"flex",gap:1},children:[(0,s.jsx)(m.DocumentIssue,{memberId:e.memberId,memberName:e.memberName,paymentId:e.id,amount:e.amount,onSuccess:D}),(0,s.jsx)(c.IconButton,{color:"error",onClick:()=>(e=>{v(e),j(!0)})(e),children:(0,s.jsx)(d.Delete,{})})]})})]},e.id))),0===e.length&&!n&&(0,s.jsx)(c.TableRow,{children:(0,s.jsx)(c.TableCell,{colSpan:6,align:"center",children:"無已收款記錄"})})]})]})}),(0,s.jsxs)(c.Dialog,{open:r,onClose:P,maxWidth:"sm",fullWidth:!0,children:[(0,s.jsx)(c.DialogTitle,{children:"新增發票"}),(0,s.jsx)(c.DialogContent,{children:(0,s.jsxs)(c.Grid,{container:!0,spacing:2,sx:{mt:1},children:[(0,s.jsx)(c.Grid,{item:!0,xs:12,children:(0,s.jsx)(c.TextField,{fullWidth:!0,label:"會員編號",name:"memberId",value:i.memberId,onChange:N})}),(0,s.jsx)(c.Grid,{item:!0,xs:12,children:(0,s.jsx)(c.TextField,{fullWidth:!0,label:"會員姓名",name:"memberName",value:i.memberName,onChange:N})}),(0,s.jsx)(c.Grid,{item:!0,xs:12,children:(0,s.jsx)(c.TextField,{fullWidth:!0,label:"金額",name:"amount",type:"number",value:i.amount,onChange:N})})]})}),(0,s.jsxs)(c.DialogActions,{children:[(0,s.jsx)(c.Button,{onClick:P,children:"取消"}),(0,s.jsx)(c.Button,{onClick:()=>{if(!i.memberId||!i.memberName||!i.amount)return;const e={id:`manual-${Date.now()}`,memberId:i.memberId,memberName:i.memberName,userId:i.memberId,userName:i.memberName,memberType:"一般會員",amount:i.amount,dueDate:(new Date).toISOString().split("T")[0],status:"已收款",date:(new Date).toISOString().split("T")[0],action:"已收款",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),paymentId:`payment-${Date.now()}`};t((t=>[...t,e])),P()},variant:"contained",color:"primary",children:"新增"})]})]}),(0,s.jsx)(p,{open:x,onClose:()=>g(!1),memberId:e.length>0?e[0].memberId:"",memberName:e.length>0?e[0].memberName:""}),(0,s.jsxs)(c.Dialog,{open:y,onClose:A,children:[(0,s.jsx)(c.DialogTitle,{children:"確認刪除"}),(0,s.jsx)(c.DialogContent,{children:(0,s.jsx)(c.DialogContentText,{children:"確定要刪除這筆付款記錄嗎？此操作無法復原。"})}),(0,s.jsxs)(c.DialogActions,{children:[(0,s.jsx)(c.Button,{onClick:A,children:"取消"}),(0,s.jsx)(c.Button,{onClick:async()=>{if(b)try{await h.feeHistoryService.deleteRecord(b.id),await D(),T({open:!0,message:"刪除成功",severity:"success"})}catch(e){console.error("刪除失敗:",e),T({open:!0,message:"刪除失敗",severity:"error"})}j(!1),v(null)},color:"error",autoFocus:!0,children:"刪除"})]})]}),(0,s.jsxs)(c.Menu,{anchorEl:S,open:Boolean(S),onClose:R,children:[(0,s.jsx)(c.MenuItem,{onClick:()=>E("轉帳"),children:"轉帳"}),(0,s.jsx)(c.MenuItem,{onClick:()=>E("Line Pay"),children:"Line Pay"}),(0,s.jsx)(c.MenuItem,{onClick:()=>E("現金"),children:"現金"}),(0,s.jsx)(c.MenuItem,{onClick:()=>E("票據"),children:"票據"}),(0,s.jsx)(c.MenuItem,{onClick:()=>E("其他"),children:"其他"})]}),(0,s.jsx)(c.Snackbar,{open:f.open,autoHideDuration:3e3,onClose:()=>T((e=>({...e,open:!1}))),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,s.jsx)(c.Alert,{onClose:()=>T((e=>({...e,open:!1}))),severity:f.severity,children:f.message})})]})}},983885:function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(474848),l=n(296540),i=n(264456),s=n(409938),o=n(64545),c=n(500523),d=a(n(825734)),m=a(n(455549)),u=a(n(67034)),h=n(407514),x=n(859325);t.default=({investments:e})=>{const[t,n]=(0,l.useState)([]),[a,p]=(0,l.useState)([]),[g,y]=(0,l.useState)(!0),[j,b]=(0,l.useState)(null),[v,f]=(0,l.useState)("all"),[T,S]=(0,l.useState)([]),[C,I]=(0,l.useState)(!1),[w,D]=(0,l.useState)(null),[P,N]=(0,l.useState)((new Date).getFullYear()),[A,R]=(0,l.useState)(!1),[E,k]=(0,l.useState)(""),[M,B]=(0,l.useState)(!1),{enqueueSnackbar:O}=(0,h.useSnackbar)();(0,l.useEffect)((()=>{_()}),[]);const _=async()=>{y(!0);try{console.log("歷史記錄 - 開始載入資料");const e=Array.from({length:5},((e,t)=>(new Date).getFullYear()-t));console.log("歷史記錄 - 準備載入的年度:",e);const t=[],a=[];for(const n of e){console.log(`歷史記錄 - 正在載入 ${n} 年度的資料`);try{const[e,r]=await Promise.all([o.ApiService.getRentalPayments(void 0,n),o.ApiService.getMemberProfits(void 0,void 0,n)]);console.log(`歷史記錄 - ${n} 年度租金收款: ${e.length} 筆, 會員分潤: ${r.length} 筆`),t.push(...e),a.push(...r)}catch(e){console.error(`歷史記錄 - 載入 ${n} 年度資料時出錯:`,e)}}console.log(`歷史記錄 - 總共載入: 租金收款 ${t.length} 筆, 會員分潤 ${a.length} 筆`),n(t),p(a);const r=e.map((e=>{const n=t.filter((t=>t.year===e)),r=a.filter((t=>t.year===e)),l=n.filter((e=>e.status===s.PaymentStatus.PAID)),i=r.filter((e=>e.status===s.PaymentStatus.PAID));return console.log(`歷史記錄 - ${e} 年度統計: 租金 ${n.length} 筆, 已收 ${l.length} 筆, 分潤 ${r.length} 筆, 已發放 ${i.length} 筆`),{year:e,totalRental:n.reduce(((e,t)=>e+Number(t.amount)),0),collectedRental:l.reduce(((e,t)=>e+Number(t.amount)),0),totalProfit:r.reduce(((e,t)=>e+Number(t.amount)),0),paidProfit:i.reduce(((e,t)=>e+Number(t.amount)),0)}}));S(r),b(null)}catch(e){b("載入資料失敗"),console.error("載入資料失敗:",e)}finally{y(!1),console.log("歷史記錄 - 資料載入完成")}},F=()=>{"all"!==v?(D(Number(v)),I(!0)):O("請先選擇要清除的年度",{variant:"warning"})},G=()=>{R(!1)},W=()=>{B(!1),k("")};if(g)return(0,r.jsx)(d.default,{});if(j)return(0,r.jsx)(m.default,{message:j});const $=[...t.filter((e=>e.status===s.PaymentStatus.PAID&&("all"===v||e.year===Number(v)))).map((e=>({date:e.paymentDate||e.updatedAt,investmentId:e.investmentId,type:"租金收款",amount:e.amount,year:e.year,month:e.month}))),...a.filter((e=>e.status===s.PaymentStatus.PAID&&("all"===v||e.year===Number(v)))).map((e=>({date:e.paymentDate||e.updatedAt,investmentId:e.investmentId,type:"會員分潤",amount:e.amount,year:e.year,month:e.month})))].sort(((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()));return(0,r.jsxs)(i.Box,{children:[(0,r.jsxs)(i.Box,{sx:{mb:3,display:"flex",alignItems:"center"},children:[(0,r.jsx)(i.Typography,{variant:"h6",sx:{flexGrow:1},children:"投資歷史記錄"}),(0,r.jsxs)(i.FormControl,{sx:{minWidth:120,mr:2},children:[(0,r.jsx)(i.InputLabel,{id:"year-select-label",children:"年度"}),(0,r.jsxs)(i.Select,{labelId:"year-select-label",id:"year-select",name:"year-select",value:v,label:"年度",onChange:e=>f(e.target.value),children:[(0,r.jsx)(i.MenuItem,{value:"all",children:"全部"}),T.map((e=>(0,r.jsx)(i.MenuItem,{value:e.year.toString(),children:e.year},e.year)))]})]}),(0,r.jsx)(i.Button,{variant:"outlined",color:"error",startIcon:(0,r.jsx)(u.default,{}),onClick:F,id:"clear-history-btn","aria-label":"清除歷史資料",children:"清除歷史資料"})]}),(0,r.jsx)(i.Grid,{container:!0,spacing:2,sx:{mb:3},children:T.map((e=>(0,r.jsx)(i.Grid,{item:!0,xs:12,md:4,children:(0,r.jsx)(i.Card,{children:(0,r.jsxs)(i.CardContent,{children:[(0,r.jsxs)(i.Typography,{variant:"h6",gutterBottom:!0,children:[e.year," 年度統計"]}),(0,r.jsx)(i.Table,{size:"small",children:(0,r.jsxs)(i.TableBody,{children:[(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"已收租金"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(e.collectedRental)})]}),(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"已發放分潤"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(e.paidProfit)})]}),(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"淨收入"}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(e.collectedRental-e.paidProfit)})]})]})})]})})},e.year)))}),(0,r.jsx)(i.TableContainer,{component:i.Paper,children:(0,r.jsxs)(i.Table,{children:[(0,r.jsx)(i.TableHead,{children:(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:"日期"}),(0,r.jsx)(i.TableCell,{children:"投資項目"}),(0,r.jsx)(i.TableCell,{children:"年月"}),(0,r.jsx)(i.TableCell,{children:"類型"}),(0,r.jsx)(i.TableCell,{align:"right",children:"金額"})]})}),(0,r.jsxs)(i.TableBody,{children:[$.map(((t,n)=>{const a=e.find((e=>e.id===t.investmentId));return(0,r.jsxs)(i.TableRow,{children:[(0,r.jsx)(i.TableCell,{children:new Date(t.date).toLocaleDateString("zh-TW")}),(0,r.jsx)(i.TableCell,{children:(null==a?void 0:a.name)||"未知項目"}),(0,r.jsx)(i.TableCell,{children:`${t.year}年${t.month}月`}),(0,r.jsx)(i.TableCell,{children:t.type}),(0,r.jsx)(i.TableCell,{align:"right",children:(0,c.formatCurrency)(t.amount)})]},n)})),0===$.length&&(0,r.jsx)(i.TableRow,{children:(0,r.jsx)(i.TableCell,{colSpan:5,align:"center",children:"尚無歷史記錄"})})]})]})}),(0,r.jsxs)(i.Dialog,{open:C,onClose:()=>I(!1),children:[(0,r.jsx)(i.DialogTitle,{children:"確認清除歷史資料"}),(0,r.jsx)(i.DialogContent,{children:(0,r.jsxs)(i.DialogContentText,{children:["您確定要清除 ",w," 年度的所有歷史資料嗎？此操作將刪除所有租金收款和會員分潤記錄，且無法恢復。"]})}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:()=>I(!1),children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{if(w){y(!0),console.log(`開始清除 ${w} 年度的歷史資料`);try{console.log(`使用 purgeLocalStorage 清除 ${w} 年度的資料...`);try{await o.ApiService.purgeLocalStorage(w),console.log(`${w} 年度的數據已從本地存儲中清除`)}catch(e){console.error("使用 purgeLocalStorage 清除失敗，嘗試直接操作本地存儲:",e);try{const e=localStorage.getItem("rentalPayments");if(e){const t=JSON.parse(e),n=t.filter((e=>e.year!==w));console.log(`備用方法 - 租金收款：從 ${t.length} 筆過濾到 ${n.length} 筆`),localStorage.setItem("rentalPayments",JSON.stringify(n))}}catch(e){console.error("備用方法 - 清除租金收款時出錯:",e)}try{const e=localStorage.getItem("memberProfits");if(e){const t=JSON.parse(e),n=t.filter((e=>e.year!==w));console.log(`備用方法 - 會員分潤：從 ${t.length} 筆過濾到 ${n.length} 筆`),localStorage.setItem("memberProfits",JSON.stringify(n))}}catch(e){console.error("備用方法 - 清除會員分潤時出錯:",e)}console.log(`備用方法 - ${w} 年度的數據已從本地存儲中清除`)}console.log("重新載入資料..."),await _(),console.log("資料重新載入完成"),D(null),I(!1),O(`${w}年度的歷史記錄已清除`,{variant:"success"}),setTimeout((()=>{console.log("使用路由導航..."),window.location.href="#/investment/history"}),500)}catch(e){console.error("清除資料失敗:",e),O("清除資料失敗",{variant:"error"})}finally{y(!1),console.log(`${w} 年度的歷史記錄清除操作完成`)}}},color:"error",variant:"contained",children:"確認清除"})]})]}),(0,r.jsxs)(i.Grid,{container:!0,spacing:2,sx:{mb:2},children:[(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:4,md:3,children:(0,r.jsxs)(i.FormControl,{fullWidth:!0,children:[(0,r.jsx)(i.InputLabel,{children:"選擇年度"}),(0,r.jsx)(i.Select,{value:P,onChange:e=>{N(e.target.value)},label:"選擇年度",children:Array.from({length:10},((e,t)=>(new Date).getFullYear()-5+t)).map((e=>(0,r.jsx)(i.MenuItem,{value:e,children:e},e)))})]})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:4,md:3,children:(0,r.jsx)(i.Button,{variant:"outlined",color:"warning",onClick:F,fullWidth:!0,sx:{height:"100%"},children:"清除歷史資料"})}),(0,r.jsx)(i.Grid,{item:!0,xs:12,sm:4,md:3,children:(0,r.jsx)(i.Tooltip,{title:"警告：此操作將清除所有投資、租金、分潤資料！僅用於測試環境",children:(0,r.jsx)(i.Button,{variant:"contained",color:"error",onClick:()=>B(!0),fullWidth:!0,sx:{height:"100%"},startIcon:(0,r.jsx)(x.WarningAmber,{}),children:"清除所有資料"})})})]}),(0,r.jsxs)(i.Dialog,{open:A,onClose:G,children:[(0,r.jsx)(i.DialogTitle,{children:"確認清除歷史資料"}),(0,r.jsx)(i.DialogContent,{children:(0,r.jsxs)(i.DialogContentText,{children:["確定要清除 ",P," 年度的所有歷史資料嗎？此操作無法撤消。"]})}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:G,children:"取消"}),(0,r.jsx)(i.Button,{onClick:()=>{R(!1),B(!0)},color:"warning",children:"確認清除"})]})]}),(0,r.jsxs)(i.Dialog,{open:M,onClose:W,children:[(0,r.jsx)(i.DialogTitle,{children:"危險操作確認"}),(0,r.jsxs)(i.DialogContent,{children:[(0,r.jsxs)(i.DialogContentText,{sx:{mb:2},children:[(0,r.jsx)(x.WarningAmber,{color:"error",sx:{verticalAlign:"middle",mr:1}}),"此操作將清除所有投資項目、租金收款、分潤資料等系統數據，且無法恢復！"]}),(0,r.jsx)(i.DialogContentText,{sx:{mb:2},children:"請輸入「確認清除」並點擊確認按鈕以繼續操作："}),(0,r.jsx)(i.TextField,{fullWidth:!0,value:E,onChange:e=>k(e.target.value),placeholder:"確認清除"})]}),(0,r.jsxs)(i.DialogActions,{children:[(0,r.jsx)(i.Button,{onClick:W,children:"取消"}),(0,r.jsx)(i.Button,{onClick:async()=>{y(!0);try{localStorage.removeItem("investments"),localStorage.removeItem("rentalStandards"),localStorage.removeItem("rentalPayments"),localStorage.removeItem("memberProfits"),localStorage.removeItem("profitSharingStandards"),await o.ApiService.getInvestments(),O("所有資料已清除",{variant:"success"}),setTimeout((()=>{console.log("使用路由導航..."),window.location.href="#/investment/history"}),500)}catch(e){const t=e instanceof Error?e.message:"未知錯誤";console.error("清除資料失敗:",t),O(`清除資料失敗: ${t}`,{variant:"error"}),b(`清除資料失敗: ${t}`)}finally{y(!1),B(!1),k("")}},color:"error",disabled:"確認清除"!==E,children:"確認清除所有資料"})]})]})]})}}},r={};function l(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={id:e,exports:{}};return a[e].call(n.exports,n,n.exports,l),n.exports}l.m=a,e=[],l.O=(t,n,a,r)=>{if(!n){var i=1/0;for(d=0;d<e.length;d++){for(var[n,a,r]=e[d],s=!0,o=0;o<n.length;o++)(!1&r||i>=r)&&Object.keys(l.O).every((e=>l.O[e](n[o])))?n.splice(o--,1):(s=!1,r<i&&(i=r));if(s){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,a,r]},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var r=Object.create(null);l.r(r);var i={};t=t||[null,n({}),n([]),n(n)];for(var s=2&a&&e;"object"==typeof s&&!~t.indexOf(s);s=n(s))Object.getOwnPropertyNames(s).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,l.d(r,i),r},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};l.O.j=t=>0===e[t];var t=(t,n)=>{var a,r,[i,s,o]=n,c=0;if(i.some((t=>0!==e[t]))){for(a in s)l.o(s,a)&&(l.m[a]=s[a]);if(o)var d=o(l)}for(t&&t(n);c<i.length;c++)r=i[c],l.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return l.O(d)},n=self.webpackChunkasset_mgmt=self.webpackChunkasset_mgmt||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),l.nc=void 0,l.O(void 0,[748],(()=>l(348287))),l.O(void 0,[748],(()=>l(365606)));var i=l.O(void 0,[748],(()=>l(353900)));i=l.O(i)})();